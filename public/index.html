<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link href="assets/style.css" type="text/css" rel="stylesheet">
    <script src="https://distill.pub/template.v1.js"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css"
          integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0"
          crossorigin="anonymous">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>

    <script type="text/front-matter">
      title: "Understanding FiLM"
      description: "Description of the post"
      authors:
      - Vincent Dumoulin: https://vdumoulin.github.io
      - Ethan Perez: http://ethanperez.net/
      - Florian Strub: https://fstrub95.github.io/
      - Harm de Vries: http://www-etud.iro.umontreal.ca/~devries/
      - Nathan Schucher: https://nathanschucher.com/
      - Aaron Courville: https://aaroncourville.wordpress.com/
      - Yoshua Bengio: http://www.iro.umontreal.ca/~bengioy/yoshua_en/
      affiliations:
      - MILA: https://mila.quebec/en/
      - Rice University: http://www.rice.edu/
      - Inria SequeL: https://team.inria.fr/sequel/
      - MILA: https://mila.quebec/en/
      - Element AI: https://element.ai/
      - MILA: https://mila.quebec/en/
      - MILA: https://mila.quebec/en/
    </script>
  </head>
  <body>
    <dt-article>
      <h1>Feature-wise affine transformations</h1>
      <h2>A family of methods for fusing multiple sources of information</h2>

      <dt-byline></dt-byline>

      <p>
        We often think of neural networks as a mapping from a raw source of
        information to a more abstract and useful representation &mdash; pixel
        values to object classes, audio waveform to text, etc. In practice,
        however, it is frequent that a task requires handling multiple sources
        of information. It could be that a model is given access to both the
        video sequence and the audio waveform of a movie scene and is asked to
        predict what is going on. It could also be that an image needs to be
        processed in the context of a question being asked.
      </p>
      <p>
        This gives rise to the need for principled ways of handling multiple
        information sources, to <em>fuse</em> them, to influence (or
        <em>condition</em>) the way in which one source is processed in the
        context of another.
      </p>
      <p>
        <a href="https://distill.pub/2016/augmented-rnns/">Attention</a> is a
        good example of one such principled approach: side information is used
        to compute the weights which are used to summarize elements of a primary
        information channel (like a sequence of word embeddings, for instance)
        into a weighted sum. In this example, the side information is allowed to
        influence how much of each element is carried forward.
      </p>
      <p>
        Sometimes, however, we would prefer to treat the primary information
        channel as a whole rather than summarizing it. For instance, in
        conditional decoder-based generative models, we would like to map a
        source of noise to model samples in a way that is class-aware. This
        involves injecting class information into the decoder network.
      </p>
      <p>
        A naive approach could be to concatenate a class embedding to the noise
        vector and pass the result to the decoder. As we will see later, this
        is equivalent to add a class-dependent bias to the first layer of the
        decoder. Other approaches involve adding class-dependent biases to
        <em>all</em> layers of the decoder, applying class-conditional sigmoidal
        gating to them, or more generally applying a class-conditional affine
        transformation to all decoder layers. These approaches all have in
        common that they act at the feature level, and we can regroup them under
        the umbrella of <em>feature-wise affine transformations</em>.
      </p>
      <p>
        In this article, we will take a deep dive into feature-wise affine
        transformations, which find their way in a surprising amount of recent
        neural network architectures and in various problem settings. We will
        examine them from two very different vantage points.
      </p>
      <p>
        On one hand, we will discuss feature-wise affine transformations as a
        family of related approaches and show how they can be conceptualized
        using the <a href="#film-nomenclature">FiLM nomenclature</a>. We will
        point out their <a href="#film-in-literature">numerous uses in the recent
        literature</a>, and take a stab at
        <a href="#understanding-film">understanding the computational mechanisms</a>
        that allow them to work.
      </p>
      <p>
        On the other hand, we will inscribe feature-wise affine transformations
        themselves within the <a href="#bilinear-connection">family of bilinear
        transformations</a>. We will show that a small extension to the bilinear
        transformation formulation allows us to relate attention, gating, FiLM,
        and mixture-of-experts models as different instantiations of a so-called
        <em>generalized bilinear transformation</em>.
      </p>
      <p>
        We hope that the insights brought forward by this article help highlight
        the strong connections between the aforementioned methods and inspire
        new approaches to integrating multiple information channels in neural
        networks.
      </p>

      <hr/>

      <h1 id="film-nomenclature">FiLM</h1>
      <p>
        To center the discussion around a common language, we propose to use
        the nomenclature of <dt-cite key="perez2017film"></dt-cite>, which
        calls feature-wise affine transformations <em>FiLM</em>, for
        <strong>F</strong>eature-w<strong>i</strong>se <strong>L</strong>inear
        <strong>M</strong>odulation.
        <dt-fn>
          Strictly speaking, <em>linear</em> is a misnomer, as we allow biasing,
          but we hope the more rigorous-minded reader will forgive us for the
          sake of a better-sounding acronym.
        </dt-fn>
      </p>
      <p>
        We say that a neural network is modulated using FiLM, or
        <em>FiLM-ed</em>, through the insertion of <em>FiLM layers</em> in its
        architecture. These are parametrized by some form of conditioning
        information, and the mapping from conditioning information to FiLM
        parameters is called the <em>FiLM generator</em>. For simplicity, you
        can assume that the FiLM generator outputs the concatenation of all
        FiLM parameters for the network architecture.
      </p>
      <figure class="l-body-outset figure" id="film-architecture-diagram">
        <svg viewBox="0 0 744 500" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" id="arrow-right"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" class="figure-path" id="arrow-up"/>
          </defs>
          <g transform="translate(479, 38)">
            <g class="filmed-network">
              <rect width="260" height="416" class="figure-group figure-box figure-filmed-network"/>
              <text x="8" y="18" class="figure-text">FiLM-ed network</text>
            </g>
            <text x="130" y="442" style="text-anchor: middle;" class="figure-text">input</text>
            <path d="M130,399l0,30" class="figure-line"/>
            <use x="130" y="399" href="#arrow-up"/>
            <g transform="translate(20, 337)">
              <rect width="222" height="62" class="figure-element figure-box"/>
              <text x="111" y="31" dy="0.4em" style="text-anchor: middle;" class="figure-text">sub-network</text>
            </g>
            <path d="M130,313l0,24" class="figure-line"/>
            <use x="130" y="313" href="#arrow-up"/>
            <g transform="translate(20, 268)" class="film-layer">
              <rect width="222" height="45" class="figure-element figure-box figure-film-layer"/>
              <text x="111" y="22" dy="0.4em" style="text-anchor: middle;" class="figure-text">FiLM</text>
            </g>
            <path d="M130,244l0,24" class="figure-line"/>
            <use x="130" y="244" href="#arrow-up"/>
            <g transform="translate(20, 182)">
              <rect width="222" height="62" class="figure-element figure-box"/>
              <text x="111" y="31" dy="0.4em" style="text-anchor: middle;" class="figure-text">sub-network</text>
            </g>
            <path d="M130,157l0,24" class="figure-line"/>
            <use x="130" y="157" href="#arrow-up"/>
            <g transform="translate(20, 112)" class="film-layer">
              <rect width="222" height="45" class="figure-element figure-box figure-film-layer"/>
              <text x="111" y="22" dy="0.4em" style="text-anchor: middle;" class="figure-text">FiLM</text>
            </g>
            <path d="M130,88l0,24" class="figure-line"/>
            <use x="130" y="88" href="#arrow-up"/>
            <g transform="translate(20, 26)">
              <rect width="222" height="62" class="figure-element figure-box"/>
              <text x="111" y="31" dy="0.4em" style="text-anchor: middle;" class="figure-text">sub-network</text>
            </g>
            <path d="M130,-15l0,41" class="figure-line"/>
            <use x="130" y="-15" href="#arrow-up"/>
            <text x="130" y="-22" style="text-anchor: middle;" class="figure-text">output</text>
          </g>
          <text x="5" y="255" class="figure-text">conditioning</text>
          <path d="M81,250l53,0" class="figure-line"/>
          <use x="134" y="250" href="#arrow-right" class="figure-path"/>
          <g transform="translate(135, 101)" class="film-generator">
            <rect width="180" height="300" class="figure-group figure-box figure-film-generator"/>
            <text x="90" y="150" style="text-anchor: middle;" class="figure-text">FiLM generator</text>
          </g>
          <path d="M314,250l58,0" class="figure-line"/>
          <use x="372" y="250" href="#arrow-right" class="figure-path"/>
          <g>
            <rect x="493" y="105" width="48" height="328" class="figure-group figure-box" transform="translate(-121, -21)"/>
            <g transform="translate(382, 100)">
              <rect width="30" height="140" class="figure-element figure-box"/>
              <text x="15" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text" transform="rotate(-90, 15, 70)">FiLM parameters</text>
            </g>
            <g transform="translate(382, 260)">
              <rect width="30" height="140" class="figure-element figure-box"/>
              <text x="15" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text" transform="rotate(-90, 15, 70)">FiLM parameters</text>
            </g>
          </g>
          <path d="M412,173l86,0" class="figure-line"/>
          <use x="498" y="173" href="#arrow-right" class="figure-path"/>
          <path d="M412,328l86,0" class="figure-line"/>
          <use x="498" y="328" href="#arrow-right" class="figure-path"/>
        </svg>
        <figcaption>
          In this example, a network is FiLM-ed by inserting two FiLM layers in
          its architecture. The FiLM parameters are computed using the FiLM
          generator, which processes the conditioning information.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("figure.figure#film-architecture-diagram").select("svg");
            svg.selectAll("g.film-generator")
                .on("mouseenter", function () { svg.select("rect.figure-film-generator").style("fill", "#ef9a9a"); })
                .on("mouseleave", function () { svg.select("rect.figure-film-generator").style("fill", null); });
            svg.selectAll("g.film-layer")
                .on("mouseenter", function () { svg.selectAll("rect.figure-film-layer").style("fill", "#ffcc80"); })
                .on("mouseleave", function () { svg.selectAll("rect.figure-film-layer").style("fill", null); });
            svg.selectAll("g.filmed-network")
                .on("mouseenter", function () { svg.select("rect.figure-filmed-network").style("fill", "#90caf9"); })
                .on("mouseleave", function () { svg.select("rect.figure-filmed-network").style("fill", null); });
        })();
      </script>
      <p>
        As the name implies, a FiLM layer applies a feature-wise affine
        transformation to its input. The parameters of that transformation are
        also provided as input. By <em>feature-wise</em>, we mean that scaling
        and shifting are applied elementwise, or in the case of convolutional
        networks, feature map-wise. In other words,

        <dt-math block>
            \textrm{FiLM}(\mathbf{x}) = \gamma(\mathbf{z}) \odot \mathbf{x}
                                                           + \beta(\mathbf{z}),
        </dt-math>

        where <dt-math>\mathbf{x}</dt-math> is the FiLM layer's input and
        <dt-math>\mathbf{z}</dt-math> is the conditioning information. You can
        interact with the following fully-connected and convolutional FiLM
        layers to get an intuition of the sort of modulation they allow:
      </p>
      <figure class="l-body-outset figure" id="film-diagram">
        <svg viewBox="0 0 744 600" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" id="arrow-right"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" id="arrow-up"/>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-left"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-down"/>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 34 0 l 0 40 l -34 0 a 6 6 0 0 1 -6 -6 Z" id="vector-feature-left"/>
            <path d="M 0 0 l 40 0 l 0 40 l -40 0 Z" id="vector-feature-middle"/>
            <path d="M 0 0 l 34 0 a 6 6 0 0 1 6 6 l 0 28 a 6 6 0 0 1 -6 6 l -34 0 Z" id="vector-feature-right"/>
            <g id="vector-arrow">
              <path d="M 0 0 l 0 -16"/>
              <path d="M 0 -16 l -4 4 l 4 -4 l 4 4"/>
            </g>
            <rect width="30" height="30" rx="6" ry="6" opacity="0.8" style="fill: rgb(221, 58, 150);" id="vector-patch-positive"/>
            <rect width="30" height="30" rx="6" ry="6" opacity="0.8" style="fill: #3a5edd;" id="vector-patch-negative"/>
            <path d="M 0 0 l 30 0 l 0 30 l -30 0 Z" id="convolutional-feature"/>
            <g id="convolutional-arrow">
              <path d="M 0 0 L 0 -12"/>
              <path d="M -3 -9 L 0 -12 L 3 -9"/>
            </g>
            <rect width="20" height="20" rx="6" ry="6" opacity="0.8" style="fill: rgb(221, 58, 150);" id="convolutional-patch-positive"/>
            <rect width="20" height="20" rx="6" ry="6" opacity="0.8" style="fill: #3a5edd;" id="convolutional-patch-negative"/>
            <symbol id="interactive" viewBox="0 0 25.86 25.86">
              <circle cx="13.43" cy="13.43" r="12.93" fill="none" stroke="#ffdc8c" stroke-miterlimit="10" transform="matrix(0.9999999999999999, 0, 0, 0.9999999999999999, -0.5000002384185862, -0.5000002384186075)"/>
              <circle cx="13.43" cy="13.43" r="10.38" fill="#ffb200" transform="matrix(0.9999999999999999, 0, 0, 0.9999999999999999, -0.5000002384185862, -0.5000002384186075)"/>
              <polygon points="11.32 19.26 11.32 17.43 10.72 17.43 10.71 16.14 10.1 16.21 10.1 15 9.54 14.99 9.46 13.78 8.88 13.78 8.89 13.16 8.28 13.16 8.28 11.34 10.11 11.34 10.11 11.94 10.71 11.94 10.71 6.46 11.33 6.45 11.33 5.86 12.54 5.86 12.54 6.45 13.16 6.47 13.16 8.89 14.37 8.89 14.39 9.49 16.21 9.51 16.21 10.12 17.43 10.12 17.43 10.79 18.04 10.73 18.05 11.39 18.65 11.33 18.65 15.61 18.04 15.52 17.98 17.43 17.43 17.43 17.43 19.26 11.32 19.26" fill="#fff" opacity="0.2" transform="matrix(0.9999999999999999, 0, 0, 0.9999999999999999, -0.5000002384185862, -0.5000002384186075)"/>
              <g transform="matrix(0.9999999999999999, 0, 0, 0.9999999999999999, -0.5000002384185862, -0.5000002384186075)">
                <path d="M10.11,11.94c0-.09,0-0.19,0-0.28s0-.21,0-0.32H8.28v1.82H8.89V11.95h1.23v0.63h0.6v0.6h0.61V13.09q0-2.4,0-4.8,0-.92,0-1.85h1.21V5.85H11.33v0.6H10.71v5.47h-0.6Zm4.28-2.44a0.45,0.45,0,0,1,0-.07c0-.15,0-0.3,0-0.45s0,0,0-.08H13.16V6.47H12.55v5.47h0.61V9.51h1.24s0,0.06,0,.09q0,1.12,0,2.25s0,0.07,0,.1H15V10.12h1.23v2.43h0.6V10.71l0.57,0s0,0,0,.05,0,0.29,0,.44,0,0.07,0,.11H18a0,0,0,0,1,.06.06c0,0.24,0,.48,0,0.72q0,1.71,0,3.41s0,0,0,.08h-0.6s0,0,0,0q0,0.86,0,1.72s0,0,0,.06H16.81v1.21H11.94V17.42H11.33V16.21h-0.6a11.4,11.4,0,0,0,0,1.22h0.6v1.83c2,0,4.07,0,6.11,0,0-.1,0-0.19,0-0.28,0-.46,0-0.93,0-1.39a1.53,1.53,0,0,0,0-.16H18c0.05,0,.07,0,0.07-0.07,0-.45,0-0.89,0-1.34,0-.13,0-0.26,0-0.4l0.3,0h0.3V11.33H18v-0.6H17.43V10.11H16.21V9.51H14.39ZM10.1,15v1.21h0.52a0.07,0.07,0,0,0,.08-0.08c0-.32,0-0.65,0-1,0-.06,0-0.11,0-0.17H10.11V13.77H9.49V13.16H8.91a2.7,2.7,0,0,0,0,.62H9.47s0,0,0,.07,0,0.27,0,.41,0,0.45,0,.68a0,0,0,0,0,.05.06H10.1Z" fill="#fff"/>
                <path d="M17.43,17.43s0,0,0-.06q0-.86,0-1.72s0,0,0,0H18s0-.06,0-0.08q0-1.71,0-3.41c0-.24,0-0.48,0-0.72A0,0,0,0,0,18,11.33H17.44s0-.07,0-0.11,0-.29,0-0.44,0-.05,0-0.05l-0.57,0v1.84h-0.6V10.12H15v1.82H14.38s0-.07,0-0.1q0-1.12,0-2.25s0-.06,0-0.09h1.81v0.6h1.22v0.62H18v0.6h0.61v4.28h-0.3l-0.3,0c0,0.14,0,.27,0,0.4,0,0.45,0,.89,0,1.34,0,0.05,0,.07-0.07.07H17.43Z" fill="#fff"/>
                <path d="M17.43,17.43a1.53,1.53,0,0,1,0,.16c0,0.46,0,.93,0,1.39,0,0.09,0,.17,0,0.28-2,0-4.06,0-6.11,0V17.43h-0.6a11.4,11.4,0,0,1,0-1.22h0.6v1.21h0.61v1.22h4.88V17.43h0.62Z" fill="#fff"/>
                <path d="M11.33,6.45q0,0.92,0,1.85,0,2.4,0,4.8v0.07H10.72v-0.6h-0.6V11.93h0.6V6.46h0.61Z" fill="#fff"/>
                <path d="M14.39,9.49H13.16v2.43H12.55V6.47h0.61V8.89h1.21s0,0.06,0,.08,0,0.3,0,.45a0.44,0.44,0,0,0,0,.07h0Z" fill="#fff"/>
                <path d="M10.1,15H9.54a0,0,0,0,1-.05-0.06c0-.23,0-0.45,0-0.68s0-.27,0-0.41,0,0,0-.07H8.88a2.7,2.7,0,0,1,0-.62H9.49v0.61h0.62V15h0.61c0,0.06,0,.12,0,0.17,0,0.32,0,.65,0,1a0.07,0.07,0,0,1-.08.08H10.1V15Z" fill="#fff"/>
                <path d="M10.11,11.93H8.89v1.21H8.28V11.34h1.83c0,0.11,0,.21,0,0.32s0,0.19,0,.28h0Z" fill="#fff"/>
                <path d="M11.33,6.45V5.85h1.21v0.6H11.33Z" fill="#fff"/>
              </g>
            </symbol>
          </defs>
          <g transform="translate(10, 50)" id="mlp-figure">
            <rect y="73" width="290" height="342" class="figure-group figure-box figure-film-layer"/>
            <text x="10" y="402" class="figure-text">FiLM layer (fully-connected)</text>
            <g transform="translate(147, 440)" id="input-layer">
              <g transform="translate(0, 0)" class="feature">
                <use href="#vector-feature-left" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use href="#vector-feature-middle" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use href="#vector-feature-right" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <line x1="207" y1="440" x2="207" y2="373" class="figure-line"/>
            <use href="#arrow-up" transform="translate(207, 373)" class="figure-path"/>
            <g transform="translate(27, 332)" id="gamma">
              <g transform="translate(0, 0)" class="feature">
                <use href="#vector-feature-left" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use href="#vector-feature-middle" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use href="#vector-feature-right" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <text x="59" y="325" class="figure-text" style="font-family: serif;" transform="translate(-49, 18)">γ</text>
            <use width="26" height="26" transform="translate(74, 302)" xlink:href="#interactive"/>
            <line x1="147" y1="353" x2="187" y2="353" class="figure-line"/>
            <use href="#arrow-right" transform="translate(187, 353)" class="figure-path"/>
            <g transform="translate(207, 352)">
              <ellipse cx="0" cy="0" rx="20" ry="20" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <line x1="207" y1="333" x2="207" y2="265" class="figure-line"/>
            <use href="#arrow-up" transform="translate(207, 265)" class="figure-path"/>
            <g transform="translate(147, 225)" id="scaled-layer">
              <g transform="translate(0, 0)" class="feature">
                <use href="#vector-feature-left" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use href="#vector-feature-middle" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use href="#vector-feature-right" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <line x1="207" y1="225" x2="207" y2="158" class="figure-line"/>
            <use href="#arrow-up" transform="translate(207, 158)" class="figure-path"/>
            <g transform="translate(27, 118)" id="beta">
              <g transform="translate(0, 0)" class="feature">
                <use href="#vector-feature-left" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use href="#vector-feature-middle" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use href="#vector-feature-right" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <text x="10" y="128" style="font-family: serif;" class="figure-text">β</text>
            <use width="26" height="26" transform="translate(74, 87)" xlink:href="#interactive"/>
            <line x1="147" y1="138" x2="187" y2="138" class="figure-line"/>
            <use href="#arrow-right" transform="translate(187, 138)" class="figure-path"/>
            <g transform="translate(207, 137)">
              <ellipse cx="0" cy="0" rx="20" ry="20" class="figure-element"/>
              <line x1="0" y1="7.5" x2="0" y2="-7.5" class="figure-line"/>
              <line x1="-7.5" y1="0" x2="7.5" y2="0" class="figure-line"/>
            </g>
            <line x1="207" y1="118" x2="207" y2="50" class="figure-line"/>
            <use href="#arrow-up" transform="translate(207, 50)" class="figure-path"/>
            <g transform="translate(147, 10)" id="shifted-layer">
              <g transform="translate(0, 0)" class="feature">
                <use href="#vector-feature-left" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use href="#vector-feature-middle" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use href="#vector-feature-right" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <line x1="-10" y1="138" x2="27" y2="138" class="figure-line"/>
            <use href="#arrow-right" transform="translate(27, 138)" class="figure-path"/>
            <line x1="-10" y1="353" x2="27" y2="353" class="figure-line"/>
            <use href="#arrow-right" transform="translate(27, 353)" class="figure-path"/>
          </g>
          <g transform="translate(377, 60)" id="cnn-figure">
            <rect x="47" y="63" width="310" height="342" class="figure-group figure-box figure-film-layer"/>
            <text x="57" y="392" class="figure-text">FiLM layer (convolutional)</text>
            <g transform="translate(239, 470)" id="input-layer">
              <g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -20)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -40)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
            </g>
            <line x1="262" y1="420" x2="262" y2="363" class="figure-line"/>
            <use href="#arrow-up" transform="translate(262, 363)" class="figure-path"/>
            <g transform="translate(74, 322)" id="gamma">
              <g transform="translate(0, 0)" class="feature">
                <use href="#vector-feature-left" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use href="#vector-feature-middle" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use href="#vector-feature-right" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <text x="59" y="325" class="figure-text" style="font-family: serif;" transform="translate(-2, 8)">γ</text>
            <use width="26" height="26" transform="translate(122, 292)" xlink:href="#interactive"/>
            <line x1="194" y1="343" x2="242" y2="343" class="figure-line"/>
            <use href="#arrow-right" transform="translate(242, 343)" class="figure-path"/>
            <g transform="translate(262, 342)">
              <ellipse cx="0" cy="0" rx="20" ry="20" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <line x1="262" y1="323" x2="262" y2="286" class="figure-line"/>
            <use href="#arrow-up" transform="translate(262, 286)" class="figure-path"/>
            <g transform="translate(239, 231)" id="scaled-layer">
              <g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -20)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -40)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
            </g>
            <line x1="262" y1="181" x2="262" y2="148" class="figure-line"/>
            <use href="#arrow-up" transform="translate(262, 148)" class="figure-path"/>
            <g transform="translate(74, 107)" id="beta">
              <g transform="translate(0, 0)" class="feature">
                <use href="#vector-feature-left" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use href="#vector-feature-middle" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use href="#vector-feature-right" class="figure-element"/>
                <use href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <text x="57" y="118" style="font-family: serif;" class="figure-text">β</text>
            <use width="26" height="26" transform="translate(122, 77)" xlink:href="#interactive"/>
            <line x1="194" y1="128" x2="242" y2="128" class="figure-line"/>
            <use href="#arrow-right" transform="translate(242, 128)" class="figure-path"/>
            <g transform="translate(262, 127)">
              <ellipse cx="0" cy="0" rx="20" ry="20" class="figure-element"/>
              <line x1="0" y1="7.5" x2="0" y2="-7.5" class="figure-line"/>
              <line x1="-7.5" y1="0" x2="7.5" y2="0" class="figure-line"/>
            </g>
            <line x1="262" y1="108" x2="262" y2="50" class="figure-line"/>
            <use href="#arrow-up" transform="translate(262, 50)" class="figure-path"/>
            <g transform="translate(239, -5)" id="shifted-layer">
              <g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -20)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -40)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use href="#convolutional-feature" class="figure-element"/>
                  <use href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
            </g>
            <line x1="34" y1="128" x2="74" y2="128" class="figure-line"/>
            <use href="#arrow-right" transform="translate(74, 128)" class="figure-path"/>
            <line x1="34" y1="343" x2="74" y2="343" class="figure-line"/>
            <use href="#arrow-right" transform="translate(74, 343)" class="figure-path"/>
          </g>
        </svg>
        <figcaption>
          A FiLM layers applied on a fully-connected input (left) and on a
          convolutional input (right). In both cases, the scaling and shifting
          vectors <dt-math>\gamma</dt-math> and <dt-math>\beta</dt-math> are
          passed as input and are computed by the FiLM generator. Try
          interacting with the <dt-math>\gamma</dt-math> and
          <dt-math>\beta</dt-math> values by hovering over their corresponding
          diagram elements and observe the resulting change in the output.
        </figcaption>
      </figure>
      <script>
        (function() {
            (function() {
                var svg = d3.select("figure.figure#film-diagram").select("svg");
                var features = [0.9, -0.5, -0.8];
                var gammas = [-1.6, 0.8, 1.8];
                var betas = [1.0, 0.5, -0.5];
                var data = [];
                for (var i = 0; i < 3; i++) {
                    data.push({feature: features[i], gamma: gammas[i], beta: betas[i]});
                }
                var amplitudeScale = d3.scaleSqrt().domain([0.0, 2.0]).range([0.0, 0.8]).clamp(true);
                var mouseScale = d3.scaleLinear().domain([0.0, 40.0]).range([2.0, -2.0]).clamp(true);
                svg.select("g#mlp-figure g#input-layer").selectAll("g.feature").data(data);
                svg.select("g#mlp-figure g#gamma").selectAll("g.feature").data(data);
                svg.select("g#mlp-figure g#beta").selectAll("g.feature").data(data);
                svg.select("g#mlp-figure g#scaled-layer").selectAll("g.feature").data(data);
                svg.select("g#mlp-figure g#shifted-layer").selectAll("g.feature").data(data);

                function updateSingle(selection, accessor) {
                    selection.selectAll("g.feature").each(function (d, i) {
                        var r = accessor(d);
                        var s = Math.sign(r) * amplitudeScale(Math.abs(r));
                        d3.select(this)
                          .select(".vector-patch")
                            .attr("opacity", Math.abs(s))
                            .attr("href", r < 0 ? "#vector-patch-negative" : "#vector-patch-positive");
                        d3.select(this)
                          .select(".figure-line")
                            .attr("transform", "matrix(" + [s, 0, 0, s, 20, 20] + ")");
                    });
                }

                function update() {
                    updateSingle(svg.select("g#mlp-figure g#input-layer"), function(d) { return d.feature; });
                    updateSingle(svg.select("g#mlp-figure g#gamma"), function(d) { return d.gamma; });
                    updateSingle(svg.select("g#mlp-figure g#beta"), function(d) { return d.beta; });
                    updateSingle(svg.select("g#mlp-figure g#scaled-layer"), function(d) { return d.gamma * d.feature; });
                    updateSingle(svg.select("g#mlp-figure g#shifted-layer"), function(d) { return d.gamma * d.feature + d.beta; });
                }

                update();

                svg.select("g#mlp-figure g#gamma")
                  .selectAll("g.feature")
                    .on("mousemove", function (d) {
                        d.gamma = mouseScale(d3.mouse(this)[1]);
                        update();
                    });
                svg.select("g#mlp-figure g#beta")
                  .selectAll("g.feature")
                    .on("mousemove", function (d, i) {
                        d.beta = mouseScale(d3.mouse(this)[1]);
                        update();
                    });
            })();
            (function () {
                var svg = d3.select("figure.figure#film-diagram").select("svg");
                var features = [
                    [[-0.6, -0.6,  0.8], [ 0.6,  0.7,  0.4], [-0.8,  0.8,  0.9]],
                    [[ 0.9, -0.1,  0.5], [-0.8, -0.7,  0.5], [-0.3, -0.9, -0.2]],
                    [[-0.5, -0.9,  0.6], [-0.2, -0.4,  0.2], [-0.6,  0.1, -0.3]]
                ];
                var gammas = [-1.6, 0.8, 1.8];
                var betas = [1.0, 0.5, -0.5];
                var data = [];
                var featureMapData = [[], [], []];
                for (var k = 0; k < 3; k++) {
                    for (var i = 0; i < 3; i++) {
                        for (var j = 0; j < 3; j++) {
                            var d = {feature: features[i][j][k], gamma: gammas[k], beta: betas[k]};
                            data.push(d);
                            featureMapData[2 - k].push(d);
                        }
                    }
                }
                var amplitudeScale = d3.scaleSqrt().domain([0.0, 2.0]).range([0.0, 0.8]).clamp(true);
                var mouseScale = d3.scaleLinear().domain([0.0, 40.0]).range([2.0, -2.0]).clamp(true);
                svg.select("g#cnn-figure g#input-layer").selectAll("g.feature").data(data);
                svg.select("g#cnn-figure g#gamma").selectAll("g.feature").data(featureMapData);
                svg.select("g#cnn-figure g#beta").selectAll("g.feature").data(featureMapData);
                svg.select("g#cnn-figure g#scaled-layer").selectAll("g.feature").data(data);
                svg.select("g#cnn-figure g#shifted-layer").selectAll("g.feature").data(data);

                function updateSingle(selection, accessor, offset) {
                    selection.selectAll("g.feature").each(function (d, i) {
                        var r = accessor(d);
                        var s = Math.sign(r) * amplitudeScale(Math.abs(r));
                        d3.select(this)
                          .select(".convolutional-patch")
                            .attr("opacity", Math.abs(s))
                            .attr("href", r < 0 ?  "#convolutional-patch-negative" : "#convolutional-patch-positive");
                        d3.select(this)
                          .select(".vector-patch")
                            .attr("opacity", Math.abs(s))
                            .attr("href", r < 0 ?  "#vector-patch-negative" : "#vector-patch-positive");
                        d3.select(this)
                          .select(".figure-line")
                            .attr("transform", "matrix(" + [s, 0, 0, s, offset, offset] + ")");
                    });
                }

                function update() {
                    updateSingle(svg.select("g#cnn-figure g#input-layer"), function(d) { return d.feature; }, 15);
                    updateSingle(svg.select("g#cnn-figure g#gamma"), function(d) { return d[0].gamma; }, 20);
                    updateSingle(svg.select("g#cnn-figure g#beta"), function(d) { return d[0].beta; }, 20);
                    updateSingle(svg.select("g#cnn-figure g#scaled-layer"), function(d) { return d.gamma * d.feature; }, 15);
                    updateSingle(svg.select("g#cnn-figure g#shifted-layer"), function(d) { return d.gamma * d.feature + d.beta; }, 15);
                }

                update();

                svg.select("g#cnn-figure g#gamma")
                  .selectAll("g.feature")
                    .on("mousemove", function (d) {
                        var newValue = mouseScale(d3.mouse(this)[1]);
                        for (var i = 0; i < 9; i++) {
                            d[i].gamma = newValue;
                        }
                        update();
                    });
                svg.select("g#cnn-figure g#beta")
                  .selectAll("g.feature")
                    .on("mousemove", function (d, i) {
                        var newValue = mouseScale(d3.mouse(this)[1]);
                        for (var i = 0; i < 9; i++) {
                            d[i].beta = newValue;
                        }
                        update();
                    });
            })();
        })();
      </script>
      <p>
        FiLM shares with HyperNetworks <dt-cite key="ha2016hypernetworks"></dt-cite>
        the architectural feature that a secondary neural network computes some
        of the parameter values in the primary network. From that perspective,
        the FiLM generator can be viewed as a specialized instance of a
        HyperNetwork which predicts the FiLM parameters of the FiLM-ed network.
      </p>
      <p>
        FiLM is closely related to gating: the latter can be viewed as a
        bias-less version of the former with sigmoidal scaling. Whereas gating
        is used to inhibit the expression of targeted features, FiLM can in
        theory be used to inhibit or enhance the expression of targeted
        features, flip their sign, or selectively threshold them (when combined
        with a ReLU nonlinearity). The impact of these additional capabilities
        is still an open area of investigation.
      </p>
      <p>
        Finally, as hinted at above, there exists a connection between
        attention, gating, FiLM, and mixture-of-experts models through bilinear
        transformations <dt-cite key="tenenbaum2000separating"></dt-cite>.
        Because this connection deserves more than a simple paragraph, we
        decided to devote a <a href="#bilinear-connection">separate section</a>
        of the article to it.
      </p>
      <!-- <p> -->
      <!--   Finally, although attempts to connect deep learning results to the way -->
      <!--   the brain works should always be treated carefully, it is interesting to -->
      <!--   note that the idea of feature-wise modulation finds a modest amount of -->
      <!--   support in the neuroscience literature. -->
      <!-- </p> -->
      <!-- <p> -->
      <!--   In an attempt to explore biologically plausible neuron models while -->
      <!--   drawing a parallel with multi-layer perceptrons, -->
      <!--   <dt-cite key="mel1992clusteron"></dt-cite> introduces the -->
      <!--   <em>Clusteron</em>, a neuron whose activations can be amplified by -->
      <!--   surrounding neurons. This behavior enables to extract non-linearity and -->
      <!--   high-order statistics from data. -->
      <!-- </p> -->
      <!-- <p> -->
      <!--   Work in <dt-cite key="boutonnet2015words"></dt-cite> provides new -->
      <!--   evidence that external language cues alter how visual information is -->
      <!--   processed in the brain. More precisely, it is observed that P1 signals, -->
      <!--   which are related to low-level visual features, are modulated while -->
      <!--   hearing specific words. -->
      <!-- </p> -->

      <hr />

      <h1 id="film-in-literature">Feature-wise affine transformations in the literature</h1>
      <p>
        Because of their very general nature and wide applicability,
        feature-wise affine transformations are sometimes treated as accessory
        to the proposed models to which they are applied. We believe there is
        value in connecting those methods, which is why part of this article is
        devoted to a literature review.
      </p>
      <p>
        In the interest of not being confusing to readers already familiar with
        these methods, we chose to stick to the nomenclature used in the
        original papers, but we do draw connections to the FiLM nomenclature
        where appropriate. Readers interested in those connections are
        encouraged to take a closer look at the model diagrams, in which
        elements relevant to the FiLM nomenclature have been color-coded and
        can be hovered over to reveal more information:
      </p>
      <figure class="l-body-outset figure" id="legend-diagram">
        <svg viewBox="0 0 744 80" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(50, 10)" class="film-generator">
            <rect width="180" height="60" class="figure-group figure-box figure-film-generator"/>
            <text x="90" y="30" dy="0.4em" style="text-anchor: middle;" class="figure-text">figure element</text>
          </g>
          <g transform="translate(283, 10)" class="film-layer">
            <rect width="180" height="60" class="figure-group figure-box figure-film-layer"/>
            <text x="90" y="30" dy="0.4em" style="text-anchor: middle;" class="figure-text">figure element</text>
          </g>
          <g transform="translate(515, 10)" class="filmed-network">
            <rect width="180" height="60" class="figure-group figure-box figure-filmed-network"/>
            <text x="90" y="30" dy="0.4em" style="text-anchor: middle;" class="figure-text">figure element</text>
          </g>
        </svg>
        <figcaption>
          In this section, figure elements that are color-coded in red
          (FiLM generator), orange (FiLM layer), and blue (FiLM-ed network) can
          be hovered over to reveal more information.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("figure.figure#legend-diagram").select("svg");
            svg.select("g.film-generator")
                .on("mouseenter", function () {
                    svg.select("g.film-generator > text").text("FiLM generator");
                    svg.select("g.film-generator > rect").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-generator > text").text("figure element");
                    svg.select("g.film-generator > rect").style("fill", null)
                });
            svg.select("g.film-layer")
                .on("mouseenter", function () {
                    svg.select("g.film-layer > text").text("FiLM layer");
                    svg.select("g.film-layer > rect").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-layer > text").text("figure element");
                    svg.select("g.film-layer > rect").style("fill", null)
                });
            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    svg.select("g.filmed-network > text").text("FiLM-ed network");
                    svg.select("g.filmed-network > rect").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    svg.select("g.filmed-network > text").text("figure element");
                    svg.select("g.filmed-network > rect").style("fill", null)
                });
        })();
      </script>
      <p>
        Let's pretend that we have an input <dt-math>\mathbf{x}</dt-math> and
        some contextual information <dt-math>\mathbf{z}</dt-math> which we
        process using a neural network to compute some output. Perhaps the
        simplest way of combining the two is to concatenate them and pass the
        augmented input through the neural network, crossing our fingers in hope
        that the network will implicitly learn to combine the two in a sensible
        manner. This approach suffers from the fact that the conditioning
        information has a direct influence only in the first few layers of the
        neural network; the deeper we get, the more diffuse and indirect its
        influence becomes.
      </p>
      <p>
        An improvement over this idea would be to concatenate
        <dt-math>\mathbf{z}</dt-math> to the input of <em>all</em> layers in the
        neural network. This is in fact the approach adopted by the conditional
        variant of DCGAN <dt-cite key="radford2016unsupervised"></dt-cite>, a
        well-recognized class of network architectures for generative
        adversarial networks (GANs). The class label is broadcasted as a feature
        map and is concatenating to the input of convolutional and transposed
        convolutional layers in the generator and discriminator networks.
      </p>
      <figure class="l-body-outset figure" id="dcgan-diagram">
        <svg viewBox="0 0 744 350" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" id="arrow-right"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" id="arrow-up"/>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-left"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-down"/>
          </defs>
          <g transform="translate(10, 10)">
            <g class="filmed-network">
              <rect x="180" y="0" width="364" height="300" class="figure-group figure-box"/>
              <text x="190" y="15" dy="0.4em" class="figure-text">concatenation-based conditioning</text>
            </g>
            <g transform="translate(0, 70)">
              <rect x="0" y="0" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="10" y="10" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="20" y="20" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">input</text>
            </g>
            <g transform="translate(200, 102)">
              <rect width="40" height="116" class="figure-element figure-box"/>
              <text x="20" y="58" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 58)" class="figure-text">concatenate</text>
            </g>
            <g transform="translate(270, 70)">
              <rect x="0" y="0" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="10" y="10" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="20" y="20" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">input</text>
              <rect x="40" y="40" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <text x="50" y="50" dy="0.4em" class="figure-text">class</text>
            </g>
            <g transform="translate(480, 102)">
              <rect width="40" height="116" class="figure-element figure-box"/>
              <text x="20" y="58" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 58)" class="figure-text">convolution</text>
            </g>
            <g transform="translate(564, 70)">
              <rect x="0" y="0" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="10" y="10" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="20" y="20" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">output</text>
            </g>
            <path d="M 160 160 L 200 160" class="figure-line"/>
            <use href="#arrow-right" transform="translate(200, 160)" class="figure-path"/>
            <path d="M 240 160 L 270 160" class="figure-line"/>
            <use href="#arrow-right" transform="translate(270, 160)" class="figure-path"/>
            <path d="M 450 160 L 480 160" class="figure-line"/>
            <use href="#arrow-right" transform="translate(480, 160)" class="figure-path"/>
            <path d="M 520 160 L 564 160" class="figure-line"/>
            <use href="#arrow-right" transform="translate(564, 160)" class="figure-path"/>
            <path d="M 220 218 L 220 310" class="figure-line"/>
            <use href="#arrow-up" transform="translate(220, 218)" class="figure-path"/>
            <text x="220" y="320" dy="0.4em" style="text-anchor: middle;" class="figure-text">class</text>
          </g>
        </svg>
        <figcaption>
          Concatenation-based conditioning in a convolutional layer. The class
          is broadcasted to the feature map size and concatenated with the input
          along the channel axis before applying the convolution.
        </figcaption>
      </figure>
      <p>
        An equivalent &mdash; and more efficient &mdash; way to express this
        operation is in the form of a feature-wise, class-conditional biasing of
        the output of the layer. To understand why, consider a simple
        fully-connected linear layer applied to the concatenation of
        <dt-math>\mathbf{x}</dt-math> and <dt-math>\mathbf{z}</dt-math>.
        <dt-fn>
          The same argument applies to convolutional networks, provided we
          ignore the border effects due to zero-padding or use an alternative
          form of padding, like reflection-padding.
        </dt-fn>
      </p>
      <figure class="l-body-outset figure" id="concatenation-as-biasing">
        <svg viewBox="0 0 744 370" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 8 0 a 6 6 0 0 1 6 6 l 0 14 l -20 0 Z" id="column-top"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="column-middle"/>
            <path d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -8 0 a 6 6 0 0 1 -6 -6 Z" id="column-bottom"/>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -20 0 Z" id="matrix-top-left"/>
            <path d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 14l -20 0 Z" id="matrix-top-right"/>
            <path d="M 0 0 l 20 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z" id="matrix-bottom-left"/>
            <path d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -14 0 Z" id="matrix-bottom-right"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="matrix-center"/>
            <path d="M 0 0 C 12 0 0 30 12 30 C 0 30 12 60 0 60" id="vertical-curly-brace"/>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" id="arrow-right"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" id="arrow-up"/>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-left"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-down"/>
          </defs>
          <rect x="10" y="10" height="350" width="724" class="figure-group figure-box"/>
          <g transform="translate(60, 20)">
            <g transform="translate(10, 100)">
              <g>
                <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(40, 0)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(60, 0)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(80, 0)" class="figure-element"/>
                <use href="#matrix-top-right" transform="translate(100, 0)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(60, 20)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(80, 20)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(100, 20)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(60, 40)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(80, 40)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(100, 40)" class="figure-element"/>
                <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(40, 60)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(60, 60)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(80, 60)" class="figure-element"/>
                <use href="#matrix-bottom-right" transform="translate(100, 60)" class="figure-element"/>
                <text x="60" y="90" dy="0.4em" style="text-anchor: middle;" class="figure-text">W</text>
              </g>
              <g transform="translate(125, 0)">
                <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
                <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
                <use href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
                <use href="#column-middle" transform="translate(0, 60)" class="figure-element"/>
                <use href="#column-middle" transform="translate(0, 80)" class="figure-element"/>
                <use href="#column-bottom" transform="translate(0, 100)" class="figure-element"/>
                <use href="#vertical-curly-brace" transform="translate(25, 0)" class="figure-line"/>
                <use href="#vertical-curly-brace" transform="translate(25, 60)" class="figure-line"/>
                <text x="45" y="30" dy="0.4em" style="font-weight: bold;" class="figure-text">x</text>
                <text x="45" y="90" dy="0.4em" style="font-weight: bold;" class="figure-text">z</text>
              </g>
            </g>
            <g transform="translate(240, 10)">
              <g>
                <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(40, 0)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
                <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(40, 60)" class="figure-element"/>
              </g>
              <g transform="translate(65, 0)">
                <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
                <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
                <use href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
                <use href="#vertical-curly-brace" transform="translate(25, 0)" class="figure-line"/>
                <text x="45" y="30" dy="0.4em" style="font-weight: bold;" class="figure-text">x</text>
              </g>
            </g>
            <g transform="translate(240, 240)">
              <g>
                <use href="#matrix-center" transform="translate(0, 0)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
                <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(0, 60)" class="figure-element"/>
                <use href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
                <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element"/>
              </g>
              <g transform="translate(65, 0)">
                <use href="#column-middle" transform="translate(0, 0)" class="figure-element"/>
                <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
                <use href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
                <use href="#vertical-curly-brace" transform="translate(25, 0)" class="figure-line"/>
                <text x="45" y="30" dy="0.4em" style="font-weight: bold;" class="figure-text">z</text>
              </g>
            </g>
            <g transform="translate(405, 10)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
            </g>
            <g transform="translate(405, 240)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
            </g>
            <g transform="translate(505, 150)">
              <circle cx="10" cy="10" r="10" class="figure-element"/>
              <path d="M 10 5 l 0 10" class="figure-line"/>
              <path d="M 5 10 l 10 0" class="figure-line"/>
            </g>
            <g transform="translate(605, 120)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
            </g>
            <path d="M 175 110 C 205 110 195 40 235 50" class="figure-line"/>
            <use href="#arrow-right" transform="translate(235, 50)" class="figure-path"/>
            <path d="M 175 210 C 205 210 195 290 235 280" class="figure-line"/>
            <use href="#arrow-right" transform="translate(235, 280)" class="figure-path"/>
            <path d="M 365 50 l 30 0" class="figure-line"/>
            <use href="#arrow-right" transform="translate(395, 50)" class="figure-path"/>
            <path d="M 365 280 l 30 0" class="figure-line"/>
            <use href="#arrow-right" transform="translate(395, 280)" class="figure-path"/>
            <path d="M 435 50 L 509 50 a 6 6 0 0 1 6 6 L 515 150" class="figure-line"/>
            <use href="#arrow-down" transform="translate(515, 150)" class="figure-path"/>
            <path d="M 435 280 L 509 280 a 6 6 0 0 0 6 -6 L 515 170" class="figure-line"/>
            <use href="#arrow-up" transform="translate(515, 170)" class="figure-path"/>
            <text x="435" y="295" class="figure-text">conditional bias</text>
            <path d="M 525 160 l 70 0" class="figure-line"/>
            <use href="#arrow-right" transform="translate(595, 160)" class="figure-path"/>
          </g>
        </svg>
        <figcaption>
          Concatenation can be viewed as conditional biasing by expressing the
          matrix-vector product as a two-stage process.
        </figcaption>
      </figure>
      <p>
        Each vector product between <dt-math>\mathbf{z}</dt-math> and its
        corresponding subset of a row of the weight matrix can be thought of
        as a bias that gets added to the corresponding output feature.
      </p>
      <p>
        Conditional biasing of layers in the neural network is itself employed
        in PixelCNN <dt-cite key="oord2016conditional"></dt-cite> and WaveNet
        <dt-cite key="oord2016wavenet"></dt-cite>, two recent advances in
        autoregressive modeling of image and audio data, respectively.
      </p>
      <p>
        In its simplest form, conditioning in PixelCNN models is achieved by
        adding feature-wise, class-conditional biases to the output of all
        convolutional layers. In FiLM parlance, this means inserting FiLM layers
        after each convolutional layer and expressing the FiLM-generating
        network as an embedding lookup on the class labels, with the scaling
        coefficients set to a constant value of 1.
        <dt-fn>
          The authors also describe a location-dependent biasing scheme which
          cannot be expressed in terms of FiLM layers due to the absence of the
          feature-wise property.
        </dt-fn>
      </p>
      <figure class="l-body-outset figure" id="pixelcnn-diagram">
        <figcaption>
          A PixelCNN layer is conditioned by biasing its sigmoidal and
          hyperbolic tangent layers as a function of a high-level image
          description.
        </figcaption>
      </figure>
      <p>
        WaveNet describes two ways in which conditional biasing allows external
        information to modulate the behavior of the model:
      </p>
      <ol>
        <li>
          <strong>Global conditioning</strong> applies the same conditional
          bias to the whole generated sequence and is used e.g. to condition on
          speaker identity.
        </li>
        <li>
          <strong>Local conditioning</strong> applies a conditional bias which
          varies across time steps of the generated sequence and is used e.g.
          to let linguistic features in a text-to-speech (TTS) model influence
          which sounds are produced.
        </li>
      </ol>
      <p>
        Like for PixelCNN, both approaches can be viewed as inserting FiLM
        layers after each convolutional layer. The main difference lies in the
        way in which the FiLM-generating network is defined: global conditioning
        expresses the FiLM-generating network as an embedding lookup which is
        broadcasted to the whole time series, whereas local conditioning
        expresses it as a mapping from an input sequence of conditioning
        information to an output sequence of FiLM parameters.
      </p>
      <p>
        We can also condition via <em>multiplicative</em> interactions instead
        of additive interactions, like is the case for feature-wise sigmoidal
        gating. The idea is to scale each feature or feature map by a scalar
        between <dt-math>0</dt-math> and <dt-math>1</dt-math> that is a function
        of the conditioning information. This constraint is oftentimes enforced
        via a sigmoid layer, hence the name. Intuitively, sigmoidal gating
        allows the conditioning information to select which features are passed
        forward and which are zeroed out.
      </p>
      <p>
        In the FiLM nomenclature, sigmoidal gating would correspond to a
        bias-less FiLM layer with sigmoidal scaling.
      </p>
      <p>
        Examples of application include the Gated-Attention architecture
        <dt-cite key="chaplot2017gated"></dt-cite>, which uses feature-wise
        sigmoidal gating to fuse linguisting and visual inputs in the context of
        a reinforcement learning agent trained to follow simple natural language
        instructions in the VizDoom <dt-cite key="kempa2016vizdoom"></dt-cite>
        3D environment.
      </p>
      <figure class="l-body-outset figure" id="gated-attention-diagram">
        <svg viewBox="0 0 744 400" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" id="arrow-right"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" id="arrow-up"/>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-left"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-down"/>
          </defs>
          <g transform="translate(59, 10)">
            <g class="filmed-network">
              <rect x="145" y="26" width="430" height="338" class="figure-group figure-box figure-filmed-network"/>
              <text x="155" y="44" class="figure-text">gated-attention multimodal fusion unit</text>
            </g>
            <g transform="translate(-36, 24)">
              <rect x="0" y="0" width="140" height="140" class="figure-element figure-box"/>
              <rect x="10" y="10" width="140" height="140" class="figure-element figure-box"/>
              <rect x="20" y="20" width="140" height="140" class="figure-element figure-box"/>
              <rect x="30" y="30" width="140" height="140" class="figure-element figure-box"/>
              <text x="100" y="100" dy="0.4em" style="text-anchor: middle;" class="figure-text">image representation</text>
            </g>
            <g transform="translate(69, 207)">
              <rect width="40" height="164" class="figure-element figure-box"/>
              <text x="20" y="82" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 82)" class="figure-text">instruction representation</text>
            </g>
            <g transform="translate(400, 289)" class="film-generator">
              <ellipse rx="20" ry="20" class="figure-element figure-film-generator"/>
              <text x="0" y="0" dy="0.4em" style="text-anchor: middle;" class="figure-text">σ</text>
            </g>
            <g transform="translate(215, 233)" class="film-generator">
              <rect width="40" height="112" class="figure-element figure-box figure-film-generator"/>
              <text x="102.5" y="47" style="text-anchor: middle;" class="figure-text figure-film-generator-text"></text>
              <text x="20" y="56" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 56)" class="figure-text">linear</text>
            </g>
            <g transform="translate(400, 145)" class="film-layer">
              <ellipse rx="20" ry="20" class="figure-element figure-film-layer"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
              <text x="0" y="-25" style="text-anchor: middle;" class="figure-text"> </text>
            </g>
            <path d="M 109 289 L 214 289" class="figure-line"/>
            <use href="#arrow-right" transform="translate(214, 289)" class="figure-path"/>
            <path d="M 133 145 L 380 145" class="figure-line"/>
            <use href="#arrow-right" transform="translate(380, 145)" class="figure-path"/>
            <path d="M 255 289 L 380 289" style="fill: #f44336; stroke: #f44336;" class="figure-line"/>
            <use href="#arrow-right" style="fill: #f44336; stroke: #f44336;" transform="translate(380, 289)" class="figure-path"/>
            <path d="M 420 145 L 594 145" class="figure-line"/>
            <use href="#arrow-right" transform="translate(594, 145)" class="figure-path"/>
            <path d="M 400 165 L 400 269" class="figure-line"/>
            <use href="#arrow-up" transform="translate(400, 165)" class="figure-path"/>
          </g>
        </svg>
        <figcaption>
          Gated-attention fusion unit. The instruction representation is mapped
          to a feature vector with as many elements as the number of image
          representation feature maps through a sigmoidal layer. This feature
          vector is then multiplied element-wise &mdash; using broadcasting
          &mdash; with the image representation.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("figure.figure#gated-attention-diagram").select("svg");
            svg.selectAll("g.film-generator")
                .on("mouseenter", function () {
                    svg.select("g.film-generator > text.figure-film-generator-text").text("FiLM generator");
                    svg.selectAll("g.film-generator > .figure-film-generator").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-generator > text.figure-film-generator-text").text("");
                    svg.selectAll("g.film-generator > .figure-film-generator").style("fill", null);
                });
            svg.select("g.film-layer")
                .on("mouseenter", function () {
                    svg.select("g.film-layer > text").text("FiLM layer");
                    svg.select("g.film-layer > .figure-film-layer").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-layer > text").text("");
                    svg.select("g.film-layer > .figure-film-layer").style("fill", null);
                });
            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    svg.select("g.filmed-network > text").text("FiLM-ed layer");
                    svg.selectAll("g.filmed-network > .figure-filmed-network").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    svg.select("g.filmed-network > text").text("gated-attention multimodal fusion unit");
                    svg.selectAll("g.filmed-network > .figure-filmed-network").style("fill", null);
                });
        })();
      </script>
      <p>
        Sometimes the sigmoidal restriction can be lifted, as is the case for
        the Gated-Attention Reader <dt-cite key="dhingra2017gated"></dt-cite>.
        The model extracts information from a text by conditioning the document
        reading network on an query.  Its architecture is formed of multiple
        Gated-Attention modules, which involve elementwise multiplications
        between document representation tokens and token-specific query
        representations extracted via soft attention on the query representation
        tokens.
      </p>
      <p>
        By combining conditional biasing and conditional scaling, we obtain the
        FiLM layer, which implements a conditional feature-wise affine
        transformation. Several variants of FiLM can be found in the literature.
      </p>
      <p>
        We can use FiLM layers to condition a visual processing pipeline to
        answer textual questions about an image. In
        <dt-cite key="perez2017learning"></dt-cite>, and in its expanded
        version <dt-cite key="perez2017film"></dt-cite>, a visual reasoning
        model is trained on the CLEVR dataset <dt-cite key="johnson2017clevr"></dt-cite>
        to answer synthetic questions about a synthetic input image.
      </p>
      <figure class="l-body-outset figure" id="clevr-diagram">
        <svg viewBox="0 0 744 500" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" id="arrow-right"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" id="arrow-up"/>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-left"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-down"/>
          </defs>
          <g transform="translate(10, 20)" class="film-generator">
            <rect x="0" y="0" width="221" height="446" class="figure-group figure-box figure-film-generator"/>
            <text x="10" y="15" dy="0.4em" class="figure-text">linguistic pipeline</text>
            <g transform="translate(27, 45)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">Are</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 95)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">there</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 145)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">more</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 195)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">cubes</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 245)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">than</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 295)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">yellow</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 345)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">things</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 395)">
              <rect x="63" y="0" width="113" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">linear</text>
            </g>
          </g>
          <g transform="translate(250, 20)" class="filmed-network">
            <rect x="0" y="30" width="260" height="326" class="figure-group figure-box figure-filmed-network"/>
            <text x="130" y="0" style="text-anchor: middle;" class="figure-text">Answer: yes</text>
            <path d="M 130 5 L 130 59" class="figure-line"/>
            <use href="#arrow-up" transform="translate(130, 5)" class="figure-path"/>
            <text x="10" y="45" dy="0.4em" class="figure-text">visual pipeline</text>
            <g transform="translate(58, 303)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="30" y="256" dy="0.4em" style="text-anchor: middle;" class="figure-text">feature extractor</text>
            </g>
            <g transform="translate(58, 241)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="30" y="256" dy="0.4em" style="text-anchor: middle;" class="figure-text">residual block 1</text>
              <path d="M 72 38 L 72 64" class="figure-line"/>
            </g>
            <g transform="translate(58, 182)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="30" y="256" dy="0.4em" style="text-anchor: middle;" class="figure-text">residual block 2</text>
              <path d="M 72 38 L 72 64" class="figure-line"/>
            </g>
            <g transform="translate(58, 123)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="30" y="256" dy="0.4em" style="text-anchor: middle;" class="figure-text">residual block N</text>
              <text x="30" y="288" style="text-anchor: middle;" class="figure-text">...</text>
              <path d="M 72 38 L 72 64" class="figure-line"/>
            </g>
            <g transform="translate(58, 59)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="170" y="261" class="figure-text">classifier</text>
              <path d="M 72 38 L 72 64" class="figure-line"/>
            </g>
          </g>
          <g transform="translate(360.588715, 40.914715)" class="style-transfer-network">
            <title>residual block detail</title>
            <rect x="165.604" y="13.294" width="201.987" height="379.264" class="figure-group figure-box figure-dashed"/>
            <g transform="translate(86.588493, 97.835014)">
              <rect x="122.142" y="237.233" width="143.734" height="37.366" class="figure-element figure-box"/>
              <text x="153.606" y="135.187" transform="translate(-4.451978, 125.642685)" class="figure-text">convolution</text>
            </g>
            <g transform="translate(86.588539, 37.50499)">
              <rect x="122.142" y="237.233" width="143.734" height="37.366" class="figure-element figure-box"/>
              <text x="153.606" y="135.187" transform="translate(-4.451978, 125.642685)" class="figure-text">ReLU</text>
            </g>
            <g transform="translate(86.588539, -22.825003)">
              <rect x="122.142" y="237.233" width="143.734" height="37.366" class="figure-element figure-box"/>
              <text x="153.606" y="135.187" transform="translate(-4.451978, 125.642685)" class="figure-text">convolution</text>
            </g>
            <g transform="translate(86.588539, -83.154991)">
              <rect x="122.142" y="237.233" width="143.734" height="37.366" class="figure-element figure-box"/>
              <text x="153.606" y="135.187" transform="translate(-4.451978, 125.642685)" class="figure-text">batch normalization</text>
            </g>
            <g transform="translate(86.588539, -143.485001)" class="film-layer">
              <rect x="122.142" y="237.233" width="143.734" height="37.366" class="figure-element figure-box figure-film-layer"/>
              <text x="170.177" y="260.83" class="figure-text">FiLM</text>
            </g>
            <g transform="translate(86.588493, -203.815002)">
              <rect x="122.142" y="237.233" width="143.734" height="37.366" class="figure-element figure-box"/>
              <text x="170.177" y="260.83" class="figure-text">ReLU</text>
            </g>
            <path d="M 280.598 411.296 L 280.598 372.434" class="figure-line"/>
            <path d="M 280.598 335.068 L 280.598 312.104" class="figure-line"/>
            <path d="M 280.598 274.738 L 280.598 251.774" class="figure-line"/>
            <path d="M 280.598 214.408 L 280.598 191.444" class="figure-line"/>
            <path d="M 280.598 154.078 L 280.598 131.114" class="figure-line"/>
            <path d="M 280.598 93.748 L 280.598 70.784" class="figure-line"/>
            <path d="M 280.598 33.418 L 280.598 -3.825" class="figure-line"/>
          </g>
          <path d="M 215.406 436.642 L 263.004 436.642 L 263.004 163.625 L 309.168 163.625" class="figure-line"/>
          <path d="M 309.168 281.318 L 263.004 281.318" class="figure-line"/>
          <path d="M 309.168 222.472 L 263.004 222.472" class="figure-line"/>
          <rect x="309.168" y="400" width="144" height="96" id="image-placeholder">
            <title>image placeholder</title>
          </rect>
          <path d="M 537.09 153.346 L 569.319 153.346" class="figure-line"/>
          <text x="269.011" y="156.492" class="figure-text"><tspan>β</tspan><tspan class="subscript">N</tspan><tspan>, γ</tspan><tspan class="subscript">N</tspan></text>
          <text x="269.011" y="215.338" class="figure-text"><tspan>β</tspan><tspan class="subscript">2</tspan><tspan>, γ</tspan><tspan class="subscript">2</tspan></text>
          <text x="116.991" y="51.162" class="figure-text" transform="translate(152.019623, 223.021576)"><tspan>β</tspan><tspan class="subscript">1</tspan><tspan>, γ</tspan><tspan class="subscript">1</tspan></text>
          <text x="537.33" y="146.679" class="figure-text"><tspan>β</tspan><tspan class="subscript">1</tspan><tspan>, γ</tspan><tspan class="subscript">1</tspan></text>
          <path d="M 453.168 262.482 L 526.193 54.048" class="figure-line figure-dashed"/>
          <!-- <path d="M 453.168 300 L 526.193 433.633" class="figure-line figure-dashed"/> -->
          <!-- <path d="M 102.161 84.791 C 99.382 85.79 96.785 87.236 94.471 89.071 L 96.021 84.791 L 94.471 80.511 C 96.785 82.346 99.382 83.791 102.161 84.791 Z" class="figure-path"/> -->
          <!-- <path d="M 102.161 135.055 C 99.382 136.054 96.785 137.5 94.471 139.335 L 96.021 135.055 L 94.471 130.775 C 96.785 132.61 99.382 134.055 102.161 135.055 Z" class="figure-path"/> -->
          <!-- <path d="M 102.161 185.32 C 99.382 186.319 96.785 187.765 94.471 189.6 L 96.021 185.32 L 94.471 181.04 C 96.785 182.875 99.382 184.32 102.161 185.32 Z" class="figure-path"/> -->
          <!-- <path d="M 102.161 235.584 C 99.382 236.583 96.785 238.029 94.471 239.864 L 96.021 235.584 L 94.471 231.304 C 96.785 233.139 99.382 234.584 102.161 235.584 Z" class="figure-path"/> -->
          <!-- <path d="M 102.161 285.849 C 99.382 286.848 96.785 288.294 94.471 290.129 L 96.021 285.849 L 94.471 281.569 C 96.785 283.404 99.382 284.849 102.161 285.849 Z" class="figure-path"/> -->
          <!-- <path d="M 102.161 336.113 C 99.382 337.112 96.785 338.558 94.471 340.393 L 96.021 336.113 L 94.471 331.833 C 96.785 333.668 99.382 335.113 102.161 336.113 Z" class="figure-path"/> -->
          <!-- <path d="M 102.161 386.377 C 99.382 387.376 96.785 388.822 94.471 390.657 L 96.021 386.377 L 94.471 382.097 C 96.785 383.932 99.382 385.377 102.161 386.377 Z" class="figure-path"/> -->
          <!-- <path d="M 309.301 163.625 C 306.522 164.624 303.925 166.07 301.611 167.905 L 303.161 163.625 L 301.611 159.345 C 303.925 161.18 306.522 162.625 309.301 163.625 Z" class="figure-path"/> -->
          <!-- <path d="M 309.301 222.471 C 306.522 223.47 303.925 224.916 301.611 226.751 L 303.161 222.471 L 301.611 218.191 C 303.925 220.026 306.522 221.471 309.301 222.471 Z" class="figure-path"/> -->
          <!-- <path d="M 309.301 281.317 C 306.522 282.316 303.925 283.762 301.611 285.597 L 303.161 281.317 L 301.611 277.037 C 303.925 278.872 306.522 280.317 309.301 281.317 Z" class="figure-path"/> -->
          <!-- <path d="M 569.319 153.346 C 566.54 154.345 563.943 155.791 561.629 157.626 L 563.179 153.346 L 561.629 149.066 C 563.943 150.901 566.54 152.346 569.319 153.346 Z" class="figure-path"/> -->
          <!-- <path d="M 158.704 116.372 C 157.704 113.593 156.259 110.996 154.424 108.682 L 158.704 110.232 L 162.984 108.682 C 161.149 110.996 159.704 113.593 158.704 116.372 Z" class="figure-path"/> -->
          <!-- <path d="M 158.704 166.637 C 157.704 163.858 156.259 161.261 154.424 158.947 L 158.704 160.497 L 162.984 158.947 C 161.149 161.261 159.704 163.858 158.704 166.637 Z" class="figure-path"/> -->
          <!-- <path d="M 158.704 216.901 C 157.704 214.122 156.259 211.525 154.424 209.211 L 158.704 210.761 L 162.984 209.211 C 161.149 211.525 159.704 214.122 158.704 216.901 Z" class="figure-path"/> -->
          <!-- <path d="M 158.704 267.166 C 157.704 264.387 156.259 261.79 154.424 259.476 L 158.704 261.026 L 162.984 259.476 C 161.149 261.79 159.704 264.387 158.704 267.166 Z" class="figure-path"/> -->
          <!-- <path d="M 158.704 317.43 C 157.704 314.651 156.259 312.054 154.424 309.74 L 158.704 311.29 L 162.984 309.74 C 161.149 312.054 159.704 314.651 158.704 317.43 Z" class="figure-path"/> -->
          <!-- <path d="M 158.704 367.694 C 157.704 364.915 156.259 362.318 154.424 360.004 L 158.704 361.554 L 162.984 360.004 C 161.149 362.318 159.704 364.915 158.704 367.694 Z" class="figure-path"/> -->
          <!-- <path d="M 158.704 417.959 C 157.704 415.18 156.259 412.583 154.424 410.269 L 158.704 411.819 L 162.984 410.269 C 161.149 412.583 159.704 415.18 158.704 417.959 Z" class="figure-path"/> -->
          <!-- <path d="M 381.168 361.851 C 382.168 364.629 383.613 367.227 385.448 369.541 L 381.168 367.991 L 376.888 369.541 C 378.723 367.227 380.169 364.63 381.168 361.851 Z" class="figure-path"/> -->
          <!-- <path d="M 381.168 300 C 382.168 302.778 383.613 305.376 385.448 307.69 L 381.168 306.14 L 376.888 307.69 C 378.723 305.376 380.169 302.779 381.168 300 Z" class="figure-path"/> -->
          <!-- <path d="M 381.168 241.154 C 382.168 243.932 383.613 246.53 385.448 248.844 L 381.168 247.294 L 376.888 248.844 C 378.723 246.53 380.169 243.933 381.168 241.154 Z" class="figure-path"/> -->
          <!-- <path d="M 381.168 118.558 C 382.168 121.336 383.613 123.934 385.448 126.248 L 381.168 124.698 L 376.888 126.248 C 378.723 123.934 380.169 121.337 381.168 118.558 Z" class="figure-path"/> -->
          <!-- <path d="M 381.168 32.097 C 382.168 34.875 383.613 37.473 385.448 39.787 L 381.168 38.237 L 376.888 39.787 C 378.723 37.473 380.169 34.876 381.168 32.097 Z" class="figure-path"/> -->
          <!-- <path d="M 641.186 413.349 C 642.186 416.127 643.631 418.725 645.466 421.039 L 641.186 419.489 L 636.906 421.039 C 638.741 418.725 640.187 416.128 641.186 413.349 Z" class="figure-path"/> -->
          <!-- <path d="M 641.186 353.019 C 642.186 355.797 643.631 358.395 645.466 360.709 L 641.186 359.159 L 636.906 360.709 C 638.741 358.395 640.187 355.798 641.186 353.019 Z" class="figure-path"/> -->
          <!-- <path d="M 641.186 292.689 C 642.186 295.467 643.631 298.065 645.466 300.379 L 641.186 298.829 L 636.906 300.379 C 638.741 298.065 640.187 295.468 641.186 292.689 Z" class="figure-path"/> -->
          <!-- <path d="M 641.186 232.359 C 642.186 235.137 643.631 237.735 645.466 240.049 L 641.186 238.499 L 636.906 240.049 C 638.741 237.735 640.187 235.138 641.186 232.359 Z" class="figure-path"/> -->
          <!-- <path d="M 641.186 172.029 C 642.186 174.807 643.631 177.405 645.466 179.719 L 641.186 178.169 L 636.906 179.719 C 638.741 177.405 640.187 174.808 641.186 172.029 Z" class="figure-path"/> -->
          <!-- <path d="M 641.186 111.699 C 642.186 114.477 643.631 117.075 645.466 119.389 L 641.186 117.839 L 636.906 119.389 C 638.741 117.075 640.187 114.478 641.186 111.699 Z" class="figure-path"/> -->
          <!-- <path d="M 641.186 37.09 C 642.186 39.868 643.631 42.466 645.466 44.78 L 641.186 43.23 L 636.906 44.78 C 638.741 42.466 640.187 39.869 641.186 37.09 Z" class="figure-path"/> -->
        </svg>
        <figcaption>
          Visual reasoning model trained on CLEVR. The residual blocks of the
          visual pipeline are FiLM-ed, and the linguistic pipeline acts as the
          FiLM generator.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("figure.figure#clevr-diagram").select("svg");
            svg.append("image")
                .attrs({
                    "width": 144, "height": 96,
                    "x": svg.select("#image-placeholder").attr("x"),
                    "y": svg.select("#image-placeholder").attr("y"),
                    "href": "assets/clevr_input.jpg",
                });
            svg.select("g.film-generator")
                .on("mouseenter", function () {
                    svg.select("g.film-generator > text").text("FiLM generator");
                    svg.select("g.film-generator > rect").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-generator > text").text("linguistic pipeline");
                    svg.select("g.film-generator > rect").style("fill", null)
                });
            svg.select("g.film-layer")
                .on("mouseenter", function () {
                    svg.select("g.film-layer > text").text("FiLM layer");
                    svg.select("g.film-layer > rect").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-layer > text").text("FiLM");
                    svg.select("g.film-layer > rect").style("fill", null)
                });
            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    svg.select("g.filmed-network > text").text("FiLM-ed network");
                    svg.select("g.filmed-network > rect").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    svg.select("g.filmed-network > text").text("visual pipeline");
                    svg.select("g.filmed-network > rect").style("fill", null)
                });
            })();
      </script>
      <p>
        The model features a FiLM generator in the form of a linguistic pipeline
        extracting a question representation which is then linearly mapped to
        the FiLM parameter values. The visual pipeline is conditioned by
        inserting a FiLM layer in the residual pathway of each residual block of
        the convolutional neural network. The model is trained end-to-end on
        image-question-answer tuples.
      </p>
      <p>
        We can also leverage feature-wise affine transformations to condition a
        pre-trained network. In <dt-cite key="vries2017modulating"></dt-cite>,
        the visual pipeline of a visual question-answering (VQA) model is
        modulated by the model's linguistic pipeline through conditional batch
        normalization (CBN). The model is trained on the "oracle" sub-task of
        the GuessWhat?! task <dt-cite key="vries2017guesswhat"></dt-cite>
        &mdash; which features natural language questions on images answerable
        by yes, no, or N/A &mdash; as well as the VQAv1 dataset
        <dt-cite key="agrawal2015vqa"></dt-cite>.
      </p>
      <figure class="l-body-outset figure" id="guesswhat-diagram">
        <figcaption>
          <p style="margin-bottom: 8px;">
            Visual question-answering (VQA) model in in
            <dt-cite key="vries2017modulating"></dt-cite>. The feature-wise
            affine transformation inside the batch normalization layers of the
            pre-trained ResNet visual pipeline are modulated by the linguistic
            pipeline.
          </p>
          <p><em>
            N.B.: the visual pipeline architecture is simplified for
            illustrative purposes and is not representative of the actual
            ResNet architecture.
          </em></p>
        </figcaption>
      </figure>
      <p>
        The visual pipeline consists of a pre-trained residual network and is
        kept fixed throughout training. The linguistic pipeline interacts with
        the visual pipeline by predicting perturbations to the residual
        network's batch normalization parameters.
      </p>
      <p>
        CBN can be viewed as an instance of FiLM where the post-normalization
        feature-wise affine transformation is replaced with a FiLM layer.
      </p>
      <p>
        We can also use FiLM layers to condition a style transfer network on a
        chosen style image.
      </p>
      <p>
        In <dt-cite key="dumoulin2017learned"></dt-cite>, fast feedforward style
        transfer networks are extended to accommodate multiple styles by
        introducing conditional instance normalization (CIN) layers. Each style
        modeled by the network is associated with its own set of instance
        normalization parameters, and conditioning is achieved by assigning
        instance normalization parameters their corresponding value for the
        desired style.
      </p>
      <figure class="l-body-outset figure" id="alrfas-diagram">
        <svg viewBox="0 0 744 500" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" id="arrow-right"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" id="arrow-up"/>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-left"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-down"/>
          </defs>
          <g>
            <g class="filmed-network">
              <rect x="113" y="79" width="434" height="251" class="figure-group figure-box figure-filmed-network"/>
              <text x="118" y="97" class="figure-text">style transfer network</text>
            </g>
            <g transform="translate(128, 125)">
              <rect width="38" height="170" class="figure-element figure-box"/>
              <text x="19" y="85" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 19, 85)" class="figure-text">convolution</text>
            </g>
            <g transform="translate(182, 114)">
              <rect width="140" height="207" class="figure-element figure-box"/>
              <g transform="translate(18, 11)">
                <rect width="38" height="170" class="figure-element figure-box"/>
                <text x="19" y="85" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 19, 85)" class="figure-text">normalization</text>
              </g>
              <path d="M 56 96 l 28 0" class="figure-line"/>
              <use x="84" y="96" href="#arrow-right" class="figure-path"/>
              <g transform="translate(84, 11)" class="film-layer">
                <rect width="38" height="170" class="figure-element figure-box figure-film-layer"/>
                <text x="19" y="85" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 19, 85)" class="figure-text">affine transformation</text>
              </g>
              <text x="5" y="200" class="figure-text">instance norm.</text>
            </g>
            <g transform="translate(338, 125)">
              <rect width="38" height="170" class="figure-element figure-box"/>
              <text x="19" y="85" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 19, 85)" class="figure-text">convolution</text>
            </g>
            <g transform="translate(392, 114)">
              <rect width="140" height="207" class="figure-element figure-box"/>
              <g transform="translate(18, 11)">
                <rect width="38" height="170" class="figure-element figure-box"/>
                <text x="19" y="85" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 19, 85)" class="figure-text">normalization</text>
              </g>
              <path d="M 56 96 l 28 0" class="figure-line"/>
              <use x="84" y="96" href="#arrow-right" class="figure-path"/>
              <g transform="translate(84, 11)" class="film-layer">
                <rect width="38" height="170" class="figure-element figure-box figure-film-layer"/>
                <text x="19" y="85" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 19, 85)" class="figure-text">affine transformation</text>
              </g>
              <text x="5" y="200" class="figure-text">instance norm.</text>
            </g>
            <path d="M 165 210 l 35 0" class="figure-line"/>
            <use x="200" y="210" href="#arrow-right" class="figure-path"/>
            <path d="M 304 210 l 34 0" class="figure-line"/>
            <use x="338" y="210" href="#arrow-right" class="figure-path"/>
            <path d="M 375 210 l 35 0" class="figure-line"/>
            <use x="410" y="210" href="#arrow-right" class="figure-path"/>
            <path d="M 513 210 l 53 0" class="figure-line"/>
            <use x="566" y="210" href="#arrow-right" class="figure-path"/>
          </g>
          <image x="10" y="394" width="96" height="96" href="assets/cassis_cap_lombard_opus_196.jpg"/>
          <line x1="681" y1="58" x2="106" y2="58" class="figure-line"/>
          <use x="681" y="58" href="#arrow-right" class="figure-path"/>
          <path d="M 58 106 l 0 98 a 6 6 0 0 0 6 6 l 64 0" class="figure-line"/>
          <use x="128" y="210" href="#arrow-right" class="figure-path"/>
          <image x="10" y="10" width="96" height="96" href="assets/tuebingen_neckarfront.jpg"/>
          <line x1="681" y1="442" x2="106" y2="442" class="figure-line"/>
          <use x="681" y="442" href="#arrow-right" class="figure-path"/>
          <path d="M 58 394 l 0 -5 a 6 6 0 0 1 6 -6 l 166 0" class="figure-line"/>
          <use x="230" y="383" href="#arrow-right" class="figure-path"/>
          <image x="566" y="162" width="96" height="96" href="assets/tuebingen_neckarfront_cassis_cap_lombard_opus_196.jpg"/>
          <line x1="681" y1="210" x2="662" y2="210" class="figure-line"/>
          <use x="681" y="210" href="#arrow-right" class="figure-path"/>
          <g transform="translate(231, 339)" class="film-generator">
            <rect width="318" height="86" class="figure-group figure-box figure-film-generator"/>
            <text x="159" y="43" dy="0.4em" style="text-anchor: middle;" class="figure-text">style prediction network</text>
          </g>
          <path d="M 284 339 l 0 -44" class="figure-line"/>
          <use x="284" y="295" href="#arrow-up"/>
          <path d="M 495 339 l 0 -44" class="figure-line"/>
          <use x="495" y="295" href="#arrow-up"/>
          <g transform="translate(681, 26)">
            <rect width="56" height="448" class="figure-group figure-box"/>
            <text x="28" y="224" dy="0.4em" style="text-anchor: middle;" class="figure-text" transform="rotate(-90, 28, 224)">style transfer loss</text>
          </g>
        </svg>
        <figcaption>
          <p style="margin-bottom: 8px;">
            Fast, arbitrary artistic style transfer model. The style prediction
            network predicts the value of the instance normalization layers'
            feature-wise affine transformation parameters from the style image.
          </p>
          <p><em>
            N.B.: the style transfer network architecture is simplified for
            illustrative purposes and is not representative of the actual
            architecture.
          </em></p>
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("figure.figure#alrfas-diagram").select("svg");
            svg.select("g.film-generator")
                .on("mouseenter", function () {
                    svg.select("g.film-generator > text").text("FiLM generator");
                    svg.select("g.film-generator > rect").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-generator > text").text("style prediction network");
                    svg.select("g.film-generator > rect").style("fill", null);
                });
            svg.selectAll("g.film-layer")
                .on("mouseenter", function () {
                    svg.selectAll("g.film-layer").select("g.film-layer > text").text("FiLM layer");
                    svg.selectAll("g.film-layer").select("g.film-layer > rect").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    svg.selectAll("g.film-layer").select("g.film-layer > text").text("affine transformation");
                    svg.selectAll("g.film-layer").select("g.film-layer > rect").style("fill", null);
                });
            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    svg.select("g.filmed-network > text").text("FiLM-ed network");
                    svg.select("g.filmed-network > rect").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    svg.select("g.filmed-network > text").text("style transfer network");
                    svg.select("g.filmed-network > rect").style("fill", null);
                });
        })();
      </script>
      <p>
        This intuition is pushed further by <dt-cite key="ghiasi2017exploring"></dt-cite>
        with the introduction of a <em>style prediction network</em> which is
        trained jointly with the style transfer network to predict the instance
        normalization parameters directly from a given style image.
      </p>
      <p>
        Like CBN, CIN can be seen as an instance of FiLM where the
        post-normalization feature-wise affine transformation is replaced with a
        FiLM layer. The main differentiator between <dt-cite key="dumoulin2017learned"></dt-cite>
        and <dt-cite key="ghiasi2017exploring"></dt-cite> is the FiLM generator
        implementation: in the former the generator is a simple embedding
        lookup, whereas in the latter the generator is a convolutional neural
        network.
      </p>
      <p>
        So far, the distinction between the FiLM generator and the FiLM-ed
        network has been rather clear, but it is not strictly necessary. As an
        example, <dt-cite key="huang2017arbitrary"></dt-cite> proposes an
        alternative for fast and arbitrary style transfer in the form of an
        adaptive instance normalization (AdaIN) layer.
      </p>
      <figure class="l-body-outset figure" id="adain-diagram">
        <svg viewBox="0 0 744 500" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" id="arrow-right"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" id="arrow-up"/>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-left"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-down"/>
            <linearGradient id="linearStroke" x1="0%" y1="0%" x2="0%" y2="100%" spreadMethod="pad">
              <stop offset="0%"   stop-color="#2196f3"/>
              <stop offset="100%" stop-color="#f44336"/>
            </linearGradient>
            <linearGradient id="linearFill" x1="0%" y1="0%" x2="0%" y2="100%" spreadMethod="pad">
              <stop offset="0%"   stop-color="#90caf9"/>
              <stop offset="100%" stop-color="#ef9a9a"/>
            </linearGradient>
          </defs>
          <image x="10" y="351" width="96" height="96" href="assets/cassis_cap_lombard_opus_196.jpg"/>
          <path d="M 106 399 l 573 0" class="figure-line"/>
          <use href="#arrow-right" transform="translate(681, 399)" class="figure-path"/>
          <path d="M 132 284 L 58 284 L 58 351" class="figure-line figure-film-generator-edge"/>
          <use href="#arrow-right" transform="translate(132, 284)" class="figure-path figure-film-generator-arrow"/>
          <image x="10" y="53" width="96" height="96" href="assets/tuebingen_neckarfront.jpg"/>
          <path d="M 58 149 L 58 216 L 132 216" class="figure-line figure-filmed-network-edge"/>
          <use href="#arrow-right" transform="translate(132, 216)" class="figure-path figure-filmed-network-arrow"/>
          <path d="M 106 101 l 573 0" class="figure-line"/>
          <use href="#arrow-right" transform="translate(681, 101)" class="figure-path"/>
          <image x="568" y="202" width="96" height="96" href="assets/tuebingen_neckarfront_cassis_cap_lombard_opus_196.jpg"/>
          <path d="M 664 250 l 17 0" class="figure-line"/>
          <use href="#arrow-right" transform="translate(681, 250)" class="figure-path"/>
          <g transform="translate(132, 150)" id="encoder">
            <rect width="114" height="208" style="stroke: url(#linearStroke); stroke-width: 1.5px;" class="figure-group figure-box"/>
            <text x="57" y="104" dy="0.4em" style="text-anchor: middle;" class="figure-text">encoder</text>
            <text x="57" y="-6" style="text-anchor: middle;" class="figure-text figure-filmed-network-text"></text>
            <text x="57" y="224" style="text-anchor: middle;" class="figure-text figure-film-generator-text"></text>
          </g>
          <g transform="translate(412, 150)" id="decoder">
            <rect width="114" height="208" class="figure-group figure-box figure-filmed-network"/>
            <text x="57" y="104" dy="0.4em" style="text-anchor: middle;" class="figure-text">decoder</text>
            <text x="57" y="-6" style="text-anchor: middle;" class="figure-text figure-filmed-network-text"></text>
          </g>
          <g transform="translate(266, 150)">
            <g id="adain">
              <rect width="128" height="207" style="stroke: url(#linearStroke); stroke-width: 1.5px;" class="figure-group figure-box"/>
              <text x="64" y="196" style="text-anchor: middle;" class="figure-text">AdaIN</text>
            </g>
            <text x="64" y="-6" style="text-anchor: middle;" class="figure-text figure-filmed-network-text"></text>
            <text x="64" y="224" style="text-anchor: middle;" class="figure-text figure-film-generator-text"></text>
            <g transform="translate(15, 22)">
              <rect width="38" height="154" class="figure-element figure-box"/>
              <text x="19" y="77" transform="rotate(-90, 19, 77)" dy="0.4em" style="text-anchor: middle;" class="figure-text">instance normalization</text>
            </g>
            <path d="M 54 134 l 20 0" class="figure-line figure-film-generator-edge"/>
            <use href="#arrow-right" transform="translate(74, 134)" class="figure-path figure-film-generator-arrow"/>
            <path d="M 54 66 l 20 0" class="figure-line figure-filmed-network-edge"/>
            <use href="#arrow-right" transform="translate(74, 66)" class="figure-path figure-filmed-network-arrow"/>
            <g transform="translate(74, 22)" class="film-layer">
              <rect width="38" height="154" class="figure-element figure-box figure-film-layer"/>
              <text x="19" y="77" transform="rotate(-90, 19, 77)" dy="0.4em" style="text-anchor: middle;" class="figure-text">affine transformation</text>
            </g>
          </g>
          <path d="M 246 284 l 34 0" class="figure-line figure-film-generator-edge"/>
          <use href="#arrow-right" transform="translate(280, 284)" class="figure-path figure-film-generator-arrow"/>
          <path d="M 246 216 l 34 0" class="figure-line figure-filmed-network-edge"/>
          <use href="#arrow-right" transform="translate(280, 216)" class="figure-path figure-filmed-network-arrow"/>
          <path d="M 378 250 l 34 0" class="figure-line figure-filmed-network-edge"/>
          <use href="#arrow-right" transform="translate(412, 250)" class="figure-path figure-filmed-network-arrow"/>
          <path d="M 526 250 l 42 0" class="figure-line figure-filmed-network-edge"/>
          <use href="#arrow-right" transform="translate(568, 250)" class="figure-path figure-filmed-network-arrow"/>
          <g transform="translate(681, 26)">
            <rect width="56" height="448" class="figure-group figure-box"/>
            <text x="28" y="224" dy="0.4em" style="text-anchor: middle;" class="figure-text" transform="rotate(-90, 28, 224)">style transfer loss</text>
          </g>
        </svg>
        <figcaption>
          Another approach to fast, arbitrary artistic style transfer models.
          When applying instance normalization to the output of the encoder
          given the content image, the instance normalization layer's
          feature-wise affine transformation parameters are computed as the
          style image's instance normalization statistics in the same layer.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("figure.figure#adain-diagram").select("svg");
            svg.selectAll("g#encoder, g#adain, g#decoder")
                .on("mouseenter", function () {
                    svg.selectAll("g#encoder > rect, g#adain > rect").style("fill", "url(#linearFill)");
                    svg.select("g#decoder > rect").style("fill", "#90caf9");
                    svg.selectAll(".figure-film-generator-edge").style("stroke", "#c62828");
                    svg.selectAll(".figure-film-generator-arrow")
                        .style("fill", "#c62828")
                        .style("stroke", "#c62828");
                    svg.selectAll(".figure-filmed-network-edge").style("stroke", "#1e88e5");
                    svg.selectAll(".figure-filmed-network-arrow")
                        .style("fill", "#1e88e5")
                        .style("stroke", "#1e88e5");
                    svg.selectAll(".figure-filmed-network-text").text("FiLM-ed network");
                    svg.selectAll(".figure-film-generator-text").text("FiLM generator");
                })
                .on("mouseleave", function () {
                    svg.selectAll("g#encoder > rect, g#adain > rect").style("fill", null);
                    svg.select("g#decoder > rect").style("fill", null);
                    svg.selectAll(".figure-film-generator-edge").style("stroke", null);
                    svg.selectAll(".figure-film-generator-arrow")
                        .style("fill", null)
                        .style("stroke", null);
                    svg.selectAll(".figure-filmed-network-edge").style("stroke", null);
                    svg.selectAll(".figure-filmed-network-arrow")
                        .style("fill", null)
                        .style("stroke", null);
                    svg.selectAll(".figure-filmed-network-text, .figure-film-generator-text").text("");
                });
            svg.select("g.film-layer")
                .on("mouseenter", function () {
                    d3.select(this).select("g.film-layer > text").text("FiLM layer");
                    d3.select(this).select("g.film-layer > rect").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    d3.select(this).select("g.film-layer > text").text("affine transformation");
                    d3.select(this).select("g.film-layer > rect").style("fill", null)
                });
        })();
      </script>
      <p>
        The model architecture consists of an encoder-decoder pair. The encoder
        is the same neural network that is used to compute the content and style
        losses, and is kept fixed throughout training. A content/style image
        pair is first encoded, and the encoded stack of <em>content</em> feature
        maps is instance-normalized. Instance normalization statistics are then
        computed for the encoded stask of <em>style</em> feature maps and used
        to perform a feature-wise affine transformation on the normalized stack
        of content feature maps. The result is then passed through the decoder
        to obtain the stylized image, and the triplet of content/style/stylized
        images is used to compute the style transfer loss. The decoder is
        trained on many content/style image pairs to minimize this loss.
      </p>
      <p>
        Interestingly, the encoder can be seen as <em>both</em> a part of the
        FiLM-ed network, <em>and</em> the FiLM generator <em>itself</em>.
        Therefore, AdaIN can be interpreted as a FiLM layer replacing the
        instance normalization parameters, with the FiLM-generating network
        taking the form of the same neural network that is used to extract
        instance normalization statistics on the style image.
      </p>
      <p>
        Feature-wise affine transformations are also used in the reinforcement
        learning (RL) setting. In <dt-cite key="kirkpatrick2017overcoming"></dt-cite>,
        the authors briefly touch the idea of applying conditional feature-wise
        affine transformations to a reinforcement learning problem. They train
        an agent that learns to play 10 Atari games using a single Double DQN
        network with task-specific gains and biases, which can be viewed as
        inserting FiLM layers throughout its hierarchy.
      </p>
      <p>
        As we have seen so far, feature-wise affine transformations can be used
        as a conditioning mechanism to incorporate external information such as
        context representation, task description, class information, or user
        information. However, there is nothing preventing us from considering a
        neural network's hidden activations <em>themselves</em> as conditioning
        information. This idea gives rise to various forms of
        <em>self-conditioned</em> models.
      </p>
      <p>
        In the speech recognition domain, <dt-cite key="kim2017dynamic"></dt-cite>
        modulates a deep bidirectional LSTM using a form of conditional
        normalization which the authors call <em>dynamic layer normalization</em>.
        In analogy to conditional instance normalization and conditional batch
        normalization, dynamic layer normalization can be seen as an instance of
        FiLM where the post-normalization feature-wise affine transformation is
        disabled and a FiLM layer is placed immediately after the instance
        normalization layer.
      </p>
      <figure class="l-body-outset figure" id="dln-diagram">
        <figcaption>
          The speech recognition model in <dt-cite key="kim2017dynamic"></dt-cite>
          achieves speaker adaptation by predicting the layer normalization
          scaling and shifting coefficients inside its LSTMs' forget, input,
          and output gates from an utterance summarization vector.
        </figcaption>
      </figure>
      <p>
        The key difference here is that the conditioning signal does not come
        from an external source, but is rather computed from utterance
        summarization feature vectors extracted in each layer of the network
        as a way of adapting the neural acoustic model.
      </p>
      <p>
        In the visual domain, the ImageNet 2017 winning model
        <dt-cite key="hu2017squeeze"></dt-cite> employs a self-conditioning
        scheme in the form of feature-wise sigmoidal gating as a way to
        condition a layer's activations on its previous layer.
      </p>
      <figure class="l-body-outset figure" id="squeeze-diagram">
        <figcaption>
          The squeeze-and-excitation block implements a self-conditioned
          feature-wise sigmoidal gating operation.
        </figcaption>
      </figure>
      <p>
        In the natural language domain, <dt-cite key="dauphin2017language"></dt-cite>
        proposes to build a finite context using stacked convolutions to tackle
        language modeling and introduces gated linear units, which uses half of
        the features to apply feature-wise sigmoidal gating to the second half.
        This architectural feature is also adopted by
        <dt-cite key="gehring2017convolutional"></dt-cite>, which introduces a
        fast and parallelizable model for machine translation in the form of a
        purely convolutional architecture.
      </p>
      <figure class="l-body-outset figure" id="convseq2seq-diagram">
        <figcaption>
          Gated linear unit activation function <dt-cite key="dauphin2017language"></dt-cite>.
          Half of the features are used to apply feature-wise sigmoidal gating
          to the second half of the features.
        </figcaption>
      </figure>
      <p>
        The LSTM <dt-cite key="hochreiter1997long"></dt-cite> architecture,
        which is itself a building block in some of the models we referenced
        thus far, makes heavy use of feature-wise sigmoidal gating in its input,
        forget, and output gates.
      </p>
      <p>
        Finally, in addition to conditional biasing,
        PixelCNN <dt-cite key="oord2016conditional"></dt-cite> and
        WaveNet <dt-cite key="oord2016wavenet"></dt-cite> both employ a
        self-conditioned tanh-sigmoid gated nonlinearity.
      </p>
      <p>
        Some work even combines attention and feature-wise affine
        transformations. Work in <dt-cite key="shen2017disan"></dt-cite>
        proposes a feature-wise self-attention mechanism for language
        understanding, showing strong results on datasets such as SNLI
        <dt-cite key="bowman2015large"></dt-cite>. A core idea behind the
        proposed model, named Directional Self-Attention Network (DiSAN), is
        that of multi-dimensional attention, i.e., combining tokens at a
        <em>feature</em> level rather than at a <em>feature vector</em> level,
        using the input itself to generate the feature-wise attention
        distributions over all tokens.
      </p>
      <figure class="l-body-outset figure" id="disan-diagram">
        <figcaption>
          WRITEME
        </figcaption>
      </figure>

      <hr />

      <h1 id="understanding-film">Understanding FiLM-ed networks</h1>

      <h2>FiLM parameters as task embeddings</h2>
      <div class="l-body-outset figure" id="clevr-tsne"></div>

      <hr />

      <h1 id="bilinear-connection">Connecting FiLM, gating, attention, and mixture-of-experts models</h1>
      <p>
        As previously hinted at, there exists a strong connection between FiLM,
        gating, attention, and mixture-of-experts models through bilinear
        transformations <dt-cite key="tenenbaum2000separating"></dt-cite>. In
        fact, all four approaches can be formalized using an extension of
        bilinear transformations which we propose to name <em>generalized
        bilinear transformations</em>.
      </p>
      <h2>Bilinear and generalized bilinear transformations</h2>
      <p>
        A bilinear transformation defines the relationship between two inputs
        <dt-math>\mathbf{x}</dt-math> and <dt-math>\mathbf{z}</dt-math> and the
        <dt-math>k^{th}</dt-math> output feature <dt-math>y_k</dt-math> as

        <dt-math block>
          y_k = \mathbf{x}^T W_k \mathbf{z}.
        </dt-math>

        Note that for each output feature <dt-math>y_k</dt-math> we have a
        separate matrix <dt-math>W_k</dt-math>, so the full set of weights forms
        a 3-tensor.
      </p>
      <figure class="l-body-outset figure" id="bilinear-diagram">
        <svg viewBox="0 0 744 340" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" id="arrow-right"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" id="arrow-up"/>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-left"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-down"/>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 34 0 l 0 40 l -34 0 a 6 6 0 0 1 -6 -6 Z" id="big-row-left"/>
            <path d="M 0 0 l 40 0 l 0 40 l -40 0 Z" id="big-row-middle"/>
            <path d="M 0 0 l 34 0 a 6 6 0 0 1 6 6 l 0 28 a 6 6 0 0 1 -6 6 l -34 0 Z" id="big-row-right"/>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z" id="row-left"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="row-middle"/>
            <path d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 8 a 6 6 0 0 1 -6 6 l -14 0 Z" id="row-right"/>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 8 0 a 6 6 0 0 1 6 6 l 0 14 l -20 0 Z" id="column-top"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="column-middle"/>
            <path d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -8 0 a 6 6 0 0 1 -6 -6 Z" id="column-bottom"/>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -20 0 Z" id="matrix-top-left"/>
            <path d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 14l -20 0 Z" id="matrix-top-right"/>
            <path d="M 0 0 l 20 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z" id="matrix-bottom-left"/>
            <path d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -14 0 Z" id="matrix-bottom-right"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="matrix-center"/>
            <path d="M 0 0 C 0 -16 42.5 0 42.5 -16 C 42.5 0 85 -16 85 0" id="curly-brace"/>
          </defs>
          <rect x="10" y="10" width="724" height="320" class="figure-group figure-box"/>
          <text x="20" y="30" class="figure-text">Bilinear transformation</text>
          <g transform="translate(92, -121)">
            <g transform="translate(15, 273)">
              <use href="#row-left" transform="translate(0, 0)"  class="figure-element"/>
              <use href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
            </g>
            <g transform="translate(48, 362)">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-bottom-right" transform="translate(40, 40)" class="figure-element"/>
              <text x="30" y="75" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan></text>
            </g>
            <g transform="translate(113, 362)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <text x="10" y="75" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
            </g>
            <g transform="translate(80, 273)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <text x="25" y="30" dy="0.4em" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan></text>
            </g>
          </g>
          <g transform="translate(312, 27)">
            <g transform="translate(17, 125)">
              <use href="#row-left" transform="translate(0, 0)"  class="figure-element"/>
              <use href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
            </g>
            <g transform="translate(50, 214)">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-bottom-right" transform="translate(40, 40)" class="figure-element"/>
              <text x="30" y="75" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan></text>
            </g>
            <g transform="translate(115, 214)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <text x="10" y="75" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
            </g>
            <g transform="translate(82, 125)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <text x="25" y="30" dy="0.4em" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan></text>
            </g>
          </g>
          <g transform="translate(372, 70)">
            <g transform="translate(177, 82)">
              <use href="#row-left" transform="translate(0, 0)"  class="figure-element"/>
              <use href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
            </g>
            <g transform="translate(209.5, 170)">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-bottom-right" transform="translate(40, 40)" class="figure-element"/>
              <text x="30" y="75" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan></text>
            </g>
            <g transform="translate(274.5, 170)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <text x="10" y="75" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
            </g>
            <g transform="translate(242, 82)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <text x="25" y="30" dy="0.4em" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan></text>
            </g>
          </g>
          <g transform="translate(312, 20)">
            <use href="#big-row-left" transform="translate(0, 0)"  class="figure-element"/>
            <use href="#big-row-middle" transform="translate(40, 0)" class="figure-element"/>
            <use href="#big-row-right" transform="translate(80, 0)" class="figure-element"/>
            <text x="-15" y="20" dy="0.4em" dy="0.4em" style="font-weight: bold;" class="figure-text">y</text>
          </g>
          <use href="#curly-brace" transform="translate(107, 147)" class="figure-line"/>
          <use href="#curly-brace" transform="translate(329, 147)" class="figure-line"/>
          <use href="#curly-brace" transform="translate(549, 147)" class="figure-line"/>
          <use href="#curly-brace" transform="translate(140, 236)" class="figure-line"/>
          <use href="#curly-brace" transform="translate(362, 236)" class="figure-line"/>
          <use href="#curly-brace" transform="translate(581.5, 236)" class="figure-line"/>
          <path class="figure-line" d="M 149.5 126 C 149.5 60 342 126 332 60"/>
          <use href="#arrow-up" transform="translate(332, 60)" class="figure-line"/>
          <path class="figure-line" d="M 372 126 L 372 60"/>
          <use href="#arrow-up" transform="translate(372, 60)" class="figure-line"/>
          <path class="figure-line" d="M 591.5 126 C 591.5 60 402 126 412 60"/>
          <use href="#arrow-up" transform="translate(412, 60)" class="figure-line"/>
        </svg>
        <figcaption>
          A bilinear transformation mapping <dt-math>\mathbf{x}</dt-math> and
          <dt-math>\mathbf{z}</dt-math> &mdash; both 3-dimensional &mdash; to a
          3-dimensional output. Each output element <dt-math>y_k</dt-math> is
          computed as a vector-matrix-vector product using a separate matrix
          <dt-math>W_k</dt-math>.
        </figcaption>
      </figure>
      <p>
        In general, bilinear transformations are used to combine two inputs
        without attaching a specific meaning to the nature of those inputs. For
        the purpose of our discussion, we will consider
        <dt-math>\mathbf{x}</dt-math> to be the representation being FiLM-ed,
        gated, or attended to, and <dt-math>\mathbf{z}</dt-math> to be the
        context used to FiLM, gate, or attend to.
      <p>
        The generalized bilinear transformation we propose stretches the
        definition of a bilinear transformation in two ways:
        <ul>
          <li>
            It appends a <dt-math>1</dt-math>-valued feature to the inputs
            <dt-math>\mathbf{x}</dt-math> and <dt-math>\mathbf{z}</dt-math> to
            accommodate an eventual bias term &mdash; a common trick used to
            simplify the algebra of neural networks:
            <dt-math block>
              \begin{aligned}
                \tilde{\mathbf{x}} &= (x_0, \ldots, x_M, 1)^T, \\
                \tilde{\mathbf{z}} &= (z_0, \ldots, z_N, 1)^T.
              \end{aligned}
            </dt-math>
          </li>
          <li>
            It applies an activation function <dt-math>g_k(\cdot)</dt-math> to
            the result of the matrix-vector product:
            <dt-math block>
              y_k = \tilde{\mathbf{x}}^T g_k(W_k \tilde{\mathbf{z}}).
            </dt-math>
          </li>
        </ul>
      </p>
      <figure class="l-body-outset figure" id="generalized-bilinear-diagram">
        <svg viewBox="0 0 744 380" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" id="arrow-right"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" id="arrow-up"/>
            <path d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-left"/>
            <path d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" transform="rotate(180, 0, 0)" id="arrow-down"/>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 34 0 l 0 40 l -34 0 a 6 6 0 0 1 -6 -6 Z" id="big-row-left"/>
            <path d="M 0 0 l 40 0 l 0 40 l -40 0 Z" id="big-row-middle"/>
            <path d="M 0 0 l 34 0 a 6 6 0 0 1 6 6 l 0 28 a 6 6 0 0 1 -6 6 l -34 0 Z" id="big-row-right"/>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z" id="row-left"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="row-middle"/>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 8 0 a 6 6 0 0 1 6 6 l 0 8 a 6 6 0 0 1 -6 6 l -8 0 a 6 6 0 0 1 -6 -6 Z" id="singleton"/>
            <path d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 8 a 6 6 0 0 1 -6 6 l -14 0 Z" id="row-right"/>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 8 0 a 6 6 0 0 1 6 6 l 0 14 l -20 0 Z" id="column-top"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="column-middle"/>
            <path d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -8 0 a 6 6 0 0 1 -6 -6 Z" id="column-bottom"/>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -20 0 Z" id="matrix-top-left"/>
            <path d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 14l -20 0 Z" id="matrix-top-right"/>
            <path d="M 0 0 l 20 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z" id="matrix-bottom-left"/>
            <path d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -14 0 Z" id="matrix-bottom-right"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="matrix-center"/>
            <path d="M 0 0 C 0 -16 52.5 0 52.5 -16 C 52.5 0 105 -16 105 0" id="large-curly-brace"/>
            <path d="M 10 0 C -2 0 -2 80 10 80" id="parenthesis-left"/>
            <path d="M 0 0 C 8 0 8 80 0 80" id="parenthesis-right"/>
          </defs>
          <rect x="10" y="10" width="724" height="360" class="figure-group figure-box"/>
          <text x="20" y="30" class="figure-text">Generalized bilinear transformation</text>
          <g transform="translate(92, -121)">
            <g transform="translate(-5, 273)">
              <use href="#row-left" transform="translate(0, 0)"  class="figure-element"/>
              <use href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#singleton" transform="translate(60, 0)" class="figure-element"/>
              <text x="70" y="10" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
            </g>
            <g transform="translate(38, 382)">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(60, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(60, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(00, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(60, 40)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 60)" class="figure-element"/>
              <use href="#matrix-bottom-right" transform="translate(60, 60)" class="figure-element"/>
              <text x="-40" y="40" class="figure-text"><tspan>g</tspan><tspan dy="0.4em" class="subscript">1</tspan></text>
              <use href="#parenthesis-left" transform="translate(-20, 0)" class="figure-line"/>
              <use href="#parenthesis-right" transform="translate(120, 0)" class="figure-line"/>
              <text x="40" y="95" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="0.4em" class="subscript">1</tspan></text>
            </g>
            <g transform="translate(123, 382)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <use href="#singleton" transform="translate(0, 60)" class="figure-element"/>
              <text x="10" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              <text x="10" y="95" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
            </g>
            <g transform="translate(80, 273)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
              <text x="25" y="40" dy="0.4em" class="figure-text"><tspan>g</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px">(W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan><tspan style="font-weight: normal;">)</tspan></text>
            </g>
          </g>
          <g transform="translate(312, 27)">
            <g transform="translate(-3, 125)">
              <use href="#row-left" transform="translate(0, 0)"  class="figure-element"/>
              <use href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#singleton" transform="translate(60, 0)" class="figure-element"/>
              <text x="70" y="10" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
            </g>
            <g transform="translate(40, 234)">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(60, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(60, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(00, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(60, 40)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 60)" class="figure-element"/>
              <use href="#matrix-bottom-right" transform="translate(60, 60)" class="figure-element"/>
              <text x="-40" y="40" class="figure-text"><tspan>g</tspan><tspan dy="0.4em" class="subscript">2</tspan></text>
              <use href="#parenthesis-left" transform="translate(-20, 0)" class="figure-line"/>
              <use href="#parenthesis-right" transform="translate(120, 0)" class="figure-line"/>
              <text x="40" y="95" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="0.4em" class="subscript">2</tspan></text>
            </g>
            <g transform="translate(125, 234)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <use href="#singleton" transform="translate(0, 60)" class="figure-element"/>
              <text x="10" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              <text x="10" y="95" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
            </g>
            <g transform="translate(82, 125)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
              <text x="25" y="40" dy="0.4em" class="figure-text"><tspan>g</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px">(W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan><tspan>)</tspan></text>
            </g>
          </g>
          <g transform="translate(372, 70)">
            <g transform="translate(157, 82)">
              <use href="#row-left" transform="translate(0, 0)"  class="figure-element"/>
              <use href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#singleton" transform="translate(60, 0)" class="figure-element"/>
              <text x="70" y="10" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
            </g>
            <g transform="translate(199.5, 190)">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(60, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(60, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(00, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(60, 40)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 60)" class="figure-element"/>
              <use href="#matrix-bottom-right" transform="translate(60, 60)" class="figure-element"/>
              <text x="-40" y="40" class="figure-text"><tspan>g</tspan><tspan dy="0.4em" class="subscript">3</tspan></text>
              <use href="#parenthesis-left" transform="translate(-20, 0)" class="figure-line"/>
              <use href="#parenthesis-right" transform="translate(120, 0)" class="figure-line"/>
              <text x="40" y="95" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="0.4em" class="subscript">3</tspan></text>
            </g>
            <g transform="translate(284.5, 190)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <use href="#singleton" transform="translate(0, 60)" class="figure-element"/>
              <text x="10" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              <text x="10" y="95" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
            </g>
            <g transform="translate(242, 82)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
              <text x="25" y="40" dy="0.4em" class="figure-text"><tspan>g</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px">(W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan><tspan>)</tspan></text>
            </g>
          </g>
          <g transform="translate(312, 20)">
            <use href="#big-row-left" transform="translate(0, 0)"  class="figure-element"/>
            <use href="#big-row-middle" transform="translate(40, 0)" class="figure-element"/>
            <use href="#big-row-right" transform="translate(80, 0)" class="figure-element"/>
            <text x="-15" y="20" dy="0.4em" style="font-weight: bold;" class="figure-text">y</text>
          </g>
          <use href="#large-curly-brace" transform="translate(87, 147)" class="figure-line"/>
          <use href="#large-curly-brace" transform="translate(309, 147)" class="figure-line"/>
          <use href="#large-curly-brace" transform="translate(529, 147)" class="figure-line"/>
          <use href="#large-curly-brace" transform="translate(130, 256)" class="figure-line"/>
          <use href="#large-curly-brace" transform="translate(352, 256)" class="figure-line"/>
          <use href="#large-curly-brace" transform="translate(571.5, 256)" class="figure-line"/>
          <path class="figure-line" d="M 139.5 126 C 159.5 60 342 126 332 60"/>
          <use href="#arrow-up" transform="translate(332, 60)" class="figure-line"/>
          <path class="figure-line" d="M 361.5 126 C 361.5 80 372 106 372 60"/>
          <use href="#arrow-up" transform="translate(372, 60)" class="figure-line"/>
          <path class="figure-line" d="M 581.5 126 C 581.5 60 402 126 412 60"/>
          <use href="#arrow-up" transform="translate(412, 60)" class="figure-line"/>
        </svg>
        <figcaption>
          A generalized bilinear transformation mapping mapping the inputs
          <dt-math>\mathbf{x}</dt-math> and <dt-math>\mathbf{z}</dt-math>
          &mdash; both 3-dimensional &mdash; to a 3-dimensional output.
        </figcaption>
      </figure>
      <p>
        The choice of activation function <dt-math>g_k(\cdot)</dt-math> and the
        structure of the weight matrices <dt-math>W_k</dt-math> determines the
        nature of the transformation: FiLM, gating, or attention. Going
        backwards from the definition of each computation mechanism, we will now
        explain how they can be expressed in terms of generalized bilinear
        transformations. To simplify the discussion, we give the name
        <em>context vector</em> to the matrix-vector product:

        <dt-math block>
          \mathbf{v} = g_k(W_k \tilde{\mathbf{z}})
        </dt-math>
      </p>

      <h2>Connecting the dots</h2>

      <h3>FiLM as a generalized bilinear transformation</h3>
      <p>
        FiLM is represented by an equation of the form

        <dt-math block>
          y_k = \gamma_k x_k + \beta_k.
        </dt-math>

        This means that the nonlinearity should be the identity function
        <dt-math>g_k(\mathbf{u}) = \mathbf{z}</dt-math>, and the context vector
        should have the form

        <dt-math block>
          \mathbf{v} = (0, \ldots, 0, \gamma_k, 0, \ldots, 0, \beta_k)^T,
        </dt-math>

        where <dt-math>\gamma_k</dt-math> is the <dt-math>k^{th}</dt-math>
        element of the context vector. This means in turn that the weight matrix
        <dt-math>W_k</dt-math> should be low-rank and have the form

        <dt-math block>
          W_k =
          \begin{pmatrix}
             0 & 0 \\
             \vdots & \vdots \\
             0 & 0 \\
             1 & 0 \\
             0 & 0 \\
             \vdots & \vdots \\
             0 & 0 \\
             0 & 1
          \end{pmatrix}
          \begin{pmatrix}
             w_{k, 1, 1} & \cdots & w_{k, 1, N} \\
             w_{k, 2, 1} & \cdots & w_{k, 2, N}
          \end{pmatrix}.
        </dt-math>
      </p>
      <p>
      Here is an example for a 3-dimensional <dt-math>\mathbf{x}</dt-math>
      and a 2-dimensional <dt-math>\mathbf{z}</dt-math> (reminder: this means
      a 4-dimensional <dt-math>\tilde{\mathbf{x}}</dt-math> and a 3-dimensional
      <dt-math>\tilde{\mathbf{z}}</dt-math>):
      </p>
      <figure class="l-body-outset figure" id="film-as-bilinear-diagram">
        <svg viewBox="0 0 744 110" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -20 0 Z" id="matrix-top-left"/>
            <path d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 14l -20 0 Z" id="matrix-top-right"/>
            <path d="M 0 0 l 20 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z" id="matrix-bottom-left"/>
            <path d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -14 0 Z" id="matrix-bottom-right"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="matrix-center"/>
          </defs>
          <g transform="translate(-52, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-right" transform="translate(20, 60)" class="figure-element"/>
            </g>
            <g transform="translate(140, 69)" id="w-1">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-bottom-right" transform="translate(40, 20)" class="figure-element"/>
            </g>
            <text x="205" y="93" class="figure-text">=</text>
            <g transform="translate(218, 49)" id="w-1-full">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
              <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element"/>
            </g>
          </g>
          <g transform="translate(202, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-top-right" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-right" transform="translate(20, 60)" class="figure-element"/>
            </g>
            <g transform="translate(140, 69)" id="w-2">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-bottom-right" transform="translate(40, 20)" class="figure-element"/>
            </g>
            <text x="205" y="93" class="figure-text">=</text>
            <g transform="translate(218, 49)" id="w-2-full">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
              <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element"/>
            </g>
          </g>
          <g transform="translate(456, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-top-right" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-right" transform="translate(20, 60)" class="figure-element"/>
            </g>
            <g transform="translate(140, 69)" id="w-3">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-bottom-right" transform="translate(40, 20)" class="figure-element"/>
            </g>
            <text x="205" y="93" class="figure-text">=</text>
            <g transform="translate(218, 49)" id="w-3-full">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
              <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element"/>
            </g>
          </g>
        </svg>
        <figcaption>
          Generalized bilinear weight matrices for a FiLM layer applied on a
          3-dimensional input <dt-math>\mathbf{x}</dt-math> within the context
          of a 2-dimensional <dt-math>\mathbf{z}</dt-math>. Grey elements
          have value <dt-math>0</dt-math>, white elements have value
          <dt-math>1</dt-math>, and color elements have arbitrary values.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("figure.figure#film-as-bilinear-diagram").select("svg");
            var dataW1 = [];
            var dataW2 = [];
            var dataW3 = [];
            for(var i = 0; i < 6; i++) {
                dataW1.push(Math.random() * 360);
                dataW2.push(Math.random() * 360);
                dataW3.push(Math.random() * 360);
            }
            svg.select("#w-1")
              .selectAll("use")
                .data(dataW1)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-1-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(dataW1)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-2")
              .selectAll("use")
                .data(dataW2)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-2-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(dataW2)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-3")
              .selectAll("use")
                .data(dataW3)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-3-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(dataW3)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
        })();
      </script>

      <h3>Gating as a generalized bilinear transformation</h3>
      <p>
        As explained earlier in the article, feature-wise gating layers can be
        seen as a bias-less FiLM layers with sigmoidal scaling. Representing
        them as a generalized bilinear transformation is a straightforward
        adaptation with respect to FiLM. Feature-wise gating is represented by
        an equation of the form

        <dt-math block>
          y_k = \alpha_k x_k, \quad \alpha_k \in [0, 1].
        </dt-math>

        This means that the context vector should have the form

        <dt-math block>
          \mathbf{v} = (0, \ldots, 0, \alpha_k, 0, \ldots, 0, 0)^T,
        </dt-math>

        which is achieved through a combination of a "one-hot sigmoid"
        nonlinearity

        <dt-math block>
          g(\mathbf{u}) = (u_0, \ldots, u_{k-1}, \sigma(u_k), u_{k+1}, \ldots, u_{N})^T,
        </dt-math>

        and a low-rank weight matrix <dt-math>W_k</dt-math> of the form

        <dt-math block>
          W_k =
          \begin{pmatrix}
             0 \\
             \vdots \\
             0 \\
             1 \\
             0 \\
             \vdots \\
             0
          \end{pmatrix}
          \begin{pmatrix}
             w_{k, 1} & \cdots & w_{k, N}
          \end{pmatrix}.
        </dt-math>
      </p>
      <p>
      Here is an example for a 3-dimensional <dt-math>\mathbf{x}</dt-math>
      and a 2-dimensional <dt-math>\mathbf{z}</dt-math> (reminder: this means
      a 4-dimensional <dt-math>\tilde{\mathbf{x}}</dt-math> and a 3-dimensional
      <dt-math>\tilde{\mathbf{z}}</dt-math>):
      </p>
      <figure class="l-body-outset figure" id="gating-as-bilinear-diagram">
        <svg viewBox="0 0 744 110" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z" id="row-left"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="row-middle"/>
            <path d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 8 a 6 6 0 0 1 -6 6 l -14 0 Z" id="row-right"/>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 8 0 a 6 6 0 0 1 6 6 l 0 14 l -20 0 Z" id="column-top"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="column-middle"/>
            <path d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -8 0 a 6 6 0 0 1 -6 -6 Z" id="column-bottom"/>
          </defs>
          <g transform="translate(-52, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use href="#column-middle" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use href="#column-bottom" transform="translate(0, 60)" class="figure-element figure-faded"/>
            </g>
            <g transform="translate(120, 79)" id="w-1">
              <use href="#row-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use href="#row-right" transform="translate(40, 0)" class="figure-element"/>
            </g>
            <text x="185" y="93" class="figure-text">=</text>
            <g transform="translate(198, 49)" id="w-1-full">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
          <g transform="translate(202, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use href="#column-middle" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use href="#column-bottom" transform="translate(0, 60)" class="figure-element figure-faded"/>
            </g>
            <g transform="translate(120, 79)" id="w-2">
              <use href="#row-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use href="#row-right" transform="translate(40, 0)" class="figure-element"/>
            </g>
            <text x="185" y="93" class="figure-text">=</text>
            <g transform="translate(198, 49)" id="w-2-full">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
          <g transform="translate(456, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)">
              <use href="#column-top" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use href="#column-middle" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use href="#column-bottom" transform="translate(0, 60)" class="figure-element figure-faded"/>
            </g>
            <g transform="translate(120, 79)" id="w-3">
              <use href="#row-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use href="#row-right" transform="translate(40, 0)" class="figure-element"/>
            </g>
            <text x="185" y="93" class="figure-text">=</text>
            <g transform="translate(198, 49)" id="w-3-full">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
        </svg>
        <figcaption>
          Generalized bilinear weight matrices for a gating layer applied on a
          3-dimensional input <dt-math>\mathbf{x}</dt-math> within the context
          of a 2-dimensional <dt-math>\mathbf{z}</dt-math>. Grey elements
          have value <dt-math>0</dt-math>, white elements have value
          <dt-math>1</dt-math>, and color elements have arbitrary values.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("figure.figure#gating-as-bilinear-diagram").select("svg");
            var dataW1 = [];
            var dataW2 = [];
            var dataW3 = [];
            for(var i = 0; i < 3; i++) {
                dataW1.push(Math.random() * 360);
                dataW2.push(Math.random() * 360);
                dataW3.push(Math.random() * 360);
            }
            svg.select("#w-1")
              .selectAll("use")
                .data(dataW1)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-1-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(dataW1)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-2")
              .selectAll("use")
                .data(dataW2)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-2-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(dataW2)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-3")
              .selectAll("use")
                .data(dataW3)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-3-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(dataW3)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
        })();
      </script>

      <h3>Attention as a generalized bilinear transformation</h3>
      <p>
        <a href="https://distill.pub/2016/augmented-rnns/">Attention</a> is
        applied to a set of feature vectors at different spatial or temporal
        locations <dt-math>t \in [1, \cdots, T]</dt-math> by computing from
        internal or external conditioning information an <em>attention distribution</em>

        <dt-math block>
            \mathbf{p} = (p_1, \cdots, p_T)^T, \quad p^t > 0, \quad \sum_{t=1}^T p^t = 1.
        </dt-math>

        Assuming a feature matrix <dt-math>X</dt-math> in which columns
        represent feature vectors at different spatial or temporal locations
        (<em>N.B.: this is a somewhat unusual way of organizing a sequence of
        feature vectors</em>), the output of the attentional interface is
        computed as the expected feature vector over the attention distribution:

        <dt-math block>
            \mathbf{y} = X \mathbf{p}.
        </dt-math>
      <p>
        Attention is closely related to gating in the generalized bilinear
        formulation, save from one crucial detail: because it implements a
        weighted sum over spatial or temporal locations, elements of the
        vector <dt-math>\mathbf{x}</dt-math> represent <em>the same feature
        at different spatial or temporal locations</em> rather than different
        features. It is represented by an equation of the form

        <dt-math block>
          y_k = \sum_{t=1}^T X_{k,t} p_t.
        </dt-math>

        This means that the context vector should have the form

        <dt-math block>
          \mathbf{v} = (p_1, \ldots, p_T, 0)^T,
        </dt-math>

        which is achieved through a combination of an "all-but-last softmax"
        nonlinearity

        <dt-math block>
          g(\mathbf{u}) = (\textrm{softmax}(\mathbf{u}_{1:T-1}), 0)^T,
        </dt-math>

        and a full-rank weight matrix <dt-math>W_k</dt-math>. Because the same
        weighted sum is applied to all features over spatial or temporal
        locations, matrices <dt-math>W_k</dt-math> are tied.
      </p>
      <figure class="l-body-outset figure" id="attention-as-bilinear-diagram">
        <svg viewBox="0 0 744 110" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -20 0 Z" id="matrix-top-left"/>
            <path d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 14l -20 0 Z" id="matrix-top-right"/>
            <path d="M 0 0 l 20 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z" id="matrix-bottom-left"/>
            <path d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -14 0 Z" id="matrix-bottom-right"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="matrix-center"/>
          </defs>
          <g transform="translate(-52, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)" id="w-1-full">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
          <g transform="translate(202, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)" id="w-2-full">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
          <g transform="translate(456, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)" id="w-3-full">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
        </svg>
        <figcaption>
          The generalized bilinear weight matrices for an attention layer are
          tied. Grey elements have value <dt-math>0</dt-math>, and color
          elements have arbitrary values.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("figure.figure#attention-as-bilinear-diagram").select("svg");
            var data = [];
            for(var i = 0; i < 9; i++) { data.push(Math.random() * 360); }
            svg.select("#w-1-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(data)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-2-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(data)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-3-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(data)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
        })();
      </script>

      <h3>Mixture-of-experts as a generalized bilinear transformation</h3>
      <p>
        Work on mixture-of-experts models
        <dt-cite key="jacobs1991adaptive,jordan1994hierarchical,eigen2014deep,shazeer2017outrageously"></dt-cite>
        examines a framework in which the feature vectors output by several
        expert sub-networks are combined according to a mixture distribution
        which is itself computed from the experts' inputs.
      </p>
      <figure class="l-body-outset figure" id="moe-diagram">
        <figcaption>
            Mixture-of-experts model. The model's output is computed as a
            weighted sum of each expert's feature vector output as predicted
            by the gating network's mixture distribution output.
        </figcaption>
      </figure>
      <p>
        There is a strong connection between mixture-of-experts models and
        attention: the former can be viewed as attention over the experts'
        outputs rather than over time or space. As such, mixture-of-experts
        models can be represented as generalized bilinear transformations in the
        same way attention is, the only difference being that the columns of
        <dt-math>X</dt-math> represent experts rather than spatial or temporal
        locations.
      </p>
      <figure class="l-body-outset figure" id="moe-as-bilinear-diagram">
        <svg viewBox="0 0 744 110" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -20 0 Z" id="matrix-top-left"/>
            <path d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 14l -20 0 Z" id="matrix-top-right"/>
            <path d="M 0 0 l 20 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z" id="matrix-bottom-left"/>
            <path d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -14 0 Z" id="matrix-bottom-right"/>
            <path d="M 0 0 l 20 0 l 0 20 l -20 0 Z" id="matrix-center"/>
          </defs>
          <g transform="translate(-52, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)" id="w-1-full">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
          <g transform="translate(202, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)" id="w-2-full">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
          <g transform="translate(456, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)" id="w-3-full">
              <use href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
        </svg>
        <figcaption>
          Just like with attention, the generalized bilinear weight matrices for
          a mixture-of-experts model are tied. Grey elements have value
          <dt-math>0</dt-math>, and color elements have arbitrary values.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("figure.figure#moe-as-bilinear-diagram").select("svg");
            var data = [];
            for(var i = 0; i < 9; i++) { data.push(Math.random() * 360); }
            svg.select("#w-1-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(data)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-2-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(data)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-3-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(data)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
        })();
      </script>

      <hr />

      <h1>Conclusion</h1>
      <p>
        <span class="todo">TODO: write a concluding statement.</span>
      </p>

    </dt-article>

    <dt-appendix>
      <h3>Acknowledgements</h3>
      <p><span class="todo"> TODO: WRITEME.</span><p>

    <script type="text/bibliography">
      @inproceedings{vries2017modulating,
        author={de Vries, Harm and Strub, Florian and Mary, J\'{e}r\'{e}mie and
                Larochelle, Hugo and Pietquin, Olivier and Courville, Aaron},
        title={Modulating early visual processing by language},
        booktitle={Advances in Neural Information Processing Systems},
        year={2017},
        url={https://arxiv.org/pdf/1707.00683.pdf},
      }
      @inproceedings{vries2017guesswhat,
        title={GuessWhat?! Visual object discovery through multi-modal dialogue},
        author={de Vries, Harm and Strub, Florian and Chandar, Sarath and
                Pietquin, Olivier and Larochelle, Hugo and Courville, Aaron},
        booktitle={Proceedings of the Conference on Computer Vision and Pattern
                   Recognition},
        year={2017}
      }
      @inproceedings{perez2017learning,
        author={Perez, Ethan and de Vries, Harm and Strub, Florian and Dumoulin,
                Vincent and Courville, Aaron},
        title={Learning visual reasoning without strong priors},
        booktitle={ICML Workshop on Machine Learning in Speech and Language Processing},
        year={2017},
        url={https://arxiv.org/pdf/1707.03017.pdf},
      }
      @inproceedings{perez2017film,
        author={Perez, Ethan and de Vries, Harm and Strub, Florian and Dumoulin,
                Vincent and Courville, Aaron},
        title={FiLM: Visual Reasoning with a General Conditioning Layer},
        booktitle={arXiv},
        year={2017},
        url={https://arxiv.org/pdf/1709.07871.pdf},
      }
      @inproceedings{johnson2017clevr,
        author={Johnson, Justin and Li, Fei-Fei and Hariharan, Bharath and Zitnick,
                Lawrence C. and van der Maaten, Laurens and Girshick, Ross},
        title={FiLM: Visual Reasoning with a General Conditioning Layer},
        booktitle={Proceedings of the Conference on Computer Vision and Pattern Recognition},
        year={2017},
        url={https://arxiv.org/pdf/1612.06890.pdf},
      }
      @inproceedings{dumoulin2017learned,
        author={Dumoulin, Vincent and Shlens, Jonathon and Kudlur, Manjunath},
        title={A Learned Representation for Artistic Style},
        booktitle={Proceedings of the International Conference on Learning Representations},
        year={2017},
        url={https://arxiv.org/pdf/1610.07629.pdf},
      }
      @inproceedings{ghiasi2017exploring,
        author={Ghiasi, Golnaz and Lee, Honglak and Kudlur, Manjunath and
                Dumoulin, Vincent and Shlens, Jonathon},
        title={Exploring the structure of a real-time, arbitrary neural artistic
               stylization network},
        booktitle={Proceedings of the British Machine Vision Conference},
        year={2017},
        url={https://arxiv.org/pdf/1705.06830.pdf},
      }
      @inproceedings{huang2017arbitrary,
        title={Arbitrary Style Transfer in Real-time with Adaptive Instance Normalization},
        author={Huang, Xun and Belongie, Serge},
        booktitle={Proceedings of the International Conference on Computer Vision},
        year={2017},
        url={https://arxiv.org/pdf/1703.06868.pdf},
      }
      @inproceedings{radford2016unsupervised,
        author={Radford, Alec and Metz, Luke and Chintala, Soumith},
        title={Unsupervised Representation Learning with Deep Convolutional
               Generative Adversarial Networks},
        booktitle={Proceedings of the International Conference on Learning Representations},
        year={2016},
        url={https://arxiv.org/pdf/1511.06434.pdf},
      }
      @inproceedings{oord2016conditional,
        title={Conditional Image Generation with PixelCNN Decoders},
        author={van den Oord, Aaron and Kalchbrenner, Nal and Espeholt, Lasse
                and Vinyals, Oriol and Graves, Alex and Kavukcuoglu, Koray},
        booktitle={Advances in Neural Information Processing Systems},
        year={2016},
        url={https://arxiv.org/pdf/1606.05328.pdf}
      }
      @article{oord2016wavenet,
        title={WaveNet: A Generative Model for Raw Audio},
        author={van den Oord, Aaron and Dieleman, Sander and Zen, Heiga and
                Simonyan, Karen and Vinyals, Oriol and Graves, Alex and
                Kalchbrenner, Nal and Senior, Andrew and Kavukcuoglu, Koray},
        journal={arXiv},
        year={2016},
        url={https://arxiv.org/pdf/1609.03499.pdf},
      }
      @inproceedings{ha2016hypernetworks,
        author={Ha, David and Dai, Andrew and Le, Quoc},
        title={HyperNetworks},
        booktitle={Proceedings of the International Conference on Learning Representations},
        year={2016},
        url={https://arxiv.org/pdf/1609.09106.pdf},
      }
      @inproceedings{kim2017dynamic,
        author={Kim, Taesup and Song, Inchul and Bengio, Yoshua},
        title={Dynamic Layer Normalization for Adaptive Neural Acoustic Modeling
               in Speech Recognition},
        booktitle={Interspeech},
        year={2017},
        url={https://arxiv.org/pdf/1707.06065.pdf},
      }
      @inproceedings{hu2017squeeze,
        author={Hu, Jie and Shen, Li and Sun, Gang},
        title={Squeeze-and-Excitation Networks},
        booktitle={CVPR's ILSVRC 2017 Workshop},
        year={2017},
        url={https://arxiv.org/pdf/1709.01507.pdf},
      }
      @inproceedings{dauphin2017language,
        title={Language modeling with gated convolutional networks},
        author={Dauphin, Yann N and Fan, Angela and Auli, Michael and Grangier, David},
        booktitle={Proceedings of the International Conference on Machine Learning},
        year={2017},
        url={https://arxiv.org/pdf/1612.08083.pdf},
      }
      @inproceedings{gehring2017convolutional,
        author={Gehring, Jonas and Auli, Michael and Grangier, David and Yarats,
                Denis and Dauphin, Yann N.},
        title={Convolution Sequence-to-Sequence Learning},
        booktitle={Proceedings of the International Conference on Machine Learning},
        year={2017},
        url={https://arxiv.org/pdf/1705.03122.pdf},
      }
      @article{hochreiter1997long,
        title={Long Short-Term Memory},
        author={Hochreiter, Sepp and Schmidhuber, J{\"u}rgen},
        journal={Neural Computation},
        volume={9},
        number={8},
        pages={1735--1780},
        year={1997},
        publisher={MIT Press},
        url={http://dx.doi.org/10.1162/neco.1997.9.8.1735},
      }
      @article{tenenbaum2000separating,
        title={Separating Style and Content with Bilinear Models},
        author={Tenenbaum, Joshua B. and Freeman, William T.},
        journal={Neural Computation},
        volume={12},
        number={6},
        pages={1247--1283},
        year={2000},
        publisher={MIT Press},
        url={http://dx.doi.org/10.1162/089976600300015349},
      }
      @article{dhingra2017gated,
        title={Gated-Attention Readers for Text Comprehension},
        author={Dhingra, Bhuwan and Liu, Hanxiao and Yang, Zhilin, and
                Cohen, William W and Salakhutdinov, Ruslan},
        booktitle={Proceedings of the Annual Meeting of the Association for
                   Computational Linguistics},
        year={2017},
        url={https://arxiv.org/pdf/1606.01549.pdf},
      }
      @inproceedings{chaplot2017gated,
        title={Gated-Attention Architectures for Task-Oriented Language Grounding},
        author={Chaplot, Devendra Singh and Sathyendra, Kanthashree Mysore and
                Pasumarthi, Rama Kumar and Rajagopal, Dheeraj and Salakhutdinov,
                Ruslan},
        booktitle={ACL Workshop on Language Grounding for Robotics},
        year={2017},
        url={https://arxiv.org/pdf/1706.07230.pdf},
      }
      @inproceedings{shen2017disan,
        title={DiSAN: Directional Self-Attention Network for RNN/CNN-free
               Language Understanding},
        author={Shen, Tao and Zhou, Tianyi and Long, Guodong and Jiang, Jing and
                Pan, Shirui and Zhang, Chengqi},
        booktitle={arXiv},
        year={2017},
        url={https://arxiv.org/pdf/1709.04696.pdf},
      }
      @inproceedings{bowman2015large,
        title={A large annotated corpus for learning natural language inference},
        author={Bowman, Samuel R. and Angeli, Gabor and Potts, Christopher, and
                Manning, Christopher D.},
        booktitle={Proceedings of the Conference on Empirical Methods in Natural
                   Language Processing},
        year={2015},
        url={https://nlp.stanford.edu/pubs/snli_paper.pdf},
      }
      @article{jacobs1991adaptive,
        title={Adaptive Mixtures of Local Experts},
        author={Jacobs, Robert A. and Jordan, Michael I. and Nowlan, Steven J.
                and Hinton, Geoffrey E.},
        journal={Neural Computation},
        volume={3},
        number={1},
        pages={79--87},
        year={1991},
        publisher={MIT Press},
        url={http://dx.doi.org/10.1162/neco.1991.3.1.79},
      }
      @article{jordan1994hierarchical,
        title={Hierarchical Mixtures of Experts and the EM Algorithm},
        author={Jordan, Michael I. and Jacobs, Robert A.},
        journal={Neural Computation},
        volume={6},
        number={2},
        pages={181--214},
        year={1994},
        publisher={MIT Press},
        url={http://dx.doi.org/10.1162/neco.1994.6.2.181},
      }
      @inproceedings{eigen2014deep,
        author={Eigen, David and Ranzato, Marc'Aurelio and Sutskever, Ilya},
        title={Learning Factored Representations in a Deep Mixture of Experts},
        booktitle={Proceedings of the ICLR Workshops},
        year={2014},
        url={https://arxiv.org/pdf/1312.4314.pdf},
      }
      @article{kirkpatrick2017overcoming,
        title={Overcoming catastrophic forgetting in neural networks},
        author={Kirkpatrick, James and Pascanu, Razvan and Rabinowitz, Neil and
                Veness, Joel and Desjardins, Guillaume and Rusu, Andrei A. and
                Milan, Kieran and Quan, John and Ramalho, Tiago and
                Grabska-Barwinska, Agnieszka and Hassabis, Demis and Clopath,
                Claudia and Kumaran, Dharshan and Hadsell, Raia},
        journal={Proceedings of the National Academy of Sciences},
        volume={114},
        number={13},
        pages={3521--3526},
        year={2017},
        url={http://www.pnas.org/content/114/13/3521.abstract},
      }
      @inproceedings{mel1992clusteron,
        title={The Clusteron: Toward a Simple Abstraction for a Complex Neuron},
        author={Mel, Bartlett W},
        booktitle={Advances in Neural Information Processing Systems},
        year={1992},
        url={http://papers.nips.cc/paper/450-the-clusteron-toward-a-simple-abstraction-for-a-complex-neuron.pdf},
      }
      @article{boutonnet2015words,
        title={Words jump-start vision: A label advantage in object recognition},
        author={B. Boutonnet and G. Lupyan},
        journal={Journal of Neuroscience},
        volume={35},
        number={25},
        pages={9329--9335},
        year={2015},
        publisher={Society for Neuroscience},
        url={},
      }
      @inproceedings{agrawal2015vqa,
        title={VQA: Visual Question Answering},
        author={Agrawal, Aishwarya and Lu, Jiasen and Antol, Stanislaw  and
                Mitchell, Margaret and Zitnick, C. Lawrence and Batra, Dhruv and
                Parikh, Devi},
        booktitle={Proceedings of the International Conference on Computer Vision},
        year={2015},
        url={https://arxiv.org/pdf/1505.00468.pdf},
      }
      @inproceedings{kempa2016vizdoom,
        title={Vizdoom: A doom-based AI research platform for visual reinforcement learning},
        author={Kempka, Michał and Wydmuch, Marek and Runc, Grzegorz and Toczek, Jakub and Jaśkowski, Wojciech},
        booktitle={IEEE Conference on Computational Intelligence and Games},
        year={2016},
        url={https://arxiv.org/pdf/1605.02097.pdf},
      }
      @inproceedings{shazeer2017outrageously,
        title={Outrageously large neural networks: The sparsely-gated mixture-of-experts layer},
        author={Shazeer, Noam and Mirhoseini, Azalia and Maziarz, Krzysztof and Davis, Andy and Le, Quoc and Hinton, Geoffrey and Dean, Jeff},
        booktitle={Proceedings of the International Conference on Learning Representations},
        year={2017},
        url={https://arxiv.org/pdf/1701.06538.pdf},
      }
    </script>
    <!-- <script src="assets/figure_clevr.js"></script> -->
    <script src="assets/figure_guesswhat.js"></script>
    <script src="assets/figure_pixelcnn.js"></script>
    <script src="assets/figure_dln.js"></script>
    <script src="assets/figure_squeeze.js"></script>
    <script src="assets/figure_convseq2seq.js"></script>
    <script src="assets/figure_disan.js"></script>
    <script src="assets/figure_moe.js"></script>
    <script src="assets/figure_clevr_tsne.js"></script>
  </body>
</html>
