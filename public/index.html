<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link href="assets/style.css" type="text/css" rel="stylesheet">
    <script src="https://distill.pub/template.v1.js"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css"
          integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0"
          crossorigin="anonymous">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>

    <script type="text/front-matter">
      title: "Understanding FiLM"
      description: "Description of the post"
      authors:
      - Vincent Dumoulin: https://vdumoulin.github.io
      - Ethan Perez: http://ethanperez.net/
      - Florian Strub: https://fstrub95.github.io/
      - Harm de Vries: http://www-etud.iro.umontreal.ca/~devries/
      - Nathan Schucher: https://nathanschucher.com/
      - Aaron Courville: https://aaroncourville.wordpress.com/
      - Yoshua Bengio: http://www.iro.umontreal.ca/~bengioy/yoshua_en/
      affiliations:
      - MILA: https://mila.quebec/en/
      - Rice University: http://www.rice.edu/
      - Univ. of Lille, Inria: https://team.inria.fr/sequel/
      - MILA: https://mila.quebec/en/
      - Element AI: https://element.ai/
      - MILA: https://mila.quebec/en/
      - MILA: https://mila.quebec/en/
    </script>
  </head>
  <body>
    <dt-article>
      <h1>Feature-wise transformations</h1>
      <h2>A family of methods for fusing multiple sources of information</h2>

      <dt-byline></dt-byline>

      <svg viewBox="0 0 0 0" style="display: none;" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <rect id="vector-patch-positive" width="30" height="30" rx="6" ry="6" opacity="0.8" style="fill: rgb(221, 58, 150);"/>
          <rect id="vector-patch-negative" width="30" height="30" rx="6" ry="6" opacity="0.8" style="fill: #3a5edd;"/>
          <rect id="convolutional-patch-positive" width="20" height="20" rx="6" ry="6" opacity="0.8" style="fill: rgb(221, 58, 150);"/>
          <rect id="convolutional-patch-negative" width="20" height="20" rx="6" ry="6" opacity="0.8" style="fill: #3a5edd;"/>

          <path id="arrow-left" d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" transform="rotate(180, 0, 0)"/>
          <path id="arrow-right" d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z"/>
          <path id="arrow-up" d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z"/>
          <path id="arrow-down" d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" transform="rotate(180, 0, 0)"/>

          <path id="convolutional-feature" d="M 0 0 l 30 0 l 0 30 l -30 0 Z"/>
          <g id="vector-arrow">
            <path d="M 0 0 l 0 -16"/>
            <path d="M 0 -16 l -4 4 l 4 -4 l 4 4"/>
          </g>
          <g id="convolutional-arrow">
            <path d="M 0 0 L 0 -12"/>
            <path d="M -3 -9 L 0 -12 L 3 -9"/>
          </g>

          <path id="row-left" d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z"/>
          <path id="row-middle" d="M 0 0 l 20 0 l 0 20 l -20 0 Z"/>
          <path id="row-right" d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 8 a 6 6 0 0 1 -6 6 l -14 0 Z"/>
          <path id="big-row-left" d="M 0 6 a 6 6 0 0 1 6 -6 l 34 0 l 0 40 l -34 0 a 6 6 0 0 1 -6 -6 Z"/>
          <path id="big-row-middle" d="M 0 0 l 40 0 l 0 40 l -40 0 Z"/>
          <path id="big-row-right" d="M 0 0 l 34 0 a 6 6 0 0 1 6 6 l 0 28 a 6 6 0 0 1 -6 6 l -34 0 Z"/>
          <path id="column-top" d="M 0 6 a 6 6 0 0 1 6 -6 l 8 0 a 6 6 0 0 1 6 6 l 0 14 l -20 0 Z"/>
          <path id="column-middle" d="M 0 0 l 20 0 l 0 20 l -20 0 Z"/>
          <path id="column-bottom" d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -8 0 a 6 6 0 0 1 -6 -6 Z"/>
          <path id="matrix-top-left" d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -20 0 Z"/>
          <path id="matrix-top-right" d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 14l -20 0 Z"/>
          <path id="matrix-bottom-left" d="M 0 0 l 20 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z"/>
          <path id="matrix-bottom-right" d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -14 0 Z"/>
          <path id="matrix-center" d="M 0 0 l 20 0 l 0 20 l -20 0 Z"/>
          <path id="singleton" d="M 0 6 a 6 6 0 0 1 6 -6 l 8 0 a 6 6 0 0 1 6 6 l 0 8 a 6 6 0 0 1 -6 6 l -8 0 a 6 6 0 0 1 -6 -6 Z"/>

          <path id="curly-brace-horizontal" d="M 0 0 C 0 -16 42.5 0 42.5 -16 C 42.5 0 85 -16 85 0"/>
          <path id="big-curly-brace-horizontal" d="M 0 0 C 0 -16 52.5 0 52.5 -16 C 52.5 0 105 -16 105 0"/>
          <path id="bigger-curly-brace-horizontal" d="M 0 0 C 0 -20 90 0 90 -20 C 90 0 180 -20 180 0"/>
          <path id="curly-brace-vertical" d="M 0 0 C 12 0 0 30 12 30 C 0 30 12 60 0 60"/>
          <path id="parenthesis-left" d="M 10 0 C -2 0 -2 80 10 80"/>
          <path id="parenthesis-right" d="M 0 0 C 8 0 8 80 0 80"/>
        </defs>
      </svg>

      <p>
        We often think of neural networks as a mapping from a raw source of
        information to a more abstract and useful representation &mdash; pixel
        values to object classes, audio waveform to text, etc. In practice,
        however, it is frequent that a task requires handling multiple sources
        of information; this is sometimes referred to multimodal learning. 
        It could be that a model is given access to both the
        video sequence and the audio waveform of a movie scene and is asked to
        predict what is going on:
      </p>
      <figure class="l-body-outset">
        <svg viewBox="0 0 744 308" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <filter x="0" y="0" width="1" height="1" id="zoolander-text-background">
              <feFlood flood-color="#fdf6f2"/>
              <feComposite in="SourceGraphic"/>
            </filter>
            <symbol id="zoolander" viewBox="0 0 744 308">
              <rect x="0" y="0" width="744" height="308" fill="#b6b8cb" />
              <g transform="scale(2.906250) translate(0.5 0.5)">
                <polygon fill="#0f0a07" fill-opacity="0.501961" points="176,112 183,4 144,80" />
                <polygon fill="#28323d" fill-opacity="0.501961" points="211,121 188,72 201,51" />
                <polygon fill="#dfe2f3" fill-opacity="0.501961" points="113,109 -16,81 10,-16" />
                <polygon fill="#593527" fill-opacity="0.501961" points="174,69 185,10 159,0" />
                <polygon fill="#d6d7f0" fill-opacity="0.501961" points="265,121 271,-8 169,23" />
                <polygon fill="#fffbff" fill-opacity="0.501961" points="81,121 158,116 164,80" />
                <polygon fill="#8f8c95" fill-opacity="0.501961" points="148,84 45,82 69,40" />
                <polygon fill="#0c151e" fill-opacity="0.501961" points="150,85 169,68 125,80" />
                <polygon fill="#c7d1ef" fill-opacity="0.501961" points="-12,-8 225,-16 -16,74" />
                <polygon fill="#202125" fill-opacity="0.501961" points="165,68 160,121 181,106" />
                <polygon fill="#f0fcff" fill-opacity="0.501961" points="206,36 180,49 176,74" />
                <polygon fill="#000000" fill-opacity="0.501961" points="182,10 174,5 155,13" />
                <polygon fill="#cac7df" fill-opacity="0.501961" points="114,40 60,91 193,27" />
                <polygon fill="#000000" fill-opacity="0.501961" points="181,48 172,66 169,35" />
                <polygon fill="#9da5bb" fill-opacity="0.501961" points="172,86 193,58 203,109" />
                <polygon fill="#19222b" fill-opacity="0.501961" points="155,46 163,74 148,84" />
                <polygon fill="#f6e4e6" fill-opacity="0.501961" points="175,121 123,78 45,121" />
                <polygon fill="#16313f" fill-opacity="0.501961" points="91,62 82,51 65,51" />
                <polygon fill="#474c55" fill-opacity="0.501961" points="199,58 207,78 173,80" />
                <polygon fill="#dac4bb" fill-opacity="0.501961" points="70,121 101,62 -11,112" />
                <polygon fill="#f1bdaf" fill-opacity="0.501961" points="177,11 187,41 165,16" />
                <polygon fill="#d1d7ef" fill-opacity="0.501961" points="185,121 176,80 199,87" />
                <polygon fill="#b5b7d3" fill-opacity="0.501961" points="138,80 169,-10 69,-16" />
                <polygon fill="#030000" fill-opacity="0.501961" points="183,10 184,24 172,5" />
                <polygon fill="#7f7685" fill-opacity="0.501961" points="92,89 109,59 111,91" />
                <polygon fill="#ffebf2" fill-opacity="0.501961" points="122,80 109,67 128,68" />
                <polygon fill="#d1d8ef" fill-opacity="0.501961" points="67,53 -15,19 -5,121" />
                <polygon fill="#7a94a9" fill-opacity="0.501961" points="154,46 167,49 177,84" />
                <polygon fill="#2d2728" fill-opacity="0.501961" points="126,74 151,85 125,81" />
                <polygon fill="#f8f2f5" fill-opacity="0.501961" points="93,65 89,105 80,60" />
                <polygon fill="#cfd0e7" fill-opacity="0.501961" points="205,97 261,121 271,26" />
                <polygon fill="#0c0200" fill-opacity="0.501961" points="162,11 163,24 168,9" />
                <polygon fill="#ecf5ff" fill-opacity="0.501961" points="187,56 176,70 187,31" />
                <polygon fill="#657b9d" fill-opacity="0.501961" points="84,66 62,68 59,55" />
                <polygon fill="#c4c6e3" fill-opacity="0.501961" points="155,34 149,74 7,13" />
                <polygon fill="#3c454f" fill-opacity="0.501961" points="205,84 200,48 192,61" />
                <polygon fill="#00010f" fill-opacity="0.501961" points="168,41 174,70 180,40" />
                <polygon fill="#aeb3c9" fill-opacity="0.501961" points="185,70 194,81 195,36" />
                <polygon fill="#c0c5ec" fill-opacity="0.501961" points="158,121 163,77 152,91" />
                <polygon fill="#c2c6e0" fill-opacity="0.501961" points="211,44 176,-2 258,-1" />
                <polygon fill="#161a1f" fill-opacity="0.501961" points="207,107 203,110 201,92" />
                <polygon fill="#7087a1" fill-opacity="0.501961" points="100,66 63,42 91,50" />
                <polygon fill="#a6abca" fill-opacity="0.501961" points="125,80 160,93 124,92" />
                <polygon fill="#424956" fill-opacity="0.501961" points="182,27 181,39 185,36" />
                <polygon fill="#0a060a" fill-opacity="0.501961" points="140,85 156,79 156,84" />
                <polygon fill="#b4b7cf" fill-opacity="0.501961" points="166,-11 145,81 72,-16" />
                <polygon fill="#8a8fa9" fill-opacity="0.501961" points="195,101 200,95 176,83" />
                <polygon fill="#43505b" fill-opacity="0.501961" points="161,44 156,74 153,50" />
                <polygon fill="#ffe1e0" fill-opacity="0.501961" points="165,17 179,15 167,13" />
                <polygon fill="#140f17" fill-opacity="0.501961" points="130,77 130,70 125,79" />
                <polygon fill="#bcc1dc" fill-opacity="0.501961" points="152,47 150,-16 168,40" />
                <polygon fill="#d6e1fd" fill-opacity="0.501961" points="64,54 95,64 81,66" />
                <polygon fill="#a5a9bc" fill-opacity="0.501961" points="200,63 220,103 210,50" />
                <polygon fill="#c5b0a9" fill-opacity="0.501961" points="24,90 82,96 12,121" />
                <polygon fill="#fff8f8" fill-opacity="0.501961" points="83,86 81,121 103,93" />
                <polygon fill="#5d6879" fill-opacity="0.501961" points="138,72 147,82 158,72" />
                <polygon fill="#110600" fill-opacity="0.501961" points="185,17 178,5 166,7" />
                <polygon fill="#9ba5c6" fill-opacity="0.501961" points="81,87 46,85 78,71" />
                <polygon fill="#e8b2a6" fill-opacity="0.501961" points="177,12 174,33 181,39" />
                <polygon fill="#090f13" fill-opacity="0.501961" points="198,75 198,58 204,79" />
                <polygon fill="#404046" fill-opacity="0.501961" points="172,75 161,106 184,121" />
                <polygon fill="#faf9ff" fill-opacity="0.501961" points="200,94 195,95 197,86" />
                <polygon fill="#c0c2dd" fill-opacity="0.501961" points="152,109 162,77 162,97" />
                <polygon fill="#fff7e9" fill-opacity="0.501961" points="38,91 48,91 44,68" />
                <polygon fill="#545d6c" fill-opacity="0.501961" points="113,68 92,75 108,75" />
                <polygon fill="#70513f" fill-opacity="0.501961" points="172,23 165,31 161,11" />
                <polygon fill="#c9d1e9" fill-opacity="0.501961" points="-16,3 59,74 58,-16" />
                <polygon fill="#dce3f3" fill-opacity="0.501961" points="192,58 176,67 185,32" />
                <polygon fill="#717989" fill-opacity="0.501961" points="211,90 191,69 168,74" />
                <polygon fill="#c6c0d8" fill-opacity="0.501961" points="97,65 125,59 150,73" />
                <polygon fill="#ffdde5" fill-opacity="0.501961" points="128,75 118,68 110,75" />
                <polygon fill="#3a4d58" fill-opacity="0.501961" points="80,57 73,49 61,49" />
                <polygon fill="#868095" fill-opacity="0.501961" points="218,114 216,89 213,100" />
                <polygon fill="#8998b0" fill-opacity="0.501961" points="97,62 79,46 68,49" />
                <polygon fill="#e8edf5" fill-opacity="0.501961" points="208,104 217,115 210,84" />
                <polygon fill="#1b1e28" fill-opacity="0.501961" points="168,47 176,66 181,37" />
                <polygon fill="#c9bcc8" fill-opacity="0.501961" points="130,98 125,121 102,78" />
                <polygon fill="#ffffff" fill-opacity="0.501961" points="97,68 93,71 101,72" />
                <polygon fill="#120000" fill-opacity="0.501961" points="184,18 179,16 181,23" />
                <polygon fill="#bcc1d9" fill-opacity="0.501961" points="198,10 147,-2 256,-13" />
                <polygon fill="#000000" fill-opacity="0.501961" points="170,6 161,15 177,9" />
                <polygon fill="#978f91" fill-opacity="0.501961" points="63,80 46,75 82,72" />
                <polygon fill="#07090d" fill-opacity="0.501961" points="156,84 162,72 158,64" />
                <polygon fill="#eec6cc" fill-opacity="0.501961" points="169,21 175,29 190,25" />
                <polygon fill="#818b9a" fill-opacity="0.501961" points="176,77 165,70 167,46" />
                <polygon fill="#605e6d" fill-opacity="0.501961" points="98,84 103,90 106,81" />
                <polygon fill="#908ea7" fill-opacity="0.501961" points="210,70 211,59 219,80" />
                <polygon fill="#000000" fill-opacity="0.501961" points="177,97 176,92 175,101" />
                <polygon fill="#e6ebf4" fill-opacity="0.501961" points="173,80 192,88 191,82" />
                <polygon fill="#f2f6ff" fill-opacity="0.501961" points="207,107 171,121 182,101" />
                <polygon fill="#262829" fill-opacity="0.501961" points="143,79 158,85 135,83" />
                <polygon fill="#fef7f9" fill-opacity="0.501961" points="152,94 130,95 152,120" />
                <polygon fill="#a76c4e" fill-opacity="0.501961" points="182,38 169,36 166,27" />
                <polygon fill="#b1bee0" fill-opacity="0.501961" points="146,79 133,77 141,76" />
                <polygon fill="#000000" fill-opacity="0.501961" points="177,57 170,53 175,70" />
                <polygon fill="#6e788b" fill-opacity="0.501961" points="77,47 64,44 64,40" />
                <polygon fill="#b1b5ca" fill-opacity="0.501961" points="138,22 180,-2 98,-15" />
                <polygon fill="#fdf6f2" fill-opacity="0.501961" points="117,91 123,72 123,91" />
                <polygon fill="#d1d9ed" fill-opacity="0.501961" points="191,60 187,31 181,71" />
                <polygon fill="#cdcfe6" fill-opacity="0.501961" points="217,60 247,106 220,121" />
              </g>
            </symbol>
          </defs>
          <use xlink:href="#zoolander" width="744" height="308" transform="translate(0, 0)"/>
          <path d="M 0 0 C 15 -50 27.5 -50 42.5 0 S 70 50 85 0 S 110.5 -50 127.5 0 S 155 50 170 0 S 197.5 -50 212.5 0 S 240 50 255 0 S 282.5 -50 297.5 0 S 325 50 340 0 S 367.5 -50 382.5 0 S 410 50 425 0" style="fill: none; stroke: #fdf6f2; stroke-width: 3px;" transform="translate(10, 53)"/>
          <text filter="url(#zoolander-text-background)" x="222.5" y="53" dy="0.4em" style="opacity: 1; font-size: 18; text-anchor: middle;" class="figure-text">"What is this? A center for ants?"</text>
        </svg>
        <figcaption>
          We would like a neural network to process a movie's video feed and
          audio waveform and predict that a man is angered because he thinks the
          <em>Derek Zoolander Center For Children Who Can't Read Good And Wanna
          Learn To Do Other Stuff Good Too</em> has a size suitable for ants but
          not humans.<br><br>
          <em>
            Credit: still frame taken from the </em>Zoolander<em> movie and
            vectorized.
          </em>
        </figcaption>
      </figure>
      <p>
        It could also be that an image needs to be processed in the context of a
        question being asked:
      </p>
      <figure class="l-body-outset">
        <svg viewBox="0 0 744 396" xmlns="http://www.w3.org/2000/svg">
          <defs>
          <symbol id="clevr-example" viewBox="0 0 744 494">
            <rect x="0" y="0" width="744" height="494" fill="#787573" />
            <g transform="scale(2.906250) translate(0.5 0.5)">
            <ellipse fill="#aba9a2" fill-opacity="0.501961" cx="205" cy="167" rx="84" ry="65" />
            <ellipse fill="#160031" fill-opacity="0.501961" cx="221" cy="67" rx="19" ry="19" />
            <g transform="translate(125.708474 46.551788) rotate(330.557727) scale(26.525960 18.103194)"><ellipse fill="#6a6600" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <rect fill="#320053" fill-opacity="0.501961" x="60" y="96" width="26" height="28" />
            <ellipse fill="#5d605c" fill-opacity="0.501961" cx="161" cy="16" rx="255" ry="25" />
            <ellipse fill="#787300" fill-opacity="0.501961" cx="128" cy="117" rx="17" ry="17" />
            <ellipse fill="#4b2600" fill-opacity="0.501961" cx="37" cy="71" rx="12" ry="11" />
            <polygon fill="#161919" fill-opacity="0.501961" points="92.189760,92.254287,94.452459,73.302892,111.905887,77.034297,106.658108,93.510251" />
            <ellipse fill="#563000" fill-opacity="0.501961" cx="162" cy="99" rx="11" ry="11" />
            <ellipse fill="#8c8c89" fill-opacity="0.501961" cx="91" cy="157" rx="52" ry="32" />
            <g transform="translate(138.189343 79.694294) rotate(52.055307) scale(19.865591 32.665661)"><ellipse fill="#939490" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <ellipse fill="#878990" fill-opacity="0.501961" cx="10" cy="107" rx="51" ry="30" />
            <rect fill="#4b036e" fill-opacity="0.501961" x="173" y="53" width="17" height="18" />
            <g transform="translate(73.292964 76.275453) rotate(233.931916) scale(17.956891 28.126100)"><ellipse fill="#8e9094" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <g transform="translate(233.487888 111.089100) rotate(205.723154) scale(93.998829 14.001511)"><ellipse fill="#8a8a8a" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <polygon fill="#98902c" fill-opacity="0.501961" points="139.474450,20.617017,149.869316,24.342256,140.778266,61.674496,122.313449,23.466980" />
            <polygon fill="#000000" fill-opacity="0.501961" points="226,50 239,53 236,70" />
            <g transform="translate(125.516735 45.151467) rotate(264.937976) scale(6.839792 4.335868)"><ellipse fill="#110d00" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <ellipse fill="#2e3007" fill-opacity="0.501961" cx="109" cy="43" rx="7" ry="7" />
            <g transform="translate(216 70) rotate(207) scale(27 30)"><rect fill="#532260" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <rect fill="#888786" fill-opacity="0.501961" x="88" y="94" width="27" height="76" />
            <polygon fill="#502061" fill-opacity="0.501961" points="80.645998,94.556079,61.181535,103.793335,64.979954,129.808199,90.523482,120.181817" />
            <g transform="translate(225 62) rotate(284) scale(8 4)"><rect fill="#eea8fe" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <g transform="translate(217.138122 169.000000) rotate(267.845952) scale(28.478573 46.954917)"><ellipse fill="#9f9c96" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <polygon fill="#272705" fill-opacity="0.501961" points="119,111 131,116 123,105" />
            <polygon fill="#0d0013" fill-opacity="0.501961" points="213,65 224,48 219,68" />
            <g transform="translate(247.909658 36.173525) rotate(213.893250) scale(100.861896 21.554483)"><ellipse fill="#636366" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <g transform="translate(12 79) rotate(69) scale(35 32)"><rect fill="#85888f" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <ellipse fill="#7a7b7c" fill-opacity="0.501961" cx="25" cy="139" rx="43" ry="43" />
            <rect fill="#868582" fill-opacity="0.501961" x="174" y="93" width="82" height="30" />
            <g transform="translate(50 29) rotate(164) scale(135 43)"><rect fill="#6b6b6e" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <polygon fill="#848588" fill-opacity="0.501961" points="34,48 77,53 106,120" />
            <g transform="translate(120 43) rotate(340) scale(2 11)"><rect fill="#e1dc7d" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <polygon fill="#868580" fill-opacity="0.501961" points="113.374580,106.911455,132.267064,54.607784,167.649308,54.834305,153.669087,100.733169" />
            <g transform="translate(234 65) rotate(350) scale(12 9)"><rect fill="#100017" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <polygon fill="#8d8c82" fill-opacity="0.501961" points="201.359040,121.504975,147.236945,106.210705,143.988580,127.588179,63.819599,185.000000" />
            <polygon fill="#633574" fill-opacity="0.501961" points="242,67 201,73 232,83" />
            <polygon fill="#61601e" fill-opacity="0.501961" points="113,111 143,106 128,101" />
            <polygon fill="#331b3f" fill-opacity="0.501961" points="68.996641,109.013922,60.656842,99.228405,83.473454,95.001271,81.171513,105.592762" />
            <polygon fill="#898887" fill-opacity="0.501961" points="101.634806,64.613793,199.711802,76.376723,133.722273,97.759710,88.296521,60.784516" />
            <g transform="translate(136.077164 127.797876) rotate(298.899296) scale(13.083977 8.197030)"><ellipse fill="#958f44" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <rect fill="#2a2a07" fill-opacity="0.501961" x="110" y="36" width="6" height="17" />
            <polygon fill="#888684" fill-opacity="0.501961" points="189.780843,56.247083,208.753441,106.358078,163.891539,120.194219,185.445459,78.011235" />
            <polygon fill="#32342e" fill-opacity="0.501961" points="123,64 105,64 102,58" />
            <ellipse fill="#d592e8" fill-opacity="0.501961" cx="217" cy="54" rx="2" ry="2" />
            <polygon fill="#8d883c" fill-opacity="0.501961" points="102.884517,53.297958,152.191533,48.485184,147.602540,55.367423,109.832442,59.990720" />
            <ellipse fill="#1c1d21" fill-opacity="0.501961" cx="96" cy="82" rx="5" ry="4" />
            <polygon fill="#5b451e" fill-opacity="0.501961" points="53,76 26,62 33,81" />
            <polygon fill="#4d4a12" fill-opacity="0.501961" points="119.665976,43.984909,122.629583,27.362492,129.258432,41.560572,122.712145,56.681919" />
            <g transform="translate(50.560297 93.025485) rotate(256.299010) scale(8.783589 43.797749)"><ellipse fill="#87878a" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <polygon fill="#6b6a6b" fill-opacity="0.501961" points="228.912393,23.741565,249.361517,96.655349,230.150048,82.863047,260.121319,49.054356" />
            <ellipse fill="#745626" fill-opacity="0.501961" cx="165" cy="96" rx="9" ry="9" />
            <polygon fill="#767779" fill-opacity="0.501961" points="104,28 101,58 2,57" />
            <rect fill="#653275" fill-opacity="0.501961" x="70" y="107" width="17" height="17" />
            <g transform="translate(135.507193 114.755356) rotate(144.964218) scale(13.598709 1.000000)"><ellipse fill="#59561e" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <g transform="translate(118.744478 41.974558) rotate(293.476076) scale(3.644219 1.000000)"><ellipse fill="#fffdad" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <polygon fill="#181713" fill-opacity="0.501961" points="109,77 105,75 106,87" />
            <rect fill="#67502a" fill-opacity="0.501961" x="28" y="60" width="19" height="12" />
            <rect fill="#6d6e6f" fill-opacity="0.501961" x="149" y="26" width="84" height="23" />
            <polygon fill="#939088" fill-opacity="0.501961" points="135.196093,82.171660,145.004198,109.554043,146.705906,133.885818,180.620442,151.673506" />
            <polygon fill="#6a6b68" fill-opacity="0.501961" points="113.852779,119.068419,120.690816,100.316028,101.785872,119.178530,116.878523,129.867087" />
            <g transform="translate(82 91) rotate(49) scale(55 8)"><rect fill="#888888" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <g transform="translate(234 59) rotate(328) scale(5 9)"><rect fill="#000001" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <g transform="translate(221 51) rotate(350) scale(12 5)"><rect fill="#350f42" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <rect fill="#878683" fill-opacity="0.501961" x="97" y="136" width="41" height="34" />
            <g transform="translate(107.522892 44.166550) rotate(131.142274) scale(1.000000 5.317795)"><ellipse fill="#777749" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <rect fill="#707473" fill-opacity="0.501961" x="195" y="50" width="9" height="21" />
            <polygon fill="#707074" fill-opacity="0.501961" points="43,113 66,135 58,98" />
            <g transform="translate(203.075339 76.127531) rotate(151.066102) scale(4.536752 5.364959)"><ellipse fill="#515952" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <polygon fill="#6a6a6b" fill-opacity="0.501961" points="218,-1 -13,56 -2,-16" />
            <polygon fill="#898888" fill-opacity="0.501961" points="89,98 126,100 88,120" />
            <g transform="translate(179 63) rotate(194) scale(13 17)"><rect fill="#5d2d70" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <g transform="translate(99 82) rotate(188) scale(4 11)"><rect fill="#18171b" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <g transform="translate(103 80) rotate(281) scale(8 1)"><rect fill="#8a8983" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <ellipse fill="#1a1a02" fill-opacity="0.501961" cx="127" cy="45" rx="4" ry="4" />
            <polygon fill="#7b766f" fill-opacity="0.501961" points="174.949224,115.622660,164.035190,118.026592,155.088962,114.781777,173.868205,105.568704" />
            <polygon fill="#41361e" fill-opacity="0.501961" points="155,106 155,94 166,109" />
            <rect fill="#868036" fill-opacity="0.501961" x="131" y="22" width="17" height="32" />
            <polygon fill="#86857c" fill-opacity="0.501961" points="147.846694,56.441087,173.844702,44.991459,129.784016,82.089645,129.896429,55.122574" />
            <rect fill="#464444" fill-opacity="0.501961" x="94" y="84" width="16" height="8" />
            <polygon fill="#888886" fill-opacity="0.501961" points="105,67 115,87 167,86" />
            <polygon fill="#868386" fill-opacity="0.501961" points="172.724527,70.747815,161.316424,54.381340,175.215059,100.995351,190.751483,72.971890" />
            <rect fill="#4d4c0d" fill-opacity="0.501961" x="111" y="34" width="13" height="3" />
            <polygon fill="#8b8537" fill-opacity="0.501961" points="111.620419,128.228236,145.663994,110.559286,144.162849,127.224071,139.720478,130.414681" />
            <rect fill="#7c7b77" fill-opacity="0.501961" x="150" y="33" width="17" height="31" />
            <g transform="translate(229 53) rotate(204) scale(6 7)"><rect fill="#1a0024" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <ellipse fill="#7d7a7c" fill-opacity="0.501961" cx="22" cy="138" rx="80" ry="14" />
            <ellipse fill="#3e3c3c" fill-opacity="0.501961" cx="218" cy="83" rx="14" ry="2" />
            <rect fill="#fffeff" fill-opacity="0.501961" x="225" y="59" width="2" height="2" />
            <polygon fill="#808081" fill-opacity="0.501961" points="95,49 49,59 51,82" />
            <g transform="translate(120 112) rotate(114) scale(1 13)"><rect fill="#272507" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <rect fill="#532664" fill-opacity="0.501961" x="225" y="61" width="4" height="6" />
            <polygon fill="#868583" fill-opacity="0.501961" points="153,80 222,87 271,137" />
            <rect fill="#423e1d" fill-opacity="0.501961" x="119" y="61" width="10" height="3" />
            <g transform="translate(140.462528 111.493852) rotate(234.002234) scale(1.000000 7.144396)"><ellipse fill="#444015" fill-opacity="0.501961" cx="0" cy="0" rx="1" ry="1" /></g>
            <ellipse fill="#200b26" fill-opacity="0.501961" cx="216" cy="64" rx="4" ry="6" />
            <rect fill="#3e403d" fill-opacity="0.501961" x="101" y="57" width="6" height="4" />
            <g transform="translate(94 74) rotate(249) scale(3 27)"><rect fill="#898a88" fill-opacity="0.501961" x="-0.5" y="-0.5" width="1" height="1" /></g>
            <polygon fill="#7b7628" fill-opacity="0.501961" points="123,34 123,20 139,47" />
            <polygon fill="#603073" fill-opacity="0.501961" points="235,74 203,64 212,78" />
            </g>
            </symbol>
          </defs>
          <use xlink:href="#clevr-example" width="744" height="494" transform="scale(0.8) translate(74.4, 0)"/>
          <text x="372" y="368" dy="0.4em" style="fill: white; opacity: 0.8; font-size: 14; text-anchor: middle;" class="figure-text">Are there more cubes than yellow things?</text>
        </svg>
        <figcaption>
          We would like a neural network to answer a textual question on an
          input image.<br><br>
          <em>
            Credit: image-question pair taken from the CLEVR dataset.
          </em>
        </figcaption>
      </figure>
      <p>
        This gives rise to the need for principled &mdash; and efficient &mdash;
        ways of handling multiple information sources, to <em>fuse</em> them, to
        influence (or <em>condition</em>) the way in which one source is
        processed in the context of another.
      </p>
      <p>
        <a href="https://distill.pub/2016/augmented-rnns/">Attention</a> is a
        good example of one such principled approach: an attention-equipped
        neural network has the ability to focus on specific subsets of its
        inputs at different points in time along the computation of its outputs:
      </p>
      <figure id="attentional-ex2" class="l-body-outset">
        <pre id="attentional-ex2-data" style="display: none;">
          0.50, 0.02, 0.04, 0.00, 0.00, 0.00, 0.00, 0.00, 0.01, 0.01, 0.00, 0.00, 0.00, 0.05, 0.05
          0.14, 0.89, 0.07, 0.00, 0.00, 0.00, 0.00, 0.00, 0.01, 0.06, 0.00, 0.00, 0.00, 0.02, 0.00
          0.02, 0.00, 0.56, 0.00, 0.00, 0.00, 0.00, 0.01, 0.00, 0.00, 0.00, 0.00, 0.00, 0.02, 0.00
          0.00, 0.00, 0.01, 0.61, 0.02, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00
          0.00, 0.00, 0.02, 0.03, 0.01, 0.21, 0.97, 0.05, 0.00, 0.00, 0.00, 0.00, 0.00, 0.01, 0.00
          0.00, 0.00, 0.02, 0.07, 0.25, 0.76, 0.02, 0.04, 0.00, 0.00, 0.00, 0.00, 0.00, 0.02, 0.00
          0.02, 0.04, 0.03, 0.27, 0.71, 0.02, 0.00, 0.02, 0.00, 0.00, 0.02, 0.00, 0.00, 0.05, 0.01
          0.02, 0.00, 0.07, 0.00, 0.00, 0.00, 0.00, 0.60, 0.40, 0.01, 0.04, 0.00, 0.00, 0.13, 0.01
          0.13, 0.02, 0.02, 0.00, 0.01, 0.00, 0.00, 0.23, 0.52, 0.91, 0.07, 0.00, 0.00, 0.10, 0.00
          0.04, 0.00, 0.01, 0.00, 0.00, 0.00, 0.00, 0.01, 0.03, 0.00, 0.67, 0.00, 0.00, 0.16, 0.02
          0.02, 0.00, 0.04, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.14, 0.96, 0.00, 0.02, 0.07
          0.02, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.02, 0.02, 1.00, 0.02, 0.03
          0.02, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.01, 0.00, 0.01, 0.00, 0.00, 0.32, 0.11
          0.04, 0.00, 0.08, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.01, 0.00, 0.00, 0.04, 0.67
        </pre>
        <svg>
          <defs>
            <marker id="edgeArrowhead" viewBox="0 -5 10 10" markerWidth="6" markerHeight="10" orient="auto" refX="5" refY="0">
              <path d="M0,-5L5,0L0,5" fill="none" stroke="#666"></path>
            </marker>
            <marker id="edgeArrowheadLeft" viewBox="0 -5 10 10" markerWidth="6" markerHeight="10" orient="auto" refX="0" refY="0">
              <path d="M5,-5L0,0L5,5" fill="none" stroke="#666"></path>
            </marker>
          </defs>
          <g class="labels" style="display: none;">
            <text transform="translate(0, 20)">output text</text>
            <text transform="translate(0, 65)">network B</text>
            <text transform="translate(0, 185)">network A</text>
            <text transform="translate(0, 233)">input text</text>
          </g>
        </svg>
        <figcaption>
          In this sequence-to-sequence translation model, output tokens are
          computed by attending to different subsets of input tokens.<br><br>
          <em>
            Credit: diagram derived from Fig. 3 of
            <a href="https://arxiv.org/pdf/1409.0473.pdf">Bahdanau, <i>et al.</i> 2014</a>,
            originally featured in the
            <a href="https://distill.pub/2016/augmented-rnns/">Distill article on attention</a>.
          </em>
        </figcaption>
      </figure>
      <script>
        (function() {
            var labelsA = ["the", "agreement", "on", "the", "European",
                           "Economic", "Area", "was", "signed", "in", "August",
                           "1992", ".", "<end>"];
            var labelsB = ["l’", "accord", "sur", "la", "zone", "économique",
                           "européenne", "a", "été", "signé", "en", "août",
                           "1992", ".", "<end>"];
            var data = d3.csvParseRows(d3.select("#attentional-ex2-data").text());
            var linkData = [];
            data.forEach(function(a, ai) {
              a.forEach(function(b, bi) {
                linkData.push({ai: +ai, bi: +bi, v: +data[ai][bi]});
              });
            });

            var nodeMargin = 10;
            var networkMargin = 120;
            var html = d3.select("#attentional-ex2");
            var outerWidth = 984;
            var outerHeight = 240;
            var margin = {top: 36, right: nodeMargin, bottom: 24, left: nodeMargin};
            var width = outerWidth - margin.left - margin.right;
            var height = outerHeight - margin.top - margin.bottom;
            var xa = d3.scaleBand()
                .domain(d3.range(labelsA.length))
                .paddingInner(0.5)
                .range([nodeMargin, width - nodeMargin]);
            var xb = d3.scaleBand()
                .domain(d3.range(labelsB.length))
                .paddingInner(0.5)
                .range([nodeMargin, width - nodeMargin]);
            var nodeSizeA = xa.bandwidth();
            var nodeSizeB = xb.bandwidth();
            var networkHeightA = nodeSizeA + nodeMargin * 2;
            var networkHeightB = nodeSizeB + nodeMargin * 2;
            var link = function(d) {
              var p = "M" + (xb(d.bi) + nodeSizeB / 2) + "," + (nodeSizeB + nodeMargin)
                  + "C" + (xb(d.bi) + nodeSizeB / 2) + "," + (nodeSizeB + networkMargin / 3 + nodeMargin)
                  + " " + (xa(d.ai) + nodeSizeA / 2) + "," + (networkMargin - networkMargin / 3 + nodeMargin)
                  + " " + (xa(d.ai) + nodeSizeA / 2) + "," + (networkMargin + nodeMargin);
              return p;
            };

            html.select("svg .labels")
                .attr("transform", "translate(" + (width + nodeMargin * 3) + ", 0)");
            var svg = html.select("svg")
                .attr("viewBox", "0 0 " + outerWidth + " " + outerHeight)
              .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            var networkA = svg.append("g")
                .attr("transform", "translate(0, " + networkMargin + ")");
            networkA.append("rect")
                .attr("class", "background")
                .attr("width", width)
                .attr("height", nodeSizeA + 2 * nodeMargin)
                .attr("rx", nodeMargin * 0.7)
                .attr("ry", nodeMargin * 0.7);
            var cellA = networkA.selectAll(".cell")
                .data(labelsA)
              .enter().append("g")
                .attr("class", "cell")
                .attr("transform", function(d, i) { return "translate(" + xa(i) + ", " + nodeMargin + ")"; })
            cellA.append("rect")
                .attr("class", "shadow")
                .attr("transform", "translate(1, 3)")
                .attr("width", nodeSizeA)
                .attr("height", nodeSizeA)
                .attr("rx", 4)
                .attr("ry", 4);
            cellA.append("rect")
                .attr("class", "node")
                .attr("width", nodeSizeA)
                .attr("height", nodeSizeA)
                .attr("rx", 4)
                .attr("ry", 4);
            cellA.append("line")
                .attr("class", "arrow")
                .attr("marker-start", "url(#edgeArrowheadLeft)")
                .attr("marker-end", "url(#edgeArrowhead)")
                .attr("x1", nodeSizeA + 8)
                .attr("x2", nodeSizeA + nodeMargin + 20)
                .attr("y1", nodeSizeA / 2)
                .attr("y2", nodeSizeA / 2);
            cellA.append("line")
                .attr("class", "arrow")
                .attr("marker-end", "url(#edgeArrowhead)")
                .attr("transform", "translate(" + nodeSizeA / 2 + ", 0)")
                .attr("y1", nodeSizeA + nodeMargin * 2 - 2)
                .attr("y2", nodeSizeA + 4);
            cellA.append("text")
                .style("opacity", 0.8)
                .text("A")
                .attr("dx", nodeSizeA / 2)
                .attr("dy", nodeSizeA / 2 + 1);
            cellA.append("text")
                .attr("class", "label")
                .attr("dx", nodeSizeA / 2)
                .attr("dy", nodeSizeA + 24 + 8)
                .text(function(d) { return d; });
            cellA.append("rect")
                .style("opacity", 0)
                .attr("transform", "translate(-" + ((xa.step() - nodeSizeA) / 2) + ",-" + (nodeMargin + (networkMargin - networkHeightB) / 2) + ")")
                .attr("width", xa.step())
                .attr("height", networkHeightA + (networkMargin - networkHeightA) / 2);

            var networkB = svg.append("g");
            networkB.append("rect")
                .attr("class", "background")
                .attr("width", width)
                .attr("height", nodeSizeB + 2 * nodeMargin)
                .attr("rx", nodeMargin * 0.7)
                .attr("ry", nodeMargin * 0.7);
            var cellB = networkB.selectAll(".cell")
                .data(labelsB)
              .enter().append("g")
                .attr("class", "cell")
                .attr("transform", function(d, i) { return "translate(" + xb(i) + "," + nodeMargin + ")"; })
            cellB.append("rect")
                .attr("class", "shadow")
                .attr("transform", "translate(1, 3)")
                .attr("width", nodeSizeB)
                .attr("height", nodeSizeB)
                .attr("rx", 4)
                .attr("ry", 4);
            cellB.append("rect")
                .attr("class", "node")
                .attr("width", nodeSizeB)
                .attr("height", nodeSizeB)
                .attr("rx", 4)
                .attr("ry", 4);
            cellB.append("line")
                .attr("class", "arrow")
                .attr("marker-end", "url(#edgeArrowhead)")
                .attr("x1", nodeSizeB)
                .attr("x2", nodeSizeB + nodeMargin + 14)
                .attr("y1", nodeSizeB / 2)
                .attr("y2", nodeSizeB / 2);
            cellB.append("line")
                .attr("class", "arrow")
                .attr("marker-end", "url(#edgeArrowhead)")
                .attr("transform", "translate(" + nodeSizeB / 2 + ", 0)")
                .attr("y1", 0)
                .attr("y2", -nodeMargin * 2 + 5);
            cellB.append("text")
                .style("opacity", 0.8)
                .text("B")
                .attr("dx", nodeSizeB / 2)
                .attr("dy", nodeSizeB / 2 + 1);
            cellB.append("text")
                .attr("class", "label")
                .attr("dx", function(d) { return d === "européenne" ? nodeSizeB / 2 + 15 : nodeSizeB / 2; })
                .attr("dy", - 24 - 5)
                .text(function(d) { return d; });
            cellB.append("rect")
                .style("opacity", 0)
                .attr("transform", "translate(-" + ((xb.step() - nodeSizeB) / 2) + ",-" + nodeMargin + ")")
                .attr("width", xb.step())
                .attr("height", networkHeightB + (networkMargin - networkHeightB) / 2);

            var linkGroup = svg.append("g").attr("class", ".link-group")
            var link = linkGroup.selectAll(".link")
                .data(linkData)
              .enter().append("path")
                .attr("class", "link")
                .attr("d", link)
                .style("opacity", function(d) { return d.v; });
        })();
      </script>
      <p>
        Attention has a very sequential nature which is sometimes not suited for
        certain types of problems. Consider for instance conditional image
        generation. In conditional decoder-based generative models, we would
        like to map a source of noise to model samples in a way that is
        class-aware. This involves injecting class information into the decoder
        network:
      </p>
      <figure class="l-body-outset">
        <svg viewBox="0 0 744 350" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <symbol id="dog-image" viewBox="0 0 199 300">
              <rect x="0" y="0" width="199" height="300" fill="#bebe9d" />
              <g transform="scale(1.171875) translate(0.5 0.5)">
                <polygon fill="#000000" fill-opacity="0.501961" points="23,85 128,212 116,73" />
                <polygon fill="#ffffff" fill-opacity="0.501961" points="0,-16 185,4 -2,110" />
                <polygon fill="#000000" fill-opacity="0.501961" points="73,58 138,158 44,159" />
                <polygon fill="#ffffd9" fill-opacity="0.501961" points="185,-14 77,-16 168,227" />
                <polygon fill="#ffffd6" fill-opacity="0.501961" points="9,-9 -16,254 47,159" />
                <polygon fill="#000000" fill-opacity="0.501961" points="47,162 50,204 72,179" />
                <polygon fill="#ffffff" fill-opacity="0.501961" points="61,160 117,155 76,183" />
                <polygon fill="#352a29" fill-opacity="0.501961" points="99,70 155,201 44,77" />
                <polygon fill="#e5e6b3" fill-opacity="0.501961" points="183,247 109,235 121,167" />
                <polygon fill="#000000" fill-opacity="0.501961" points="69,189 120,161 113,182" />
                <polygon fill="#fdffd3" fill-opacity="0.501961" points="109,117 185,21 136,143" />
                <polygon fill="#ffffd4" fill-opacity="0.501961" points="70,-16 132,85 -16,33" />
                <polygon fill="#000000" fill-opacity="0.501961" points="50,129 44,158 134,149" />
                <polygon fill="#000002" fill-opacity="0.501961" points="110,113 82,67 126,92" />
                <polygon fill="#978254" fill-opacity="0.501961" points="75,180 133,211 47,237" />
                <polygon fill="#ece5b4" fill-opacity="0.501961" points="22,113 64,129 70,111" />
                <polygon fill="#100c15" fill-opacity="0.501961" points="32,96 44,112 65,69" />
                <polygon fill="#d3ba97" fill-opacity="0.501961" points="105,106 87,122 94,130" />
                <polygon fill="#000000" fill-opacity="0.501961" points="146,178 126,153 141,160" />
                <polygon fill="#ffffff" fill-opacity="0.501961" points="100,245 122,226 97,216" />
                <polygon fill="#090104" fill-opacity="0.501961" points="72,169 51,199 47,178" />
                <polygon fill="#f5facf" fill-opacity="0.501961" points="1,107 -16,-11 145,21" />
                <polygon fill="#fefcef" fill-opacity="0.501961" points="66,136 81,137 77,141" />
                <polygon fill="#fefbff" fill-opacity="0.501961" points="72,182 102,162 65,157" />
                <polygon fill="#c1aa7a" fill-opacity="0.501961" points="146,175 80,210 154,199" />
                <polygon fill="#fcffd9" fill-opacity="0.501961" points="112,30 165,42 125,103" />
                <polygon fill="#dae0a1" fill-opacity="0.501961" points="58,224 41,165 -16,271" />
                <polygon fill="#000000" fill-opacity="0.501961" points="101,156 108,115 74,160" />
                <polygon fill="#ecf2be" fill-opacity="0.501961" points="141,158 112,112 185,62" />
                <polygon fill="#656575" fill-opacity="0.501961" points="59,75 82,65 110,78" />
                <polygon fill="#000000" fill-opacity="0.501961" points="68,79 82,119 86,80" />
                <polygon fill="#928d84" fill-opacity="0.501961" points="107,118 118,155 117,116" />
                <polygon fill="#ecf5be" fill-opacity="0.501961" points="124,169 136,207 115,180" />
                <polygon fill="#ffffee" fill-opacity="0.501961" points="52,104 50,116 59,116" />
                <polygon fill="#c5a47e" fill-opacity="0.501961" points="72,92 68,99 61,80" />
                <polygon fill="#f0f4c0" fill-opacity="0.501961" points="1,49 52,127 -16,237" />
                <polygon fill="#000000" fill-opacity="0.501961" points="129,150 123,136 99,182" />
                <polygon fill="#09060a" fill-opacity="0.501961" points="46,162 70,154 73,113" />
                <polygon fill="#fbe8d7" fill-opacity="0.501961" points="58,174 75,156 50,161" />
                <polygon fill="#ffd79e" fill-opacity="0.501961" points="88,101 84,93 89,89" />
                <polygon fill="#f2f8d3" fill-opacity="0.501961" points="91,233 43,271 72,228" />
                <polygon fill="#000000" fill-opacity="0.501961" points="111,110 122,99 114,84" />
                <polygon fill="#7c706c" fill-opacity="0.501961" points="54,120 46,133 89,120" />
                <polygon fill="#ede8de" fill-opacity="0.501961" points="45,232 -16,150 12,147" />
                <polygon fill="#fcffe6" fill-opacity="0.501961" points="118,57 76,55 128,90" />
                <polygon fill="#eef0fa" fill-opacity="0.501961" points="67,179 90,161 98,176" />
                <polygon fill="#8d906c" fill-opacity="0.501961" points="100,179 96,220 44,235" />
                <polygon fill="#1a181d" fill-opacity="0.501961" points="84,186 100,179 69,182" />
                <polygon fill="#444245" fill-opacity="0.501961" points="63,117 40,86 65,68" />
                <polygon fill="#eeecd1" fill-opacity="0.501961" points="48,168 -16,202 42,139" />
                <polygon fill="#cb9d7a" fill-opacity="0.501961" points="61,179 70,245 49,222" />
                <polygon fill="#fdfbe4" fill-opacity="0.501961" points="15,91 79,63 -6,56" />
                <polygon fill="#424510" fill-opacity="0.501961" points="34,188 35,200 38,190" />
                <polygon fill="#acb77d" fill-opacity="0.501961" points="117,243 124,181 138,239" />
                <polygon fill="#eccf9b" fill-opacity="0.501961" points="93,158 114,153 101,170" />
                <polygon fill="#977250" fill-opacity="0.501961" points="148,198 136,191 132,159" />
                <polygon fill="#ddbf97" fill-opacity="0.501961" points="111,187 98,179 102,219" />
                <polygon fill="#eef1db" fill-opacity="0.501961" points="111,248 154,253 106,271" />
                <polygon fill="#000000" fill-opacity="0.501961" points="120,163 109,187 105,169" />
                <polygon fill="#b5c17d" fill-opacity="0.501961" points="39,222 -15,241 -3,207" />
                <polygon fill="#1b0c0a" fill-opacity="0.501961" points="118,184 109,192 109,199" />
                <polygon fill="#000000" fill-opacity="0.501961" points="89,101 74,116 72,76" />
                <polygon fill="#978474" fill-opacity="0.501961" points="90,124 82,106 98,118" />
                <polygon fill="#000000" fill-opacity="0.501961" points="69,154 54,156 56,122" />
                <polygon fill="#595448" fill-opacity="0.501961" points="51,240 67,237 53,230" />
                <polygon fill="#000000" fill-opacity="0.501961" points="108,152 108,130 70,125" />
                <polygon fill="#f1f2f5" fill-opacity="0.501961" points="66,157 89,181 95,165" />
                <polygon fill="#000003" fill-opacity="0.501961" points="57,180 47,187 51,166" />
                <polygon fill="#3c3736" fill-opacity="0.501961" points="35,92 49,119 52,75" />
                <polygon fill="#f0eecd" fill-opacity="0.501961" points="112,114 126,132 134,85" />
                <polygon fill="#e2e6aa" fill-opacity="0.501961" points="56,114 -16,136 30,167" />
                <polygon fill="#edf0c3" fill-opacity="0.501961" points="185,-1 185,141 59,-6" />
                <polygon fill="#9b9d67" fill-opacity="0.501961" points="147,156 146,148 122,165" />
                <polygon fill="#0b0a07" fill-opacity="0.501961" points="98,172 117,168 91,184" />
                <polygon fill="#544128" fill-opacity="0.501961" points="61,169 68,167 65,194" />
                <polygon fill="#c2a697" fill-opacity="0.501961" points="68,108 61,133 59,120" />
                <polygon fill="#e5f8c1" fill-opacity="0.501961" points="49,226 19,224 42,244" />
                <polygon fill="#dee2be" fill-opacity="0.501961" points="162,199 147,252 129,208" />
                <polygon fill="#6c685f" fill-opacity="0.501961" points="110,145 117,143 121,163" />
                <polygon fill="#0d0b0e" fill-opacity="0.501961" points="97,124 124,96 116,87" />
                <polygon fill="#ffffe0" fill-opacity="0.501961" points="120,166 123,185 127,173" />
                <polygon fill="#171314" fill-opacity="0.501961" points="121,128 122,143 113,120" />
                <polygon fill="#edefe7" fill-opacity="0.501961" points="60,232 86,228 83,239" />
                <polygon fill="#dbdaaa" fill-opacity="0.501961" points="76,208 69,175 66,196" />
                <polygon fill="#6e6e32" fill-opacity="0.501961" points="78,243 79,251 69,257" />
                <polygon fill="#5c5c5e" fill-opacity="0.501961" points="68,67 108,76 53,84" />
                <polygon fill="#f5f4f1" fill-opacity="0.501961" points="73,152 80,171 64,168" />
                <polygon fill="#c9e585" fill-opacity="0.501961" points="86,271 78,243 114,236" />
                <polygon fill="#c1b079" fill-opacity="0.501961" points="59,192 144,214 106,221" />
                <polygon fill="#ffffff" fill-opacity="0.501961" points="122,230 97,236 117,219" />
                <polygon fill="#000000" fill-opacity="0.501961" points="62,87 65,80 85,85" />
                <polygon fill="#737351" fill-opacity="0.501961" points="71,204 81,234 64,214" />
                <polygon fill="#c0a57d" fill-opacity="0.501961" points="158,171 144,203 140,185" />
                <polygon fill="#d8bb8c" fill-opacity="0.501961" points="103,105 100,114 105,114" />
                <polygon fill="#e7edb1" fill-opacity="0.501961" points="16,168 35,85 -16,104" />
                <polygon fill="#aec057" fill-opacity="0.501961" points="39,202 60,224 34,209" />
                <polygon fill="#e5ebbd" fill-opacity="0.501961" points="-16,20 17,63 56,33" />
                <polygon fill="#050502" fill-opacity="0.501961" points="35,99 49,118 40,95" />
                <polygon fill="#3a3034" fill-opacity="0.501961" points="14,258 22,248 19,258" />
                <polygon fill="#9aac61" fill-opacity="0.501961" points="41,246 35,223 33,259" />
              </g>
            </symbol>
          </defs>
          <text x="20" y="175" dy="0.4em" style="font-size: 18px; text-anchor: middle;" transform="rotate(-90, 20, 175)" class="figure-text">noise</text>
          <text x="275" y="10" dy="0.4em" style="font-size: 18px; text-anchor: middle;" class="figure-text">"puppy"</text>
          <path d="M 40 175 L 100 175" class="figure-line"/>
          <use xlink:href="#arrow-right" transform="translate(100, 175)" class="figure-path"/>
          <path d="M 275 25 L 275 50" class="figure-line"/>
          <use xlink:href="#arrow-down" transform="translate(275, 50)" class="figure-path"/>
          <path d="M 450 175 L 500 175" class="figure-line"/>
          <use xlink:href="#arrow-right" transform="translate(500, 175)" class="figure-path"/>
          <g transform="translate(100, 50)">
            <rect width="350" height="250" class="figure-group figure-box"/>
            <text x="175" y="125" dy="0.4em" style="font-size: 18px; text-anchor: middle;" class="figure-text">decoder</text>
          </g>
          <use xlink:href="#dog-image" x="500" y="25" width="199" height="300"/>
        </svg>
        <figcaption>
          This decoder-based generative model's decoder is given both a source
          of noise and the requested class as input and must map the noise to an
          image of the corresponding class. In other words, it must "interpret"
          the noise in the context of the provided class.<br><br>
          <em>
            Credit: image taken from the ImageNet dataset and vectorized.
          </em>
        </figcaption>
      </figure>
      <p>
        The brute-force approach to this problem involves learning separate
        decoders for every possible class. This is both expensive &mdash; it
        requires as many model replicas as there are classes &mdash; and
        wasteful: in our above example, classes corresponding to different
        types of dogs (puppy, terrier, dalmatian, etc.) are likely to share
        computation when mapping from the abstract noise vector to the output
        image. Even worse: imagine that the conditioning information is not a
        category, but some real-valued quantity (e.g., the dog's height). In
        that case, we can't reasonably expect to train a separate network for
        <em>all</em> possible conditioning values! We are therefore looking for
        more efficient alternatives, preferably involving as much parameter
        sharing as possible.
      </p>
      <p>
        A naive but much more efficient solution to the above problem would be
        to concatenate the class (or an embedding of the class) to the noise
        vector and treat the result as the decoder's input. Using this approach,
        <em>all</em> parameters in the decoder are shared between classes, save
        for the first layer's parameters.
        <dt-fn>
          As we will explain later, this is not a particularly sophisticated
          approach and you should avoid it in favor of conditional biasing,
          conditional scaling, or conditional affine transformation of the
          network's hidden features.
        </dt-fn> 
        Furthermore, the increase in number of parameters in the decoder's
        first layer is very modest: just enough to accomodate the class or
        class embedding in the layer's input.
      </p>
      <p>
        This is only a first step, though: while we're at it, why not
        concatenate the class or class embedding to the input of <em>all</em>
        layers in the decoder? We can also think of other repeated conditioning
        mechanisms: we can bias the output of all decoder layers using
        class-specific bias vectors, we can scale them, or we could even
        combine these ideas into a feature-wise, class-conditional affine
        transformation of the decoder layers' outputs.
        <dt-fn>
          An affine transformation is a transformation of the form
          <dt-math>y = m . x + b<dt-math>.
        </dt-fn>
        Those approaches have all in common that they act at the feature
        level, and we can regroup them under the umbrella of <em>feature-wise
        transformations</em>. Feature-wise transformations enjoy very good
        scaling properties &mdash; their number of parameters scales linearly
        with the total number of features in the network &mdash; and as we will
        see, they work remarkably well as a conditioning mechanism despite
        their simplicity.
      </p>
      <p>
        Let us now depart from our introductory example and adopt a more
        general view, where we consider fusing multiple sources of information
        (not just conditioning one on another), and where these sources of
        information are arbitrary (not just images and classes). In this
        article, we will take a deep dive into feature-wise transformations,
        showing that they find their way into a surprising number of recent
        neural network architectures used in various problem settings. We will
        examine them from two very different vantage points.
      </p>
      <p>
        On one hand, we will discuss feature-wise transformations as a family of
        related approaches and show how they can be conceptualized using the <a
        href="#film-nomenclature">FiLM nomenclature</a>. We will point out their
        <a href="#film-in-literature">numerous uses in the recent literature</a>,
        and take a stab at <a href="#understanding-film">understanding the computational mechanisms</a>
        that allow them to work.
      </p>
      <p>
        On the other hand, we will place feature-wise transformations
        themselves within the <a href="#bilinear-connection">family of bilinear
        transformations</a>. We will show that a small extension to the bilinear
        transformation formulation allows us to relate attention, gating, FiLM,
        and mixture-of-experts models as different instantiations of what we
        propose to call <em>generalized bilinear transformation</em>.
      </p>
      <p>
        We hope the insights contributed by this article will help highlight
        the strong connections between the aforementioned methods and inspire
        new approaches to integrating multiple information channels in neural
        networks.
      </p>

      <hr/>

      <h1 id="film-nomenclature">FiLM</h1>
      <p>
        To center the discussion around a common language, we propose to use
        the nomenclature of <dt-cite key="perez2017film"></dt-cite>, which
        formalizes feature-wise <em>affine</em> transformations under the
        acronym <em>FiLM</em>, for <strong>F</strong>eature-w<strong>i</strong>se
        <strong>L</strong>inear <strong>M</strong>odulation.
        <dt-fn>
          Strictly speaking, <em>linear</em> is a misnomer, as we allow biasing,
          but we hope the more rigorous-minded reader will forgive us for the
          sake of a better-sounding acronym.
        </dt-fn>
      </p>
      <p>
        We say that a neural network is modulated using FiLM, or
        <em>FiLM-ed</em>, through the insertion of <em>FiLM layers</em> in its
        architecture. These are parametrized by some form of conditioning
        information, and the mapping from conditioning information to FiLM
        parameters is called the <em>FiLM generator</em>. 
        In other words, the FiLM generator is going to predict the parameters of the FiLM layers based on some arbitrary input. 
        For simplicity, you can assume that the FiLM generator outputs the concatenation of all
        FiLM parameters for the network architecture.
      </p>
      <figure class="l-body-outset" id="film-architecture-diagram">
        <svg viewBox="0 0 744 500" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(479, 38)">
            <g class="filmed-network">
              <rect width="260" height="416" class="figure-group figure-box figure-filmed-network"/>
              <text x="8" y="18" class="figure-text">FiLM-ed network</text>
            </g>
            <text x="130" y="442" style="text-anchor: middle;" class="figure-text">input</text>
            <path d="M130,399l0,30" class="figure-line"/>
            <use x="130" y="399" xlink:href="#arrow-up"/>
            <g transform="translate(20, 337)">
              <rect width="222" height="62" class="figure-element figure-box"/>
              <text x="111" y="31" dy="0.4em" style="text-anchor: middle;" class="figure-text">sub-network</text>
            </g>
            <path d="M130,313l0,24" class="figure-line"/>
            <use x="130" y="313" xlink:href="#arrow-up"/>
            <g transform="translate(20, 268)" class="film-layer">
              <rect width="222" height="45" class="figure-element figure-box figure-film-layer"/>
              <text x="111" y="22" dy="0.4em" style="text-anchor: middle;" class="figure-text">FiLM</text>
            </g>
            <path d="M130,244l0,24" class="figure-line"/>
            <use x="130" y="244" xlink:href="#arrow-up"/>
            <g transform="translate(20, 182)">
              <rect width="222" height="62" class="figure-element figure-box"/>
              <text x="111" y="31" dy="0.4em" style="text-anchor: middle;" class="figure-text">sub-network</text>
            </g>
            <path d="M130,157l0,24" class="figure-line"/>
            <use x="130" y="157" xlink:href="#arrow-up"/>
            <g transform="translate(20, 112)" class="film-layer">
              <rect width="222" height="45" class="figure-element figure-box figure-film-layer"/>
              <text x="111" y="22" dy="0.4em" style="text-anchor: middle;" class="figure-text">FiLM</text>
            </g>
            <path d="M130,88l0,24" class="figure-line"/>
            <use x="130" y="88" xlink:href="#arrow-up"/>
            <g transform="translate(20, 26)">
              <rect width="222" height="62" class="figure-element figure-box"/>
              <text x="111" y="31" dy="0.4em" style="text-anchor: middle;" class="figure-text">sub-network</text>
            </g>
            <path d="M130,-15l0,41" class="figure-line"/>
            <use x="130" y="-15" xlink:href="#arrow-up"/>
            <text x="130" y="-22" style="text-anchor: middle;" class="figure-text">output</text>
          </g>
          <text x="5" y="255" class="figure-text">conditioning</text>
          <path d="M81,250l53,0" class="figure-line"/>
          <use x="134" y="250" xlink:href="#arrow-right" class="figure-path"/>
          <g transform="translate(135, 101)" class="film-generator">
            <rect width="180" height="300" class="figure-group figure-box figure-film-generator"/>
            <text x="90" y="150" style="text-anchor: middle;" class="figure-text">FiLM generator</text>
          </g>
          <path d="M314,250l58,0" class="figure-line"/>
          <use x="372" y="250" xlink:href="#arrow-right" class="figure-path"/>
          <g>
            <rect x="493" y="105" width="48" height="328" class="figure-group figure-box" transform="translate(-121, -21)"/>
            <g transform="translate(382, 100)">
              <rect width="30" height="140" class="figure-element figure-box"/>
              <text x="15" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text" transform="rotate(-90, 15, 70)">FiLM parameters</text>
            </g>
            <g transform="translate(382, 260)">
              <rect width="30" height="140" class="figure-element figure-box"/>
              <text x="15" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text" transform="rotate(-90, 15, 70)">FiLM parameters</text>
            </g>
          </g>
          <path d="M412,173l86,0" class="figure-line"/>
          <use x="498" y="173" xlink:href="#arrow-right" class="figure-path"/>
          <path d="M412,328l86,0" class="figure-line"/>
          <use x="498" y="328" xlink:href="#arrow-right" class="figure-path"/>
        </svg>
        <figcaption>
          In this example, a network is FiLM-ed by inserting two FiLM layers in
          its architecture. The FiLM parameters are computed using the FiLM
          generator, which processes the conditioning information.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#film-architecture-diagram > svg");
            svg.selectAll("g.film-generator")
                .on("mouseenter", function () { svg.select("rect.figure-film-generator").style("fill", "#ef9a9a"); })
                .on("mouseleave", function () { svg.select("rect.figure-film-generator").style("fill", null); });
            svg.selectAll("g.film-layer")
                .on("mouseenter", function () { svg.selectAll("rect.figure-film-layer").style("fill", "#ffcc80"); })
                .on("mouseleave", function () { svg.selectAll("rect.figure-film-layer").style("fill", null); });
            svg.selectAll("g.filmed-network")
                .on("mouseenter", function () { svg.select("rect.figure-filmed-network").style("fill", "#90caf9"); })
                .on("mouseleave", function () { svg.select("rect.figure-filmed-network").style("fill", null); });
        })();
      </script>
      <p>
        As the name implies, a FiLM layer applies a feature-wise affine
        transformation to its input. 
        <!-- The parameters of that transformation are also provided as input. ### This sentence is very confusing-->
        By <em>feature-wise</em>, we mean that scaling
        and shifting are applied element-wise, or in the case of convolutional
        networks, feature map-wise.
        <dt-fn>
          To expand a little more on the convolutional case, feature maps can be
          thought of as the same feature detector being evaluated at different
          spatial locations, in which case it makes sense to apply the same
          affine transformation to all spatial locations.
        </dt-fn>
        In other words, assuming <dt-math>\mathbf{x}</dt-math> is a FiLM layer's
        input and <dt-math>\mathbf{z}</dt-math> is the conditioning information,
        and assuming <dt-math>\gamma</dt-math> and <dt-math>\beta</dt-math> are
        <dt-math>\mathbf{z}</dt-math>-dependent scaling and shifting vectors,

        <dt-math block>
            \textrm{FiLM}(\mathbf{x}) = \gamma(\mathbf{z}) \odot \mathbf{x}
                                                           + \beta(\mathbf{z}),
        </dt-math>

        You can interact with the following fully-connected and convolutional
        FiLM layers to get an intuition of the sort of modulation they allow:
      </p>
      <figure class="l-body-outset" id="film-diagram">
        <svg viewBox="0 0 744 600" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(10, 50)" id="mlp-figure">
            <rect y="73" width="290" height="342" class="figure-group figure-box figure-film-layer"/>
            <text x="10" y="402" class="figure-text">FiLM layer (fully-connected)</text>
            <g transform="translate(147, 440)" id="input-layer">
              <g transform="translate(0, 0)" class="feature">
                <use xlink:href="#big-row-left" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use xlink:href="#big-row-middle" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use xlink:href="#big-row-right" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <line x1="207" y1="440" x2="207" y2="373" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(207, 373)" class="figure-path"/>
            <g transform="translate(27, 332)" id="gamma">
              <g transform="translate(0, 0)" class="feature">
                <use xlink:href="#big-row-left" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use xlink:href="#big-row-middle" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use xlink:href="#big-row-right" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <text x="59" y="325" class="figure-text" style="font-family: serif;" transform="translate(-49, 18)">γ</text>
            <line x1="147" y1="353" x2="187" y2="353" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(187, 353)" class="figure-path"/>
            <g transform="translate(207, 352)">
              <ellipse cx="0" cy="0" rx="20" ry="20" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <line x1="207" y1="333" x2="207" y2="265" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(207, 265)" class="figure-path"/>
            <g transform="translate(147, 225)" id="scaled-layer">
              <g transform="translate(0, 0)" class="feature">
                <use xlink:href="#big-row-left" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use xlink:href="#big-row-middle" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use xlink:href="#big-row-right" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <line x1="207" y1="225" x2="207" y2="158" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(207, 158)" class="figure-path"/>
            <g transform="translate(27, 118)" id="beta">
              <g transform="translate(0, 0)" class="feature">
                <use xlink:href="#big-row-left" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use xlink:href="#big-row-middle" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use xlink:href="#big-row-right" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <text x="10" y="128" style="font-family: serif;" class="figure-text">β</text>
            <line x1="147" y1="138" x2="187" y2="138" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(187, 138)" class="figure-path"/>
            <g transform="translate(207, 137)">
              <ellipse cx="0" cy="0" rx="20" ry="20" class="figure-element"/>
              <line x1="0" y1="7.5" x2="0" y2="-7.5" class="figure-line"/>
              <line x1="-7.5" y1="0" x2="7.5" y2="0" class="figure-line"/>
            </g>
            <line x1="207" y1="118" x2="207" y2="50" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(207, 50)" class="figure-path"/>
            <g transform="translate(147, 10)" id="shifted-layer">
              <g transform="translate(0, 0)" class="feature">
                <use xlink:href="#big-row-left" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use xlink:href="#big-row-middle" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use xlink:href="#big-row-right" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <line x1="-10" y1="138" x2="27" y2="138" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(27, 138)" class="figure-path"/>
            <line x1="-10" y1="353" x2="27" y2="353" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(27, 353)" class="figure-path"/>
          </g>
          <g transform="translate(377, 60)" id="cnn-figure">
            <rect x="47" y="63" width="310" height="342" class="figure-group figure-box figure-film-layer"/>
            <text x="57" y="392" class="figure-text">FiLM layer (convolutional)</text>
            <g transform="translate(239, 470)" id="input-layer">
              <g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -20)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -40)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
            </g>
            <line x1="262" y1="420" x2="262" y2="363" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(262, 363)" class="figure-path"/>
            <g transform="translate(74, 322)" id="gamma">
              <g transform="translate(0, 0)" class="feature">
                <use xlink:href="#big-row-left" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use xlink:href="#big-row-middle" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use xlink:href="#big-row-right" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <text x="59" y="325" class="figure-text" style="font-family: serif;" transform="translate(-2, 8)">γ</text>
            <line x1="194" y1="343" x2="242" y2="343" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(242, 343)" class="figure-path"/>
            <g transform="translate(262, 342)">
              <ellipse cx="0" cy="0" rx="20" ry="20" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <line x1="262" y1="323" x2="262" y2="286" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(262, 286)" class="figure-path"/>
            <g transform="translate(239, 231)" id="scaled-layer">
              <g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -20)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -40)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
            </g>
            <line x1="262" y1="181" x2="262" y2="148" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(262, 148)" class="figure-path"/>
            <g transform="translate(74, 107)" id="beta">
              <g transform="translate(0, 0)" class="feature">
                <use xlink:href="#big-row-left" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use xlink:href="#big-row-middle" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use xlink:href="#big-row-right" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <text x="57" y="118" style="font-family: serif;" class="figure-text">β</text>
            <line x1="194" y1="128" x2="242" y2="128" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(242, 128)" class="figure-path"/>
            <g transform="translate(262, 127)">
              <ellipse cx="0" cy="0" rx="20" ry="20" class="figure-element"/>
              <line x1="0" y1="7.5" x2="0" y2="-7.5" class="figure-line"/>
              <line x1="-7.5" y1="0" x2="7.5" y2="0" class="figure-line"/>
            </g>
            <line x1="262" y1="108" x2="262" y2="50" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(262, 50)" class="figure-path"/>
            <g transform="translate(239, -5)" id="shifted-layer">
              <g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -20)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -40)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
            </g>
            <line x1="34" y1="128" x2="74" y2="128" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(74, 128)" class="figure-path"/>
            <line x1="34" y1="343" x2="74" y2="343" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(74, 343)" class="figure-path"/>
          </g>
        </svg>
        <figcaption>
          FiLM layers applied on a fully-connected input (left) and on a
          convolutional input (right). In both cases, the scaling and shifting
          vectors <dt-math>\gamma</dt-math> and <dt-math>\beta</dt-math> are
          passed as input and are computed by the FiLM generator. Try
          interacting with the <dt-math>\gamma</dt-math> and
          <dt-math>\beta</dt-math> values by hovering over their corresponding
          diagram elements and observe the resulting change in the output.
        </figcaption>
      </figure>
      <script>
        (function() {
            (function() {
                var svg = d3.select("#film-diagram > svg");
                var features = [0.9, -0.5, -0.8];
                var gammas = [-1.6, 0.8, 1.8];
                var betas = [1.0, 0.5, -0.5];
                var data = [];
                for (var i = 0; i < 3; i++) {
                    data.push({feature: features[i], gamma: gammas[i], beta: betas[i]});
                }
                var amplitudeScale = d3.scaleSqrt().domain([0.0, 2.0]).range([0.0, 0.8]).clamp(true);
                var mouseScale = d3.scaleLinear().domain([0.0, 40.0]).range([2.0, -2.0]).clamp(true);
                svg.select("g#mlp-figure g#input-layer").selectAll("g.feature").data(data);
                svg.select("g#mlp-figure g#gamma").selectAll("g.feature").data(data);
                svg.select("g#mlp-figure g#beta").selectAll("g.feature").data(data);
                svg.select("g#mlp-figure g#scaled-layer").selectAll("g.feature").data(data);
                svg.select("g#mlp-figure g#shifted-layer").selectAll("g.feature").data(data);

                function updateSingle(selection, accessor) {
                    selection.selectAll("g.feature").each(function (d, i) {
                        var r = accessor(d);
                        var s = Math.sign(r) * amplitudeScale(Math.abs(r));
                        d3.select(this)
                          .select(".vector-patch")
                            .attr("opacity", Math.abs(s))
                            .attr("href", r < 0 ? "#vector-patch-negative" : "#vector-patch-positive");
                        d3.select(this)
                          .select(".figure-line")
                            .attr("transform", "matrix(" + [s, 0, 0, s, 20, 20] + ")");
                    });
                }

                function update() {
                    updateSingle(svg.select("g#mlp-figure g#input-layer"), function(d) { return d.feature; });
                    updateSingle(svg.select("g#mlp-figure g#gamma"), function(d) { return d.gamma; });
                    updateSingle(svg.select("g#mlp-figure g#beta"), function(d) { return d.beta; });
                    updateSingle(svg.select("g#mlp-figure g#scaled-layer"), function(d) { return d.gamma * d.feature; });
                    updateSingle(svg.select("g#mlp-figure g#shifted-layer"), function(d) { return d.gamma * d.feature + d.beta; });
                }

                update();

                svg.select("g#mlp-figure g#gamma")
                  .selectAll("g.feature")
                    .on("mousemove", function (d) {
                        d.gamma = mouseScale(d3.mouse(this)[1]);
                        update();
                    });
                svg.select("g#mlp-figure g#beta")
                  .selectAll("g.feature")
                    .on("mousemove", function (d, i) {
                        d.beta = mouseScale(d3.mouse(this)[1]);
                        update();
                    });
            })();
            (function () {
                var svg = d3.select("#film-diagram > svg");
                var features = [
                    [[-0.6, -0.6,  0.8], [ 0.6,  0.7,  0.4], [-0.8,  0.8,  0.9]],
                    [[ 0.9, -0.1,  0.5], [-0.8, -0.7,  0.5], [-0.3, -0.9, -0.2]],
                    [[-0.5, -0.9,  0.6], [-0.2, -0.4,  0.2], [-0.6,  0.1, -0.3]]
                ];
                var gammas = [-1.6, 0.8, 1.8];
                var betas = [1.0, 0.5, -0.5];
                var data = [];
                var featureMapData = [[], [], []];
                for (var k = 0; k < 3; k++) {
                    for (var i = 0; i < 3; i++) {
                        for (var j = 0; j < 3; j++) {
                            var d = {feature: features[i][j][k], gamma: gammas[k], beta: betas[k]};
                            data.push(d);
                            featureMapData[2 - k].push(d);
                        }
                    }
                }
                var amplitudeScale = d3.scaleSqrt().domain([0.0, 2.0]).range([0.0, 0.8]).clamp(true);
                var mouseScale = d3.scaleLinear().domain([0.0, 40.0]).range([2.0, -2.0]).clamp(true);
                svg.select("g#cnn-figure g#input-layer").selectAll("g.feature").data(data);
                svg.select("g#cnn-figure g#gamma").selectAll("g.feature").data(featureMapData);
                svg.select("g#cnn-figure g#beta").selectAll("g.feature").data(featureMapData);
                svg.select("g#cnn-figure g#scaled-layer").selectAll("g.feature").data(data);
                svg.select("g#cnn-figure g#shifted-layer").selectAll("g.feature").data(data);

                function updateSingle(selection, accessor, offset) {
                    selection.selectAll("g.feature").each(function (d, i) {
                        var r = accessor(d);
                        var s = Math.sign(r) * amplitudeScale(Math.abs(r));
                        d3.select(this)
                          .select(".convolutional-patch")
                            .attr("opacity", Math.abs(s))
                            .attr("href", r < 0 ?  "#convolutional-patch-negative" : "#convolutional-patch-positive");
                        d3.select(this)
                          .select(".vector-patch")
                            .attr("opacity", Math.abs(s))
                            .attr("href", r < 0 ?  "#vector-patch-negative" : "#vector-patch-positive");
                        d3.select(this)
                          .select(".figure-line")
                            .attr("transform", "matrix(" + [s, 0, 0, s, offset, offset] + ")");
                    });
                }

                function update() {
                    updateSingle(svg.select("g#cnn-figure g#input-layer"), function(d) { return d.feature; }, 15);
                    updateSingle(svg.select("g#cnn-figure g#gamma"), function(d) { return d[0].gamma; }, 20);
                    updateSingle(svg.select("g#cnn-figure g#beta"), function(d) { return d[0].beta; }, 20);
                    updateSingle(svg.select("g#cnn-figure g#scaled-layer"), function(d) { return d.gamma * d.feature; }, 15);
                    updateSingle(svg.select("g#cnn-figure g#shifted-layer"), function(d) { return d.gamma * d.feature + d.beta; }, 15);
                }

                update();

                svg.select("g#cnn-figure g#gamma")
                  .selectAll("g.feature")
                    .on("mousemove", function (d) {
                        var newValue = mouseScale(d3.mouse(this)[1]);
                        for (var i = 0; i < 9; i++) {
                            d[i].gamma = newValue;
                        }
                        update();
                    });
                svg.select("g#cnn-figure g#beta")
                  .selectAll("g.feature")
                    .on("mousemove", function (d, i) {
                        var newValue = mouseScale(d3.mouse(this)[1]);
                        for (var i = 0; i < 9; i++) {
                            d[i].beta = newValue;
                        }
                        update();
                    });
            })();
        })();
      </script>
      <p>
        FiLM shares with HyperNetworks <dt-cite key="ha2016hypernetworks"></dt-cite>
        the architectural feature that a secondary neural network computes some
        of the parameter values in the primary network. From that perspective,
        the FiLM generator can be viewed as a specialized instance of a
        HyperNetwork which predicts the FiLM parameters of the FiLM-ed network.
      </p>
      <p>
        FiLM is closely related to gating: the latter can be viewed as a
        bias-less version of the former with sigmoidal scaling. Whereas gating
        is used to inhibit the expression of targeted features, FiLM can in
        theory be used to inhibit or enhance the expression of targeted
        features, flip their sign, or selectively threshold them (when combined
        with a ReLU nonlinearity). The impact of these additional capabilities
        is still an open area of investigation.
      </p>
      <p>
        Some parallels can be drawn between FiLM and attention, but the two
        operate in different ways which we think are important to disambiguate.
        Attention is applied to either the spatial axes (in the case of
        convolutional neural networks) or the temporal axis (in the case of
        recurrent neural networks) of the data. In other words, the
        <em>attention distribution</em> (be it location-based or content-based)
        is the same across the different feature maps of a convolutional input
        or across the different features of a sequence of feature vectors. In
        contrast, FiLM is applied to the feature axis; this means that the same
        affine transformation is applied to all spatial locations in a given
        feature map or to the value of a given feature at all time steps. This
        difference stems from two different intuitions underlying attention and
        FiLM: for attention, it is assumed that the useful information is
        contained in specific spatial locations or time steps, whereas for
        FiLM, it is assumed that the useful information is contained in
        specific features or feature maps.
      </p>
      <p>
        Furthermore, attention is mainly used as a pooling method to summarize
        a stack of feature maps or a sequence of feature vectors into a single
        vector. FiLM, on the other hand, modulates its input without changing
        its underlying shape. We also note that the weighted sum computed by an
        attention mechanism is often normalized using a softmax on the weights
        such that they sum up to one, whereas FiLM does not usually implement
        this sort of constraint, but this is more of an implementation detail
        than anything else. In the end, FiLM and attention can be seen as two
        complementary tools in the neural toolbox.
      </p>
      <p>
        <span class="todo">TODO: add figure.</span>
      </p>
      <p>
        Finally, there exists a connection between attention, gating, FiLM, and
        mixture-of-experts models through bilinear transformations <dt-cite
        key="tenenbaum2000separating"></dt-cite>.  Because this connection
        deserves more than a single paragraph, we decided to devote a
        <a href="#bilinear-connection">separate section</a> of the article to it.
      </p>

      <hr />

      <h1 id="film-in-literature">Feature-wise transformations in the literature</h1>
      <p>
        Because of their very general nature and wide applicability,
        feature-wise transformations are sometimes treated as accessory
        to the proposed models to which they are applied. We believe there is
        value in connecting those methods, which is why part of this article is
        devoted to a literature review.
      </p>
      <p>
        In the interest of not confusing readers already familiar with these
        methods, we chose to stick to the nomenclature used in the original
        papers, but we do draw connections to the FiLM nomenclature where
        appropriate. Readers interested in those connections are encouraged to
        take a closer look at the model diagrams, in which elements relevant to
        the FiLM nomenclature have been color-coded and can be hovered over to
        reveal more information:
      </p>
      <figure class="l-body-outset" id="legend-diagram">
        <svg viewBox="0 0 744 80" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(50, 10)" class="film-generator">
            <rect width="180" height="60" class="figure-group figure-box figure-film-generator"/>
            <text x="90" y="30" dy="0.4em" style="text-anchor: middle;" class="figure-text">figure element</text>
          </g>
          <g transform="translate(283, 10)" class="film-layer">
            <rect width="180" height="60" class="figure-group figure-box figure-film-layer"/>
            <text x="90" y="30" dy="0.4em" style="text-anchor: middle;" class="figure-text">figure element</text>
          </g>
          <g transform="translate(515, 10)" class="filmed-network">
            <rect width="180" height="60" class="figure-group figure-box figure-filmed-network"/>
            <text x="90" y="30" dy="0.4em" style="text-anchor: middle;" class="figure-text">figure element</text>
          </g>
        </svg>
        <figcaption>
          In this section, figure elements that are color-coded in red
          (FiLM generator), orange (FiLM layer), and blue (FiLM-ed network) can
          be hovered over to reveal more information.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#legend-diagram > svg");
            svg.select("g.film-generator")
                .on("mouseenter", function () {
                    svg.select("g.film-generator > text").text("FiLM generator");
                    svg.select("g.film-generator > rect").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-generator > text").text("figure element");
                    svg.select("g.film-generator > rect").style("fill", null)
                });
            svg.select("g.film-layer")
                .on("mouseenter", function () {
                    svg.select("g.film-layer > text").text("FiLM layer");
                    svg.select("g.film-layer > rect").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-layer > text").text("figure element");
                    svg.select("g.film-layer > rect").style("fill", null)
                });
            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    svg.select("g.filmed-network > text").text("FiLM-ed network");
                    svg.select("g.filmed-network > rect").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    svg.select("g.filmed-network > text").text("figure element");
                    svg.select("g.filmed-network > rect").style("fill", null)
                });
        })();
      </script>
      <h2>Concatenation</h2>
      <p>
        Let's pretend that we have an input <dt-math>\mathbf{x}</dt-math> and
        some contextual information <dt-math>\mathbf{z}</dt-math> which we
        process using a neural network to compute some output. Perhaps the
        simplest way of combining the two is to concatenate them and pass the
        augmented input through the neural network, crossing our fingers in hope
        that the network will implicitly learn to combine the two in a sensible
        manner. This approach suffers from the fact that the conditioning
        information has a direct influence only in the first few layers of the
        neural network; the deeper we get, the more diffuse and indirect its
        influence becomes.
      </p>
      <p>
        An improvement over this idea would be to concatenate
        <dt-math>\mathbf{z}</dt-math> to the input of <em>all</em> layers in the
        neural network. This is in fact the approach adopted by the conditional
        variant of DCGAN <dt-cite key="radford2016unsupervised"></dt-cite>, a
        well-recognized class of network architectures for generative
        adversarial networks (GANs) <dt-cite key="goodfellow2014generative"></dt-cite>.
        The class label is broadcasted as a feature map and is concatenated to
        the input of convolutional and transposed convolutional layers in the
        generator and discriminator networks.
      </p>
      <figure class="l-body-outset" id="dcgan-diagram">
        <svg viewBox="0 0 744 350" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(10, 10)">
            <g class="filmed-network">
              <rect x="180" y="0" width="364" height="300" class="figure-group figure-box"/>
              <text x="190" y="15" dy="0.4em" class="figure-text">concatenation-based conditioning</text>
            </g>
            <g transform="translate(0, 70)">
              <rect x="0" y="0" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="10" y="10" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="20" y="20" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">input</text>
            </g>
            <g transform="translate(200, 102)">
              <rect width="40" height="116" class="figure-element figure-box"/>
              <text x="20" y="58" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 58)" class="figure-text">concatenate</text>
            </g>
            <g transform="translate(270, 70)">
              <rect x="0" y="0" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="10" y="10" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="20" y="20" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">input</text>
              <rect x="40" y="40" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <text x="50" y="50" dy="0.4em" class="figure-text">cond. feature map</text>
            </g>
            <g transform="translate(480, 102)">
              <rect width="40" height="116" class="figure-element figure-box"/>
              <text x="20" y="58" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 58)" class="figure-text">convolution</text>
            </g>
            <g transform="translate(564, 70)">
              <rect x="0" y="0" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="10" y="10" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="20" y="20" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">output</text>
            </g>
            <path d="M 160 160 L 200 160" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(200, 160)" class="figure-path"/>
            <path d="M 240 160 L 270 160" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(270, 160)" class="figure-path"/>
            <path d="M 450 160 L 480 160" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(480, 160)" class="figure-path"/>
            <path d="M 520 160 L 564 160" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(564, 160)" class="figure-path"/>
            <g transform="translate(186, 240)">
              <rect width="68" height="40" class="figure-element figure-box"/>
              <text x="34" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">linear</text>
            </g>
            <path d="M 220 218 L 220 240" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(220, 218)" class="figure-path"/>
            <path d="M 220 280 L 220 310" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(220, 280)" class="figure-path"/>
            <text x="220" y="320" dy="0.4em" style="text-anchor: middle;" class="figure-text">conditioning representation</text>
          </g>
        </svg>
        <figcaption>
          Concatenation-based conditioning in a convolutional layer. The
          conditioning representation is mapped linearly to a conditioning
          feature map which is concatenated with the input stack of feature
          maps.
        </figcaption>
      </figure>
      <h2>Biasing</h2>
      <p>
        An equivalent &mdash; and more efficient &mdash; way to express this
        operation is in the form of a feature-wise, class-conditional biasing of
        the output of the layer. To understand the equivalence, consider a
        simple fully-connected linear layer applied to the concatenation of
        <dt-math>\mathbf{x}</dt-math> and <dt-math>\mathbf{z}</dt-math>.
        <dt-fn>
          The same argument applies to convolutional networks, provided we
          ignore the border effects due to zero-padding.
        </dt-fn>
      </p>
      <figure class="l-body-outset" id="concatenation-as-biasing">
        <svg viewBox="0 0 744 370" xmlns="http://www.w3.org/2000/svg">
          <rect x="10" y="10" height="350" width="724" class="figure-group figure-box"/>
          <g transform="translate(60, 20)">
            <g transform="translate(10, 100)">
              <g>
                <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 0)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 0)" class="figure-element"/>
                <use xlink:href="#matrix-top-right" transform="translate(100, 0)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 20)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 20)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 20)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 40)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 40)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 40)" class="figure-element"/>
                <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 60)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 60)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 60)" class="figure-element"/>
                <use xlink:href="#matrix-bottom-right" transform="translate(100, 60)" class="figure-element"/>
                <text x="60" y="90" dy="0.4em" style="text-anchor: middle;" class="figure-text">W</text>
              </g>
              <g transform="translate(125, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 60)" class="figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 80)" class="figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 100)" class="figure-element"/>
                <use xlink:href="#curly-brace-vertical" transform="translate(25, 0)" class="figure-line"/>
                <use xlink:href="#curly-brace-vertical" transform="translate(25, 60)" class="figure-line"/>
                <text x="45" y="30" dy="0.4em" style="font-weight: bold;" class="figure-text">x</text>
                <text x="45" y="90" dy="0.4em" style="font-weight: bold;" class="figure-text">z</text>
              </g>
            </g>
            <g transform="translate(240, 10)">
              <g>
                <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
                <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 60)" class="figure-element"/>
              </g>
              <g transform="translate(65, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
                <use xlink:href="#curly-brace-vertical" transform="translate(25, 0)" class="figure-line"/>
                <text x="45" y="30" dy="0.4em" style="font-weight: bold;" class="figure-text">x</text>
              </g>
            </g>
            <g transform="translate(240, 240)">
              <g>
                <use xlink:href="#matrix-center" transform="translate(0, 0)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
                <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 60)" class="figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
                <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element"/>
              </g>
              <g transform="translate(65, 0)">
                <use xlink:href="#column-middle" transform="translate(0, 0)" class="figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
                <use xlink:href="#curly-brace-vertical" transform="translate(25, 0)" class="figure-line"/>
                <text x="45" y="30" dy="0.4em" style="font-weight: bold;" class="figure-text">z</text>
              </g>
            </g>
            <g transform="translate(405, 10)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
            </g>
            <g transform="translate(405, 240)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
            </g>
            <g transform="translate(505, 150)">
              <circle cx="10" cy="10" r="10" class="figure-element"/>
              <path d="M 10 5 l 0 10" class="figure-line"/>
              <path d="M 5 10 l 10 0" class="figure-line"/>
            </g>
            <g transform="translate(605, 120)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
            </g>
            <path d="M 175 110 C 205 110 195 40 235 50" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(235, 50)" class="figure-path"/>
            <path d="M 175 210 C 205 210 195 290 235 280" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(235, 280)" class="figure-path"/>
            <path d="M 365 50 l 30 0" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(395, 50)" class="figure-path"/>
            <path d="M 365 280 l 30 0" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(395, 280)" class="figure-path"/>
            <path d="M 435 50 L 509 50 a 6 6 0 0 1 6 6 L 515 150" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(515, 150)" class="figure-path"/>
            <path d="M 435 280 L 509 280 a 6 6 0 0 0 6 -6 L 515 170" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(515, 170)" class="figure-path"/>
            <text x="435" y="295" class="figure-text">conditional bias</text>
            <path d="M 525 160 l 70 0" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(595, 160)" class="figure-path"/>
          </g>
        </svg>
        <figcaption>
          Concatenation can be viewed as conditional biasing by expressing the
          matrix-vector product as a two-stage process.
        </figcaption>
      </figure>
      <p>
        Each vector product between <dt-math>\mathbf{z}</dt-math> and its
        corresponding subset of a row of the weight matrix can be thought of
        as a bias that gets added to the corresponding output feature.
      </p>
      <p>
        Conditional biasing of layers in the neural network is itself employed
        in PixelCNN <dt-cite key="oord2016conditional"></dt-cite> and WaveNet
        <dt-cite key="oord2016wavenet"></dt-cite>, two recent advances in
        autoregressive modeling of image and audio data, respectively.
      </p>
      <p>
        In its simplest form, conditioning in PixelCNN models is achieved by
        adding feature-wise, class-conditional biases to the output of all
        convolutional layers. In FiLM parlance, this means inserting FiLM layers
        after each convolutional layer and expressing the FiLM-generating
        network as an embedding lookup on the class labels, with the scaling
        coefficients set to a constant value of 1.
        <dt-fn>
          The authors also describe a location-dependent biasing scheme which
          cannot be expressed in terms of FiLM layers due to the absence of the
          feature-wise property.
        </dt-fn>
      </p>
      <figure class="l-body-outset" id="pixelcnn-diagram">
        <svg viewBox="0 0 744 350" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(10, 10)">
            <g class="filmed-network">
              <rect x="180" y="0" width="364" height="260" class="figure-group figure-box"/>
              <text x="190" y="15" dy="0.4em" class="figure-text">conditional biasing</text>
            </g>
            <g transform="translate(0, -40)">
              <g transform="translate(0, 70)">
                <rect x="0" y="0" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
                <rect x="10" y="10" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
                <rect x="20" y="20" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
                <text x="30" y="30" dy="0.4em" class="figure-text">input</text>
              </g>
              <path d="M 160 160 L 200 160" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(200, 160)" class="figure-path"/>
              <g transform="translate(200, 102)">
                <rect width="40" height="116" class="figure-element figure-box"/>
                <text x="20" y="58" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 58)" class="figure-text">convolution</text>
              </g>
              <path d="M 240 160 L 352 160" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(352, 160)" class="figure-path"/>
              <text x="362" y="320" dy="0.4em" style="text-anchor: middle;" class="figure-text">conditioning representation</text>
              <path d="M 362 280 L 362 310" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(362, 280)" class="figure-path"/>
              <g transform="translate(304, 240)">
                <rect width="116" height="40" class="figure-element figure-box"/>
                <text x="58" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">linear</text>
              </g>
              <path d="M 362 240 L 362 220" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(362, 220)" class="figure-path"/>
              <g transform="translate(332, 200)">
                <use xlink:href="#row-left" transform="translate(0, 0)" class="figure-element"/>
                <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
                <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              </g>
              <path d="M 362 200 L 362 170" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(362, 170)" class="figure-path"/>
              <g transform="translate(362, 160)">
                <circle r="10" class="figure-element"/>
                <path d="M -5 0 L 5 0" class="figure-line"/>
                <path d="M 0 -5 L 0 5" class="figure-line"/>
              </g>
              <g transform="translate(564, 70)">
                <rect x="0" y="0" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
                <rect x="10" y="10" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
                <rect x="20" y="20" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
                <text x="30" y="30" dy="0.4em" class="figure-text">output</text>
              </g>
              <path d="M 372 160 L 564 160" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(564, 160)" class="figure-path"/>
            </g>
          </g>
        </svg>
        <figcaption>
          Conditional biasing in a convolutional layer. The conditioning
          representation is mapped linearly to a bias vector which is added
          to the convolution's output stack of feature maps.
        </figcaption>
      </figure>
      <p>
        WaveNet describes two ways in which conditional biasing allows external
        information to modulate the behavior of the model:
      </p>
      <ol>
        <li>
          <strong>Global conditioning</strong> applies the same conditional
          bias to the whole generated sequence and is used e.g. to condition on
          speaker identity.
        </li>
        <li>
          <strong>Local conditioning</strong> applies a conditional bias which
          varies across time steps of the generated sequence and is used e.g.
          to let linguistic features in a text-to-speech (TTS) model influence
          which sounds are produced.
        </li>
      </ol>
      <p>
        Like for PixelCNN, both approaches can be viewed as inserting FiLM
        layers after each convolutional layer. The main difference lies in the
        way in which the FiLM-generating network is defined: global conditioning
        expresses the FiLM-generating network as an embedding lookup which is
        broadcasted to the whole time series, whereas local conditioning
        expresses it as a mapping from an input sequence of conditioning
        information to an output sequence of FiLM parameters.
      </p>
      <h2>Scaling</h2>
      <p>
        Whereas conditional biasing leverages additive interations,
        <em>conditional scaling</em> leverages multiplicative interactions. For
        instance, feature-wise sigmoidal gating scales each feature or feature
        map by a scalar between <dt-math>0</dt-math> and <dt-math>1</dt-math> as
        a function of the conditioning information. This constraint is often
        enforced via a sigmoidal layer, hence the name. Intuitively,
        feature-wise sigmoidal gating allows the conditioning information to
        select which features are passed forward and which are zeroed out.  In
        the FiLM nomenclature, sigmoidal gating would correspond to a bias-less
        FiLM layer with sigmoidal scaling.
      </p>
      <p>
        Examples of application include the Gated-Attention architecture
        <dt-cite key="chaplot2017gated"></dt-cite>, which uses feature-wise
        sigmoidal gating to fuse linguistic and visual inputs in the context of
        a reinforcement learning agent trained to follow simple natural language
        instructions in the VizDoom <dt-cite key="kempa2016vizdoom"></dt-cite>
        3D environment.
      </p>
      <figure class="l-body-outset" id="gated-attention-diagram">
        <svg viewBox="0 0 744 400" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(59, 10)">
            <g class="filmed-network">
              <rect x="145" y="26" width="430" height="338" class="figure-group figure-box figure-filmed-network"/>
              <text x="155" y="44" class="figure-text">gated-attention multimodal fusion unit</text>
            </g>
            <g transform="translate(-36, 24)">
              <rect x="0" y="0" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="10" y="10" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="20" y="20" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <rect x="30" y="30" width="140" height="140" style="fill-opacity: 1;" class="figure-element figure-box"/>
              <text x="100" y="100" dy="0.4em" style="text-anchor: middle;" class="figure-text">image representation</text>
            </g>
            <g transform="translate(69, 207)">
              <rect width="40" height="164" class="figure-element figure-box"/>
              <text x="20" y="82" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 82)" class="figure-text">instruction representation</text>
            </g>
            <g transform="translate(400, 289)" class="film-generator">
              <ellipse rx="20" ry="20" class="figure-element figure-film-generator"/>
              <text x="0" y="0" dy="0.4em" style="text-anchor: middle;" class="figure-text">σ</text>
            </g>
            <g transform="translate(215, 233)" class="film-generator">
              <rect width="40" height="112" class="figure-element figure-box figure-film-generator"/>
              <text x="102.5" y="47" style="text-anchor: middle;" class="figure-text figure-film-generator-text"></text>
              <text x="20" y="56" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 56)" class="figure-text">linear</text>
            </g>
            <g transform="translate(400, 145)" class="film-layer">
              <ellipse rx="20" ry="20" class="figure-element figure-film-layer"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
              <text x="0" y="-25" style="text-anchor: middle;" class="figure-text"> </text>
            </g>
            <path d="M 109 289 L 214 289" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(214, 289)" class="figure-path"/>
            <path d="M 133 145 L 380 145" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(380, 145)" class="figure-path"/>
            <path d="M 255 289 L 380 289" style="fill: #f44336; stroke: #f44336;" class="figure-line"/>
            <use xlink:href="#arrow-right" style="fill: #f44336; stroke: #f44336;" transform="translate(380, 289)" class="figure-path"/>
            <path d="M 420 145 L 594 145" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(594, 145)" class="figure-path"/>
            <path d="M 400 165 L 400 269" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(400, 165)" class="figure-path"/>
          </g>
        </svg>
        <figcaption>
          Gated-attention fusion unit. The instruction representation is mapped
          to a feature vector with as many elements as the number of image
          representation feature maps through a sigmoidal layer. This feature
          vector is then multiplied element-wise &mdash; using broadcasting
          &mdash; with the image representation.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#gated-attention-diagram > svg");
            svg.selectAll("g.film-generator")
                .on("mouseenter", function () {
                    svg.select("g.film-generator > text.figure-film-generator-text").text("FiLM generator");
                    svg.selectAll("g.film-generator > .figure-film-generator").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-generator > text.figure-film-generator-text").text("");
                    svg.selectAll("g.film-generator > .figure-film-generator").style("fill", null);
                });
            svg.select("g.film-layer")
                .on("mouseenter", function () {
                    svg.select("g.film-layer > text").text("FiLM layer");
                    svg.select("g.film-layer > .figure-film-layer").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-layer > text").text("");
                    svg.select("g.film-layer > .figure-film-layer").style("fill", null);
                });
            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    svg.select("g.filmed-network > text").text("FiLM-ed layer");
                    svg.selectAll("g.filmed-network > .figure-filmed-network").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    svg.select("g.filmed-network > text").text("gated-attention multimodal fusion unit");
                    svg.selectAll("g.filmed-network > .figure-filmed-network").style("fill", null);
                });
        })();
      </script>
      <p>
        Sometimes the sigmoidal restriction can be lifted, as is the case for
        the Gated-Attention Reader <dt-cite key="dhingra2017gated"></dt-cite>.
        The model extracts information from a text by conditioning the document
        reading network on an query.  Its architecture is formed of multiple
        Gated-Attention modules, which involve element-wise multiplications
        between document representation tokens and token-specific query
        representations extracted via soft attention on the query representation
        tokens.
      </p>
      <h2>FiLM: scaling <em>and</em> biasing</h2>
      <p>
        By combining conditional biasing and conditional scaling, we obtain the
        FiLM layer, which implements a conditional feature-wise affine
        transformation. We can use FiLM layers to condition a visual processing
        pipeline to answer textual questions about an image. In <dt-cite
        key="perez2017learning"></dt-cite>, and in its expanded version <dt-cite
        key="perez2017film"></dt-cite>, a visual reasoning model is trained on the
        CLEVR dataset <dt-cite key="johnson2017clevr"></dt-cite> to answer
        synthetic questions about a synthetic input image.
      </p>
      <figure class="l-body-outset" id="clevr-diagram">
        <svg viewBox="0 0 744 500" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(10, 20)" class="film-generator">
            <rect x="0" y="0" width="221" height="446" class="figure-group figure-box figure-film-generator"/>
            <text x="10" y="15" dy="0.4em" class="figure-text">linguistic pipeline</text>
            <g transform="translate(27, 45)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">Are</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 95)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">there</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 145)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">more</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 195)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">cubes</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 245)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">than</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 295)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">yellow</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 345)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">GRU</text>
              <text x="0" y="19" dy="0.4em" class="figure-text">things</text>
              <path d="M 43 19 L 63 19" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(63, 19)" class="figure-path"/>
              <path d="M 119 38 L 119 50" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(119, 50)" class="figure-path"/>
            </g>
            <g transform="translate(27, 395)">
              <rect x="63" y="0" width="112" height="38" class="figure-element figure-box"/>
              <text x="119" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">linear</text>
            </g>
          </g>
          <g transform="translate(250, 20)" class="filmed-network">
            <rect x="0" y="30" width="260" height="326" class="figure-group figure-box figure-filmed-network"/>
            <image x="58" y="380" width="144" height="96" xlink:href="assets/clevr_input.jpg"/>
            <text x="130" y="0" style="text-anchor: middle;" class="figure-text">Answer: yes</text>
            <path d="M 130 5 L 130 59" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(130, 5)" class="figure-path"/>
            <text x="10" y="45" dy="0.4em" class="figure-text">visual pipeline</text>
            <g transform="translate(58, 300)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="72" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">feature extractor</text>
              <path d="M 72 38 L 72 80" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(72, 38)" class="figure-path"/>
            </g>
            <g transform="translate(58, 240)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="72" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">residual block 1</text>
              <path d="M 72 38 L 72 60" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(72, 38)" class="figure-path"/>
            </g>
            <g transform="translate(58, 180)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="72" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">residual block 2</text>
              <path d="M 72 38 L 72 60" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(72, 38)" class="figure-path"/>
            </g>
            <g transform="translate(58, 120)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="72" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">residual block N</text>
              <text x="72" y="52" style="text-anchor: middle;" class="figure-text">...</text>
            </g>
            <g transform="translate(58, 60)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="72" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">classifier</text>
              <path d="M 72 38 L 72 60" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(72, 38)" class="figure-path"/>
            </g>
          </g>
          <g transform="translate(360, 40)" class="style-transfer-network">
            <rect x="166" y="13" width="212" height="379" class="figure-group figure-box figure-dashed"/>
            <path d="M 282 268 l 80 0 a 6 6 0 0 0 6 -6 l 0 -230 a 6 6 0 0 0 -6 -6 l -80 0" class="figure-line"/>
            <g transform="translate(210, 335)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="72" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">convolution</text>
              <path d="M 72 38 L 72 80" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(72, 38)" class="figure-path"/>
            </g>
            <g transform="translate(210, 275)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="72" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">ReLU</text>
              <path d="M 72 38 L 72 60" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(72, 38)" class="figure-path"/>
            </g>
            <g transform="translate(210, 215)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="72" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">convolution</text>
              <path d="M 72 38 L 72 60" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(72, 38)" class="figure-path"/>
            </g>
            <g transform="translate(210, 155)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="72" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">batch normalization</text>
              <path d="M 72 38 L 72 60" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(72, 38)" class="figure-path"/>
            </g>
            <g transform="translate(210, 95)" class="film-layer">
              <rect width="144" height="38" class="figure-element figure-box figure-film-layer"/>
              <text x="72" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">FiLM</text>
              <path d="M 72 38 L 72 60" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(72, 38)" class="figure-path"/>
              <path d="M 0 19 l -50 0" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(0, 19)" class="figure-path"/>
              <text x="-38" y="8" style="font-family: serif;" class="figure-text"><tspan>β</tspan><tspan dy="5px" class="subscript">1</tspan><tspan dy="-5px">, γ</tspan><tspan dy="5px" class="subscript">1</tspan></text>
            </g>
            <g transform="translate(210, 35)">
              <rect width="144" height="38" class="figure-element figure-box"/>
              <text x="72" y="19" dy="0.4em" style="text-anchor: middle;" class="figure-text">ReLU</text>
              <path d="M 72 38 L 72 60" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(72, 38)" class="figure-path"/>
              <path d="M 72 0 L 72 -40" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(72, -40)" class="figure-path"/>
            </g>
          </g>
          <path d="M 212 434 L 254 434 A 6 6 0 0 0 260 428 L 260 285 A 6 6 0 0 1 266 279 L 308 279" class="figure-line"/>
          <use xlink:href="#arrow-right" transform="translate(308, 279)" class="figure-path"/>
          <text x="265" y="145" style="font-family: serif;" class="figure-text"><tspan>β</tspan><tspan dy="5px" class="subscript">N</tspan><tspan dy="-5px">, γ</tspan><tspan dy="5px" class="subscript">N</tspan></text>
          <path d="M 212 434 L 254 434 A 6 6 0 0 0 260 428 L 260 225 A 6 6 0 0 1 266 219 L 308 219" class="figure-line"/>
          <use xlink:href="#arrow-right" transform="translate(308, 219)" class="figure-path"/>
          <text x="265" y="205" style="font-family: serif;" class="figure-text"><tspan>β</tspan><tspan dy="5px" class="subscript">2</tspan><tspan dy="-5px">, γ</tspan><tspan dy="5px" class="subscript">2</tspan></text>
          <path d="M 212 434 L 254 434 A 6 6 0 0 0 260 428 L 260 165 A 6 6 0 0 1 266 159 L 308 159" class="figure-line"/>
          <use xlink:href="#arrow-right" transform="translate(308, 159)" class="figure-path"/>
          <text x="265" y="265" style="font-family: serif;" class="figure-text"><tspan>β</tspan><tspan dy="5px" class="subscript">1</tspan><tspan dy="-5px">, γ</tspan><tspan dy="5px" class="subscript">1</tspan></text>
          <path d="M 452 260 L 526 53" class="figure-line figure-dashed"/>
          <path d="M 452 298 L 526 432" class="figure-line figure-dashed"/>
        </svg>
        <figcaption>
          Visual reasoning model trained on CLEVR. The residual blocks of the
          visual pipeline are FiLM-ed, and the linguistic pipeline acts as the
          FiLM generator.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#clevr-diagram > svg");
            svg.select("g.film-generator")
                .on("mouseenter", function () {
                    svg.select("g.film-generator > text").text("FiLM generator");
                    svg.select("g.film-generator > rect").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-generator > text").text("linguistic pipeline");
                    svg.select("g.film-generator > rect").style("fill", null)
                });
            svg.select("g.film-layer")
                .on("mouseenter", function () {
                    svg.select("g.film-layer > text").text("FiLM layer");
                    svg.select("g.film-layer > rect").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-layer > text").text("FiLM");
                    svg.select("g.film-layer > rect").style("fill", null)
                });
            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    svg.select("g.filmed-network > text").text("FiLM-ed network");
                    svg.select("g.filmed-network > rect").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    svg.select("g.filmed-network > text").text("visual pipeline");
                    svg.select("g.filmed-network > rect").style("fill", null)
                });
            })();
      </script>
      <p>
        The model features a FiLM generator in the form of a linguistic pipeline
        extracting a question representation which is then linearly mapped to
        the FiLM parameter values. The visual pipeline is conditioned by
        inserting a FiLM layer in the residual pathway of each residual block of
        the convolutional neural network. The model is trained end-to-end on
        image-question-answer tuples.
      </p>
      <p>
        We can also leverage FiLM to condition a pre-trained network. In
        <dt-cite key="vries2017modulating"></dt-cite>, the visual pipeline of a
        visual question-answering (VQA) model is modulated by the model's
        linguistic pipeline through conditional batch normalization (CBN),
        which can be viewed as a special case of FiLM. The model is trained on
        the "oracle" sub-task of the GuessWhat?! task
        <dt-cite key="vries2017guesswhat"></dt-cite> &mdash; which features
        natural language questions on images answerable by yes, no, or N/A
        &mdash; as well as the VQAv1 <dt-cite key="agrawal2015vqa"></dt-cite>
        dataset.
      </p>
      <figure class="l-body-outset" id="guesswhat-diagram">
        <svg viewBox="0 0 744 700" xmlns="http://www.w3.org/2000/svg">
          <text x="372" y="10" style="text-anchor: middle;" class="figure-text">Answer: no</text>
          <g transform="translate(112, 30)">
            <rect width="520" height="40" class="figure-group figure-box"/>
            <text x="260" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">fusion block</text>
            <path d="M 260 0 L 260 -15" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(260, -15)"  class="figure-path"/>
          </g>
          <g transform="translate(50, 100)">
            <rect width="190" height="40" class="figure-element figure-box"/>
            <text x="95" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">attention</text>
            <path d="M 95 0 L 95 -30" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(95, -30)"  class="figure-path"/>
          </g>
          <g transform="translate(20, 180)">
            <g class="filmed-network">
              <rect width="280" height="440" class="figure-group figure-box figure-filmed-network"/>
              <text x="10" y="15" dy="0.4em" class="figure-text">visual pipeline</text>
            </g>
            <image x="93" y="450" width="64" height="64" xlink:href="assets/guesswhat_input.jpg"/>
            <path d="M 125 450 L 125 426" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(125, 426)"  class="figure-path"/>
            <g transform="translate(30, 386)">
              <rect width="190" height="40" class="figure-element figure-box"/>
              <text x="95" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">sub-network</text>
            </g>
            <g transform="translate(30, 238)">
              <rect width="190" height="128" class="figure-element figure-box"/>
              <text x="10" y="64" class="figure-text" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 10, 64)">batch normalization</text>
              <g transform="translate(30, 15)" class="film-layer">
                <rect width="140" height="40" class="figure-element figure-box figure-film-layer"/>
                <text x="70" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">affine transformation</text>
                <text x="170" y="10" style="font-family: serif;" class="figure-text"><tspan>β</tspan><tspan dy="5px" class="subscript">1</tspan><tspan dy="-5px">, γ</tspan><tspan dy="5px" class="subscript">1</tspan></text>
                <path d="M 65 40 L 65 60" class="figure-line"/>
                <use xlink:href="#arrow-up" transform="translate(65, 40)"  class="figure-path"/>
              </g>
              <g transform="translate(30, 75)">
                <rect width="140" height="40" class="figure-element figure-box"/>
                <text x="70" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">normalization</text>
                <path d="M 65 40 L 65 73" class="figure-line"/>
                <use xlink:href="#arrow-up" transform="translate(65, 40)"  class="figure-path"/>
              </g>
            </g>
            <g transform="translate(30, 178)">
              <rect width="190" height="40" class="figure-element figure-box"/>
              <text x="95" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">sub-network</text>
              <path d="M 95 40 L 95 75" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(95, 40)"  class="figure-path"/>
            </g>
            <g transform="translate(30, 30)">
              <rect width="190" height="128" class="figure-element figure-box"/>
              <text x="10" y="64" class="figure-text" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 10, 64)">batch normalization</text>
              <g transform="translate(30, 15)" class="film-layer">
                <rect width="140" height="40" class="figure-element figure-box figure-film-layer"/>
                <text x="70" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">affine transformation</text>
                <text x="170" y="10" style="font-family: serif;" class="figure-text"><tspan>β</tspan><tspan dy="5px" class="subscript">2</tspan><tspan dy="-5px">, γ</tspan><tspan dy="5px" class="subscript">2</tspan></text>
                <path d="M 65 40 L 65 60" class="figure-line"/>
                <use xlink:href="#arrow-up" transform="translate(65, 40)"  class="figure-path"/>
                <path d="M 65 0 L 65 -85" class="figure-line"/>
                <use xlink:href="#arrow-up" transform="translate(65, -85)"  class="figure-path"/>
              </g>
              <g transform="translate(30, 75)">
                <rect width="140" height="40" class="figure-element figure-box"/>
                <text x="70" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">normalization</text>
                <path d="M 65 40 L 65 73" class="figure-line"/>
                <use xlink:href="#arrow-up" transform="translate(65, 40)"  class="figure-path"/>
              </g>
            </g>
          </g>
          <g transform="translate(342, 180)" class="film-generator">
            <rect width="280" height="440" class="figure-group figure-box figure-film-generator"/>
            <text x="10" y="15" dy="0.4em" class="figure-text">linguistic pipeline</text>
            <text x="150" y="460" dy="0.4em" style="text-anchor: middle;" class="figure-text">Is the umbrella upside down?</text>
            <path d="M 150 386 L 150 -110" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(150, -110)"  class="figure-path"/>
            <path d="M 150 386 L 150 279 A 6 6 0 0 0 144 273 L 130 273" class="figure-line"/>
            <use xlink:href="#arrow-left" transform="translate(130, 273)"  class="figure-path"/>
            <path d="M 150 386 L 150 71 A 6 6 0 0 0 144 65 L 130 65" class="figure-line"/>
            <use xlink:href="#arrow-left" transform="translate(130, 65)"  class="figure-path"/>
            <g transform="translate(65, 386)">
              <rect width="170" height="40" class="figure-element figure-box"/>
              <text x="85" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">LSTM</text>
              <path d="M 85 40 L 85 65" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(85, 40)"  class="figure-path"/>
            </g>
            <g transform="translate(20, 253)">
              <rect width="110" height="40" class="figure-element figure-box"/>
              <text x="55" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">MLP</text>
              <path d="M 0 20 L -142 20" class="figure-line"/>
              <use xlink:href="#arrow-left" transform="translate(-142, 20)"  class="figure-path"/>
            </g>
            <g transform="translate(20, 45)">
              <rect width="110" height="40" class="figure-element figure-box"/>
              <text x="55" y="20" dy="0.4em" style="text-anchor: middle;" class="figure-text">MLP</text>
              <path d="M 0 20 L -142 20" class="figure-line"/>
              <use xlink:href="#arrow-left" transform="translate(-142, 20)"  class="figure-path"/>
            </g>
          </g>
        </svg>
        <figcaption>
          Visual question-answering (VQA) model in in <dt-cite key="vries2017modulating"></dt-cite>.
          The feature-wise affine transformations inside the batch normalization
          layers of the pre-trained ResNet visual pipeline are modulated by the
          linguistic pipeline.<br><br>
          <em>
            N.B.: the visual pipeline architecture is simplified for
            illustrative purposes and is not representative of the actual
            ResNet architecture.
          </em>
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#guesswhat-diagram > svg");
            svg.select("g.film-generator")
                .on("mouseenter", function () {
                    svg.select("g.film-generator > text").text("FiLM generator");
                    svg.select("g.film-generator > rect").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-generator > text").text("linguistic pipeline");
                    svg.select("g.film-generator > rect").style("fill", null)
                });
            svg.selectAll("g.film-layer")
                .on("mouseenter", function () {
                    svg.selectAll("g.film-layer").select("g.film-layer > text").text("FiLM layer");
                    svg.selectAll("g.film-layer").select("g.film-layer > rect").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    svg.selectAll("g.film-layer").select("g.film-layer > text").text("affine transformation");
                    svg.selectAll("g.film-layer").select("g.film-layer > rect").style("fill", null)
                });
            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    svg.select("g.filmed-network > text").text("FiLM-ed network");
                    svg.select("g.filmed-network > rect").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    svg.select("g.filmed-network > text").text("visual pipeline");
                    svg.select("g.filmed-network > rect").style("fill", null)
                });
        })();
      </script>
      <p>
        The visual pipeline consists of a pre-trained residual network and is
        kept fixed throughout training. The linguistic pipeline interacts with
        the visual pipeline by outputting perturbations to the residual
        network's batch normalization parameters. Like hinted at earlier, CBN
        can be viewed as an instance of FiLM where the post-normalization
        feature-wise affine transformation is replaced with a FiLM layer.
      </p>
      <p>
        We can also use FiLM layers to condition a style transfer network on a
        chosen style image. In <dt-cite key="dumoulin2017learned"></dt-cite>, fast feedforward style
        transfer networks are extended to accommodate multiple styles by
        introducing <strong>c</strong>onditional <strong>i</strong>nstance
        <strong>n</strong>ormalization (CIN) layers. Each style modeled by the
        network is associated with its own set of instance normalization
        parameters, and conditioning is achieved by applying the normalization
        with style-specific parameters.
      </p>
      <figure class="l-body-outset" id="alrfas-diagram">
        <svg viewBox="0 0 744 500" xmlns="http://www.w3.org/2000/svg">
          <g>
            <g class="filmed-network">
              <rect x="113" y="79" width="434" height="251" class="figure-group figure-box figure-filmed-network"/>
              <text x="118" y="97" class="figure-text">style transfer network</text>
            </g>
            <g transform="translate(128, 125)">
              <rect width="38" height="170" class="figure-element figure-box"/>
              <text x="19" y="85" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 19, 85)" class="figure-text">convolution</text>
            </g>
            <g transform="translate(182, 114)">
              <rect width="140" height="207" class="figure-element figure-box"/>
              <g transform="translate(18, 11)">
                <rect width="38" height="170" class="figure-element figure-box"/>
                <text x="19" y="85" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 19, 85)" class="figure-text">normalization</text>
              </g>
              <path d="M 56 96 l 28 0" class="figure-line"/>
              <use x="84" y="96" href="#arrow-right" class="figure-path"/>
              <g transform="translate(84, 11)" class="film-layer">
                <rect width="38" height="170" class="figure-element figure-box figure-film-layer"/>
                <text x="19" y="85" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 19, 85)" class="figure-text">affine transformation</text>
              </g>
              <text x="5" y="200" class="figure-text">instance norm.</text>
            </g>
            <g transform="translate(338, 125)">
              <rect width="38" height="170" class="figure-element figure-box"/>
              <text x="19" y="85" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 19, 85)" class="figure-text">convolution</text>
            </g>
            <g transform="translate(392, 114)">
              <rect width="140" height="207" class="figure-element figure-box"/>
              <g transform="translate(18, 11)">
                <rect width="38" height="170" class="figure-element figure-box"/>
                <text x="19" y="85" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 19, 85)" class="figure-text">normalization</text>
              </g>
              <path d="M 56 96 l 28 0" class="figure-line"/>
              <use x="84" y="96" href="#arrow-right" class="figure-path"/>
              <g transform="translate(84, 11)" class="film-layer">
                <rect width="38" height="170" class="figure-element figure-box figure-film-layer"/>
                <text x="19" y="85" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 19, 85)" class="figure-text">affine transformation</text>
              </g>
              <text x="5" y="200" class="figure-text">instance norm.</text>
            </g>
            <path d="M 165 210 l 35 0" class="figure-line"/>
            <use x="200" y="210" href="#arrow-right" class="figure-path"/>
            <path d="M 304 210 l 34 0" class="figure-line"/>
            <use x="338" y="210" href="#arrow-right" class="figure-path"/>
            <path d="M 375 210 l 35 0" class="figure-line"/>
            <use x="410" y="210" href="#arrow-right" class="figure-path"/>
            <path d="M 513 210 l 53 0" class="figure-line"/>
            <use x="566" y="210" href="#arrow-right" class="figure-path"/>
          </g>
          <image x="10" y="394" width="96" height="96" xlink:href="assets/cassis_cap_lombard_opus_196.jpg"/>
          <line x1="681" y1="58" x2="106" y2="58" class="figure-line"/>
          <use x="681" y="58" href="#arrow-right" class="figure-path"/>
          <path d="M 58 106 l 0 98 a 6 6 0 0 0 6 6 l 64 0" class="figure-line"/>
          <use x="128" y="210" href="#arrow-right" class="figure-path"/>
          <image x="10" y="10" width="96" height="96" xlink:href="assets/tuebingen_neckarfront.jpg"/>
          <line x1="681" y1="442" x2="106" y2="442" class="figure-line"/>
          <use x="681" y="442" href="#arrow-right" class="figure-path"/>
          <path d="M 58 394 l 0 -5 a 6 6 0 0 1 6 -6 l 166 0" class="figure-line"/>
          <use x="230" y="383" href="#arrow-right" class="figure-path"/>
          <image x="566" y="162" width="96" height="96" xlink:href="assets/tuebingen_neckarfront_cassis_cap_lombard_opus_196.jpg"/>
          <line x1="681" y1="210" x2="662" y2="210" class="figure-line"/>
          <use x="681" y="210" href="#arrow-right" class="figure-path"/>
          <g transform="translate(231, 339)" class="film-generator">
            <rect width="318" height="86" class="figure-group figure-box figure-film-generator"/>
            <text x="159" y="43" dy="0.4em" style="text-anchor: middle;" class="figure-text">style prediction network</text>
          </g>
          <path d="M 284 339 l 0 -44" class="figure-line"/>
          <use x="284" y="295" href="#arrow-up"/>
          <path d="M 495 339 l 0 -44" class="figure-line"/>
          <use x="495" y="295" href="#arrow-up"/>
          <g transform="translate(681, 26)">
            <rect width="56" height="448" class="figure-group figure-box"/>
            <text x="28" y="224" dy="0.4em" style="text-anchor: middle;" class="figure-text" transform="rotate(-90, 28, 224)">style transfer loss</text>
          </g>
        </svg>
        <figcaption>
          Fast, arbitrary artistic style transfer model. The style prediction
          network predicts the value of the instance normalization layers'
          feature-wise affine transformation parameters from the style
          image.<br><br>
          <em>
            N.B.: the style transfer network architecture is simplified for
            illustrative purposes and is not representative of the actual
            architecture.
          </em>
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#alrfas-diagram > svg");
            svg.select("g.film-generator")
                .on("mouseenter", function () {
                    svg.select("g.film-generator > text").text("FiLM generator");
                    svg.select("g.film-generator > rect").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("g.film-generator > text").text("style prediction network");
                    svg.select("g.film-generator > rect").style("fill", null);
                });
            svg.selectAll("g.film-layer")
                .on("mouseenter", function () {
                    svg.selectAll("g.film-layer").select("g.film-layer > text").text("FiLM layer");
                    svg.selectAll("g.film-layer").select("g.film-layer > rect").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    svg.selectAll("g.film-layer").select("g.film-layer > text").text("affine transformation");
                    svg.selectAll("g.film-layer").select("g.film-layer > rect").style("fill", null);
                });
            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    svg.select("g.filmed-network > text").text("FiLM-ed network");
                    svg.select("g.filmed-network > rect").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    svg.select("g.filmed-network > text").text("style transfer network");
                    svg.select("g.filmed-network > rect").style("fill", null);
                });
        })();
      </script>
      <p>
        This intuition is pushed further by <dt-cite key="ghiasi2017exploring"></dt-cite>
        with the introduction of a <em>style prediction network</em> which is
        trained jointly with the style transfer network to predict the instance
        normalization parameters directly from a given style image.
      </p>
      <p>
        Like CBN, CIN can be seen as an instance of FiLM where the
        post-normalization feature-wise affine transformation is replaced with a
        FiLM layer. The main differentiator between <dt-cite key="dumoulin2017learned"></dt-cite>
        and <dt-cite key="ghiasi2017exploring"></dt-cite> is the FiLM generator
        implementation: in the former the generator is a simple embedding
        lookup, whereas in the latter the generator is a convolutional neural
        network.
      </p>
      <p>
        So far, the models we covered have two sub-networks: a primary network
        in which feature-wise transformations are applied, and a secondary
        network which outputs parameters for these transformations. However,
        this distinction between <em>FiLM-ed network</em> and <em>FiLM generator</em>
        is not strictly necessary. As an example, <dt-cite key="huang2017arbitrary"></dt-cite>
        proposes an alternative for fast and arbitrary style transfer in the
        form of an adaptive instance normalization (AdaIN) layer.
      </p>
      <figure class="l-body-outset" id="adain-diagram">
        <svg viewBox="0 0 744 500" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="linearStroke" x1="0%" y1="0%" x2="0%" y2="100%" spreadMethod="pad">
              <stop offset="0%"   stop-color="#2196f3"/>
              <stop offset="100%" stop-color="#f44336"/>
            </linearGradient>
            <linearGradient id="linearFill" x1="0%" y1="0%" x2="0%" y2="100%" spreadMethod="pad">
              <stop offset="0%"   stop-color="#90caf9"/>
              <stop offset="100%" stop-color="#ef9a9a"/>
            </linearGradient>
          </defs>
          <image x="10" y="351" width="96" height="96" xlink:href="assets/cassis_cap_lombard_opus_196.jpg"/>
          <path d="M 106 399 l 573 0" class="figure-line"/>
          <use xlink:href="#arrow-right" transform="translate(681, 399)" class="figure-path"/>
          <path d="M 132 284 L 58 284 L 58 351" class="figure-line figure-film-generator-edge"/>
          <use xlink:href="#arrow-right" transform="translate(132, 284)" class="figure-path figure-film-generator-arrow"/>
          <image x="10" y="53" width="96" height="96" xlink:href="assets/tuebingen_neckarfront.jpg"/>
          <path d="M 58 149 L 58 216 L 132 216" class="figure-line figure-filmed-network-edge"/>
          <use xlink:href="#arrow-right" transform="translate(132, 216)" class="figure-path figure-filmed-network-arrow"/>
          <path d="M 106 101 l 573 0" class="figure-line"/>
          <use xlink:href="#arrow-right" transform="translate(681, 101)" class="figure-path"/>
          <image x="568" y="202" width="96" height="96" xlink:href="assets/tuebingen_neckarfront_cassis_cap_lombard_opus_196.jpg"/>
          <path d="M 664 250 l 17 0" class="figure-line"/>
          <use xlink:href="#arrow-right" transform="translate(681, 250)" class="figure-path"/>
          <g transform="translate(132, 150)" id="encoder">
            <rect width="114" height="208" style="stroke: url(#linearStroke); stroke-width: 1.5px;" class="figure-group figure-box"/>
            <text x="57" y="104" dy="0.4em" style="text-anchor: middle;" class="figure-text">encoder</text>
            <text x="57" y="-6" style="text-anchor: middle;" class="figure-text figure-filmed-network-text"></text>
            <text x="57" y="224" style="text-anchor: middle;" class="figure-text figure-film-generator-text"></text>
          </g>
          <g transform="translate(412, 150)" id="decoder">
            <rect width="114" height="208" class="figure-group figure-box figure-filmed-network"/>
            <text x="57" y="104" dy="0.4em" style="text-anchor: middle;" class="figure-text">decoder</text>
            <text x="57" y="-6" style="text-anchor: middle;" class="figure-text figure-filmed-network-text"></text>
          </g>
          <g transform="translate(266, 150)">
            <g id="adain">
              <rect width="128" height="207" style="stroke: url(#linearStroke); stroke-width: 1.5px;" class="figure-group figure-box"/>
              <text x="64" y="196" style="text-anchor: middle;" class="figure-text">AdaIN</text>
            </g>
            <text x="64" y="-6" style="text-anchor: middle;" class="figure-text figure-filmed-network-text"></text>
            <text x="64" y="224" style="text-anchor: middle;" class="figure-text figure-film-generator-text"></text>
            <g transform="translate(15, 22)">
              <rect width="38" height="154" class="figure-element figure-box"/>
              <text x="19" y="77" transform="rotate(-90, 19, 77)" dy="0.4em" style="text-anchor: middle;" class="figure-text">instance normalization</text>
            </g>
            <path d="M 54 134 l 20 0" class="figure-line figure-film-generator-edge"/>
            <use xlink:href="#arrow-right" transform="translate(74, 134)" class="figure-path figure-film-generator-arrow"/>
            <path d="M 54 66 l 20 0" class="figure-line figure-filmed-network-edge"/>
            <use xlink:href="#arrow-right" transform="translate(74, 66)" class="figure-path figure-filmed-network-arrow"/>
            <g transform="translate(74, 22)" class="film-layer">
              <rect width="38" height="154" class="figure-element figure-box figure-film-layer"/>
              <text x="19" y="77" transform="rotate(-90, 19, 77)" dy="0.4em" style="text-anchor: middle;" class="figure-text">affine transformation</text>
            </g>
          </g>
          <path d="M 246 284 l 34 0" class="figure-line figure-film-generator-edge"/>
          <use xlink:href="#arrow-right" transform="translate(280, 284)" class="figure-path figure-film-generator-arrow"/>
          <path d="M 246 216 l 34 0" class="figure-line figure-filmed-network-edge"/>
          <use xlink:href="#arrow-right" transform="translate(280, 216)" class="figure-path figure-filmed-network-arrow"/>
          <path d="M 378 250 l 34 0" class="figure-line figure-filmed-network-edge"/>
          <use xlink:href="#arrow-right" transform="translate(412, 250)" class="figure-path figure-filmed-network-arrow"/>
          <path d="M 526 250 l 42 0" class="figure-line figure-filmed-network-edge"/>
          <use xlink:href="#arrow-right" transform="translate(568, 250)" class="figure-path figure-filmed-network-arrow"/>
          <g transform="translate(681, 26)">
            <rect width="56" height="448" class="figure-group figure-box"/>
            <text x="28" y="224" dy="0.4em" style="text-anchor: middle;" class="figure-text" transform="rotate(-90, 28, 224)">style transfer loss</text>
          </g>
        </svg>
        <figcaption>
          Another approach to fast, arbitrary artistic style transfer models.
          When applying instance normalization to the output of the encoder
          given the content image, the instance normalization layer's
          feature-wise affine transformation parameters are computed as the
          style image's instance normalization statistics in the same layer.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#adain-diagram > svg");
            svg.selectAll("g#encoder, g#adain, g#decoder")
                .on("mouseenter", function () {
                    svg.selectAll("g#encoder > rect, g#adain > rect").style("fill", "url(#linearFill)");
                    svg.select("g#decoder > rect").style("fill", "#90caf9");
                    svg.selectAll(".figure-film-generator-edge").style("stroke", "#c62828");
                    svg.selectAll(".figure-film-generator-arrow")
                        .style("fill", "#c62828")
                        .style("stroke", "#c62828");
                    svg.selectAll(".figure-filmed-network-edge").style("stroke", "#1e88e5");
                    svg.selectAll(".figure-filmed-network-arrow")
                        .style("fill", "#1e88e5")
                        .style("stroke", "#1e88e5");
                    svg.selectAll(".figure-filmed-network-text").text("FiLM-ed network");
                    svg.selectAll(".figure-film-generator-text").text("FiLM generator");
                })
                .on("mouseleave", function () {
                    svg.selectAll("g#encoder > rect, g#adain > rect").style("fill", null);
                    svg.select("g#decoder > rect").style("fill", null);
                    svg.selectAll(".figure-film-generator-edge").style("stroke", null);
                    svg.selectAll(".figure-film-generator-arrow")
                        .style("fill", null)
                        .style("stroke", null);
                    svg.selectAll(".figure-filmed-network-edge").style("stroke", null);
                    svg.selectAll(".figure-filmed-network-arrow")
                        .style("fill", null)
                        .style("stroke", null);
                    svg.selectAll(".figure-filmed-network-text, .figure-film-generator-text").text("");
                });
            svg.select("g.film-layer")
                .on("mouseenter", function () {
                    d3.select(this).select("g.film-layer > text").text("FiLM layer");
                    d3.select(this).select("g.film-layer > rect").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    d3.select(this).select("g.film-layer > text").text("affine transformation");
                    d3.select(this).select("g.film-layer > rect").style("fill", null)
                });
        })();
      </script>
      <p>
        The model architecture consists of an encoder-decoder pair. The encoder
        is the same neural network that is used to compute the content and style
        losses, and is kept fixed throughout training. A content/style image
        pair is first encoded, and the encoded stack of <em>content</em> feature
        maps is instance-normalized. Instance normalization statistics are then
        computed for the encoded stack of <em>style</em> feature maps and used
        to perform a feature-wise affine transformation on the normalized stack
        of content feature maps. The result is then passed through the decoder
        to obtain the stylized image, and the triplet of content/style/stylized
        images is used to compute the style transfer loss. The decoder is
        trained on many content/style image pairs to minimize this loss.
      </p>
      <p>
        Interestingly, the encoder can be seen as <em>both</em> a part of the
        FiLM-ed network, <em>and</em> the FiLM generator <em>itself</em>.
        Therefore, AdaIN can be interpreted as a FiLM layer replacing the
        instance normalization parameters, with the FiLM-generating network
        taking the form of the same neural network that is used to extract
        instance normalization statistics on the style image.
      </p>
      <p>
        Feature-wise affine transformations are also used in the reinforcement
        learning (RL) setting. In <dt-cite key="kirkpatrick2017overcoming"></dt-cite>,
        the authors briefly touch the idea of applying conditional feature-wise
        affine transformations to a reinforcement learning problem. They train
        an agent that learns to play 10 Atari games using a single Double DQN
        network with task-specific gains and biases, which can be viewed as
        inserting FiLM layers throughout its hierarchy.
      </p>
      
      <h2>Convolution prediction</h2>
      <p>
        Up to now, the FiLM layer was used on top of the pre-computed features.
        For instance, an image input is first processed by a convnet and then transformed with a FiLM Layer conditioned on another input.   
        However, one may directly try to predict the full convnet from the external information; making a step further towards Hypernetworks<dt-cite key="ha2016hypernetworks"></dt-cite>.
     </p>
     <p>   
        For instance, Adaptive CNN (ACNN) <dt-cite key="kang2017incorporating"></dt-cite> predict the convolution layer based on the camera perspective, level of noise etc.
        The resulting convolution filters turn out to be very effective in difficult vision task such as crowd counting or image deblurring.
        
        Differently, predicting a convnet was studied in zero-shot/one-shot learning.
        For instance, Lei Ba et Al. <dt-cite key="lei2015predicting"></dt-cite> predicts convolutional filters and a classifiers based on textual description for zero-shot image classification. 
        Junhyuk Oh et Al.  <dt-cite key="oh2017zero"></dt-cite> computes a policy-convolutional network conditioned on the task description.  
      </p>
       <p> 
        Obviously, FiLM layers requires to predict far fewer parameters that predicting a convolutional filters while being more constrained.  
        However, rigourously benchmarking both approaches is still ongoing work. And both methods may draw inspiration from each others  
		</p>
      
      <h2>Self-conditioning</h2>
      <p>
        As we have seen so far, feature-wise transformations can be used as a
        conditioning mechanism to incorporate external information such as
        context representation, task description, class information, or user
        information. However, there is nothing preventing us from considering a
        neural network's hidden activations <em>themselves</em> as conditioning
        information. This idea gives rise to various forms of
        <em>self-conditioned</em> models.
      </p>
      <p>
        In the speech recognition domain, <dt-cite key="kim2017dynamic"></dt-cite>
        modulates a deep bidirectional LSTM using a form of conditional
        normalization which the authors call <em>dynamic layer normalization</em>.
        In analogy to conditional instance normalization and conditional batch
        normalization, dynamic layer normalization can be seen as an instance of
        FiLM where the post-normalization feature-wise affine transformation is
        disabled and a FiLM layer is placed immediately after the instance
        normalization layer.
      </p>
      <figure class="l-body-outset" id="dln-diagram">
        <svg viewBox="0 0 744 500" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(50, 10)">
            <g class="filmed-network">
              <rect width="440" height="420" class="figure-group figure-box figure-filmed-network"/>
              <text x="10" y="20" dy="0.4em" class="figure-text">LSTM layer</text>
            </g>
            <path d="M -60 80 L -35 80" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(-35, 80)" class="figure-path"/>
            <text x="-30" y="80" dy="0.4em" class="figure-text"><tspan style="font-weight: bold;">c</tspan><tspan dy="5px" class="subscript">t-1</tspan></text>
            <path d="M -10 80 L 73 80" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(73, 80)" class="figure-path"/>
            <g transform="translate(93, 80)">
              <ellipse cx="0" cy="0" rx="20" ry="20" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <path d="M 113 80 L 263 80" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(263, 80)" class="figure-path"/>
            <g transform="translate(283, 80)">
              <ellipse rx="20" ry="20" class="figure-element"/>
              <line x1="0" y1="-7.5" x2="0" y2="7.5" class="figure-line"/>
              <line x1="-7.5" y1="0" x2="7.5" y2="0" class="figure-line"/>
            </g>
            <path d="M 303 80 L 372 80 A 6 6 0 0 1 378 86 L 378 98" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(378, 98)" class="figure-path"/>
            <g transform="translate(378, 118)">
              <ellipse rx="20" ry="20" class="figure-element"/>
              <text dy="0.4em" style="text-anchor: middle;" class="figure-text">tanh</text>
            </g>
            <path d="M 303 80 L 460 80" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(460, 80)" class="figure-path"/>
            <text x="465" y="80" dy="0.4em" class="figure-text"><tspan style="font-weight: bold;">c</tspan><tspan dy="5px" class="subscript">t</tspan></text>
            <path d="M 283 100 L 283 155" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(283, 100)" class="figure-path"/>
            <g transform="translate(283, 175)">
              <ellipse cx="0" cy="0" rx="20" ry="20" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <path d="M 378 138 L 378 155" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(378, 155)" class="figure-path"/>
            <g transform="translate(378, 175)">
              <ellipse cx="0" cy="0" rx="20" ry="20" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <path d="M 93 235 L 93 100" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(93, 100)" class="figure-path"/>
            <g transform="translate(93, 255)">
              <ellipse rx="20" ry="20" class="figure-element"/>
              <text dy="0.4em" style="text-anchor: middle;" class="figure-text">σ</text>
            </g>
            <path d="M 188 235 L 188 181 A 6 6 0 0 1 194 175 L 263 175" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(263, 175)" class="figure-path"/>
            <g transform="translate(188, 255)">
              <ellipse rx="20" ry="20" class="figure-element"/>
              <text dy="0.4em" style="text-anchor: middle;" class="figure-text">σ</text>
            </g>
            <path d="M 283 235 L 283 195" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(283, 195)" class="figure-path"/>
            <g transform="translate(283, 255)">
              <ellipse rx="20" ry="20" class="figure-element"/>
              <text dy="0.4em" style="text-anchor: middle;" class="figure-text">tanh</text>
            </g>
            <path d="M 378 235 L 378 195" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(378, 195)" class="figure-path"/>
            <g transform="translate(378, 255)">
              <ellipse rx="20" ry="20" class="figure-element"/>
              <text dy="0.4em" style="text-anchor: middle;" class="figure-text">σ</text>
            </g>
            <path d="M 93 297 L 93 275" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(93, 275)" class="figure-path"/>
            <rect x="59" y="297" width="70" height="60" class="figure-element figure-box figure-dashed"/>
            <path d="M 188 297 L 188 275" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(188, 275)" class="figure-path"/>
            <rect x="154" y="297" width="70" height="60" class="figure-element figure-box figure-dashed"/>
            <path d="M 283 297 L 283 275" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(283, 275)" class="figure-path"/>
            <rect x="249" y="297" width="70" height="60" class="figure-element figure-box figure-dashed"/>
            <path d="M 378 297 L 378 275" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(378, 275)" class="figure-path"/>
            <rect x="344" y="297" width="70" height="60" class="figure-element figure-box figure-dashed"/>
            <path d="M -60 380 L -35 380" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(-35, 380)" class="figure-path"/>
            <text x="-30" y="380" dy="0.4em" class="figure-text"><tspan style="font-weight: bold;">h</tspan><tspan dy="5px" class="subscript">t-1</tspan></text>
            <path d="M -10 380 L 71 380 A 6 6 0 0 0 77 374 L 77 357" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(77, 357)" class="figure-path"/>
            <path d="M -10 380 L 166 380 A 6 6 0 0 0 172 374 L 172 357" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(172, 357)" class="figure-path"/>
            <path d="M -10 380 L 261 380 A 6 6 0 0 0 267 374 L 267 357" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(267, 357)" class="figure-path"/>
            <path d="M -10 380 L 356 380 A 6 6 0 0 0 362 374 L 362 357" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(362, 357)" class="figure-path"/>
            <g transform="translate(-30, 452)" class="film-generator" id="film-gen-utt-sum">
              <rect width="74" height="26" class="figure-element figure-box figure-film-generator"/>
              <text x="37" y="13" dy="0.4em" style="text-anchor: middle;" class="figure-text">utt. sum.</text>
            </g>
            <path d="M 7 452 L 7 402 A 6 6 0 0 1 13 396 L 87 396 A 6 6 0 0 0 93 390 L 93 357" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(93, 357)" class="figure-path"/>
            <path d="M 7 452 L 7 402 A 6 6 0 0 1 13 396 L 182 396 A 6 6 0 0 0 188 390 L 188 357" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(188, 357)" class="figure-path"/>
            <path d="M 7 452 L 7 402 A 6 6 0 0 1 13 396 L 277 396 A 6 6 0 0 0 283 390 L 283 357" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(283, 357)" class="figure-path"/>
            <path d="M 7 452 L 7 402 A 6 6 0 0 1 13 396 L 372 396 A 6 6 0 0 0 378 390 L 378 357" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(378, 357)" class="figure-path"/>
            <text x="62" y="465" dy="0.4em" class="figure-text"><tspan style="font-weight: bold;">x</tspan><tspan dy="5px" class="subscript">t</tspan></text>
            <path d="M 65 458 L 65 418 A 6 6 0 0 1 71 412 L 103 412 A 6 6 0 0 0 109 406 L 109 357" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(109, 357)" class="figure-path"/>
            <path d="M 65 458 L 65 418 A 6 6 0 0 1 71 412 L 198 412 A 6 6 0 0 0 204 406 L 204 357" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(204, 357)" class="figure-path"/>
            <path d="M 65 458 L 65 418 A 6 6 0 0 1 71 412 L 293 412 A 6 6 0 0 0 299 406 L 299 357" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(299, 357)" class="figure-path"/>
            <path d="M 65 458 L 65 418 A 6 6 0 0 1 71 412 L 388 412 A 6 6 0 0 0 394 406 L 394 357" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(394, 357)" class="figure-path"/>
            <path d="M 44 465 L 57 465" class="figure-line"/>
            <use xlink:href="#arrow-left" transform="translate(44, 465)" class="figure-path"/>
            <path d="M 398 175 L 419 175 A 6 6 0 0 1 425 181 L 425 374 A 6 6 0 0 0 431 380 L 460 380" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(460, 380)" class="figure-path"/>
            <text x="465" y="380" dy="0.4em" class="figure-text"><tspan style="font-weight: bold;">h</tspan><tspan dy="5px" class="subscript">t</tspan></text>

            <path d="M 485 122 L 414 297" class="figure-line figure-dashed"/>
            <path d="M 485 358 L 414 357" class="figure-line figure-dashed"/>
            <g transform="translate(0, 24)">
              <rect x="485" y="98" width="200" height="236" class="figure-group figure-box figure-dashed"/>
              <text x="586" y="358" style="text-anchor: middle;" class="figure-text">utt. sum.</text>
              <path d="M 586 345 L 586 318" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(586, 318)" class="figure-path"/>
              <text x="534" y="358" style="text-anchor: middle;" class="figure-text"><tspan style="font-weight: bold;">h</tspan><tspan dy="5px" class="subscript">t-1</tspan></text>
              <path d="M 534 345 L 534 282" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(534, 282)" class="figure-path"/>
              <text x="638" y="358" style="text-anchor: middle;" class="figure-text"><tspan style="font-weight: bold;">x</tspan><tspan dy="5px" class="subscript">t</tspan></text>
              <path d="M 638 345 L 638 282" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(638, 282)" class="figure-path"/>
              <g transform="translate(494, 254)">
                <rect width="80" height="28" class="figure-element figure-box"/>
                <text x="40" y="14" dy="0.4em" style="text-anchor: middle;" class="figure-text">linear</text>
              </g>
              <g transform="translate(598, 254)">
                <rect width="80" height="28" class="figure-element figure-box"/>
                <text x="40" y="14" dy="0.4em" style="text-anchor: middle;" class="figure-text">linear</text>
              </g>
              <path d="M 534 254 L 534 230" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(534, 230)" class="figure-path"/>
              <path d="M 638 254 L 638 230" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(638, 230)" class="figure-path"/>
              <g transform="translate(546, 290)" class="film-generator" id="film-gen-linear">
                <rect width="80" height="28" class="figure-element figure-box figure-film-generator"/>
                <text x="40" y="14" dy="0.4em" style="text-anchor: middle;" class="figure-text">linear</text>
              </g>
              <path d="M 584 290 L 584 166 L 574 166" class="figure-line"/>
              <use xlink:href="#arrow-left" transform="translate(574, 166)" class="figure-path"/>
              <path d="M 588 290 L 588 166 L 598 166" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(598, 166)" class="figure-path"/>
              <g transform="translate(494, 202)">
                <rect width="80" height="28" class="figure-element figure-box"/>
                <text x="40" y="14" dy="0.4em" style="text-anchor: middle;" class="figure-text">layer norm.</text>
              </g>
              <g transform="translate(598, 202)">
                <rect width="80" height="28" class="figure-element figure-box"/>
                <text x="40" y="14" dy="0.4em" style="text-anchor: middle;" class="figure-text">layer norm.</text>
              </g>
              <path d="M 534 202 L 534 180" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(534, 180)" class="figure-path"/>
              <path d="M 638 202 L 638 180" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(638, 180)" class="figure-path"/>
              <g transform="translate(494, 152)" class="film-layer">
                <rect width="80" height="28" class="figure-element figure-box figure-film-layer"/>
                <text x="40" y="14" dy="0.4em" style="text-anchor: middle;" class="figure-text">affine</text>
              </g>
              <g transform="translate(598, 152)" class="film-layer">
                <rect width="80" height="28" class="figure-element figure-box figure-film-layer"/>
                <text x="40" y="14" dy="0.4em" style="text-anchor: middle;" class="figure-text">affine</text>
              </g>
              <path d="M 534 152 L 534 131 A 6 6 0 0 1 540 125 L 565 125" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(565, 125)" class="figure-path"/>
              <path d="M 638 152 L 638 131 A 6 6 0 0 0 634 125 L 605 125" class="figure-line"/>
              <use xlink:href="#arrow-left" transform="translate(605, 125)" class="figure-path"/>
              <g transform="translate(585, 125)">
                <ellipse rx="20" ry="20" class="figure-element"/>
                <line x1="0" y1="8" x2="0" y2="-8" class="figure-line"/>
                <line x1="8" y1="0" x2="-8" y2="0" class="figure-line"/>
              </g>
              <path d="M 585 105 L 585 85" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(585, 85)" class="figure-path"/>
            </g>
          </g>
        </svg>
        <figcaption>
          The speech recognition model in <dt-cite key="kim2017dynamic"></dt-cite>
          achieves speaker adaptation by predicting the layer normalization
          scaling and shifting coefficients inside its LSTMs' forget, input,
          and output gates from an utterance summarization vector.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#dln-diagram > svg");
            svg.selectAll("g.film-generator")
                .on("mouseenter", function () {
                    svg.selectAll("g.film-generator > text").text("FiLM gen.");
                    svg.selectAll("g.film-generator > .figure-film-generator").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("#film-gen-linear > text").text("linear");
                    svg.select("#film-gen-utt-sum > text").text("utt. sum.");
                    svg.selectAll("g.film-generator > .figure-film-generator").style("fill", null);
                });

            svg.selectAll("g.film-layer")
                .on("mouseenter", function () {
                    svg.selectAll("g.film-layer > text").text("FiLM");
                    svg.selectAll("g.film-layer > .figure-film-layer").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    svg.selectAll("g.film-layer > text").text("affine");
                    svg.selectAll("g.film-layer > .figure-film-layer").style("fill", null);
                });

            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    d3.select(this).select("g.filmed-network > text").text("FiLM-ed layer");
                    svg.selectAll("g.filmed-network > .figure-filmed-network").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    d3.select(this).select("g.filmed-network > text").text("LSTM layer");
                    svg.selectAll("g.filmed-network > .figure-filmed-network").style("fill", null);
                });
        })();
      </script>
      <p>
        The key difference here is that the conditioning signal does not come
        from an external source, but is rather computed from utterance
        summarization feature vectors extracted in each layer of the network
        as a way of adapting the neural acoustic model.
      </p>
      <p>
        In the visual domain, the ImageNet 2017 winning model
        <dt-cite key="hu2017squeeze"></dt-cite> employs a self-conditioning
        scheme in the form of feature-wise sigmoidal gating as a way to
        condition a layer's activations on its previous layer.
      </p>
      <figure class="l-body-outset" id="squeeze-diagram">
        <svg viewBox="0 0 744 360" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g transform="translate(90, 10)">
            <g class="filmed-network">
              <rect width="550" height="320" class="figure-group figure-box figure-filmed-network"/>
              <text x="10" y="20" dy="0.4em" class="figure-text">squeeze-and-excitation block</text>
            </g>
            <path d="M -20 270 L 20 270 A 6 6 0 0 0 26 264 L 26 132 A 6 6 0 0 1 32 126 L 50 126" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(50, 126)" class="figure-path"/>
            <g transform="translate(50, 60)" class="film-generator">
              <rect width="40" height="132" class="figure-element figure-box figure-film-generator"/>
              <text x="20" y="66" transform="rotate(-90, 20, 66)" dy="0.4em" style="text-anchor: middle;" class="figure-text">global pooling</text>
              <path d="M 40 66 L 100 66" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(100, 66)" class="figure-path"/>
            </g>
            <g transform="translate(150, 60)" class="film-generator">
              <rect width="40" height="132" class="figure-element figure-box figure-film-generator"/>
              <text x="20" y="66" transform="rotate(-90, 20, 66)" dy="0.4em" style="text-anchor: middle;" class="figure-text">linear</text>
              <path d="M 40 66 L 100 66" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(100, 66)" class="figure-path"/>
            </g>
            <g transform="translate(250, 60)" class="film-generator">
              <rect width="40" height="132" class="figure-element figure-box figure-film-generator"/>
              <text x="20" y="66" transform="rotate(-90, 20, 66)" dy="0.4em" style="text-anchor: middle;" class="figure-text">ReLU</text>
              <path d="M 40 66 L 100 66" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(100, 66)" class="figure-path"/>
            </g>
            <g transform="translate(350, 60)" class="film-generator">
              <rect width="40" height="132" class="figure-element figure-box figure-film-generator"/>
              <text x="20" y="66" transform="rotate(-90, 20, 66)" dy="0.4em" style="text-anchor: middle;" class="figure-text">linear</text>
              <path d="M 40 66 L 100 66" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(100, 66)" class="figure-path"/>
            </g>
            <g transform="translate(470, 126)" class="film-generator">
              <ellipse rx="20" ry="20" class="figure-element figure-film-generator"/>
              <text x="0" y="0" dy="0.4em" style="text-anchor: middle;" class="figure-text">σ</text>
            </g>
            <path d="M -20 270 L 450 270" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(450, 270)" class="figure-path"/>
            <path d="M 470 146 L 470 250" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(470, 250)" class="figure-path"/>
            <g transform="translate(470, 270)" class="film-layer">
              <ellipse rx="20" ry="20" class="figure-element figure-film-layer"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
              <text x="0" y="30" dy="0.4em" style="text-anchor: middle;" class="figure-text film-layer-text"> </text>
            </g>
            <path d="M 490 270 L 570 270" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(570, 270)" class="figure-path"/>
            <text x="200" y="50" class="figure-text film-generator-text"> </text>
          </g>
        </svg>
        <figcaption>
          The squeeze-and-excitation block implements a self-conditioned
          feature-wise sigmoidal gating operation.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#squeeze-diagram > svg");
            svg.selectAll("g.film-generator")
                .on("mouseenter", function () {
                    svg.select("text.film-generator-text").text("FiLM generator");
                    svg.selectAll("g.film-generator > .figure-film-generator").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("text.film-generator-text").text("");
                    svg.selectAll("g.film-generator > .figure-film-generator").style("fill", null);
                });

            svg.select("g.film-layer")
                .on("mouseenter", function () {
                    svg.select("text.film-layer-text").text("FiLM layer");
                    svg.selectAll("g.film-layer > .figure-film-layer").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    svg.select("text.film-layer-text").text("");
                    svg.selectAll("g.film-layer > .figure-film-layer").style("fill", null);
                });

            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    svg.select("g.filmed-network > text").text("FiLM-ed layer");
                    svg.selectAll("g.filmed-network > .figure-filmed-network").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    svg.select("g.filmed-network > text").text("squeeze-and-excitation-block");
                    svg.selectAll("g.filmed-network > .figure-filmed-network").style("fill", null);
                });
        })();
      </script>
      <p>
        In the natural language domain, <dt-cite key="dauphin2017language"></dt-cite>
        proposes to build a finite context using stacked convolutions to tackle
        language modeling and introduces gated linear units, which uses half of
        the features to apply feature-wise sigmoidal gating to the second half.
        This architectural feature is also adopted by
        <dt-cite key="gehring2017convolutional"></dt-cite>, which introduces a
        fast and parallelizable model for machine translation in the form of a
        purely convolutional architecture.
      </p>
      <figure class="l-body-outset" id="convseq2seq-diagram">
        <svg viewBox="0 0 744 370" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g transform="translate(200, 10)" class="style-transfer-network">
            <rect width="340" height="350" class="figure-group figure-box"/>
            <text x="10" y="20" dy="0.4em" class="figure-text">gated linear unit</text>
            <g transform="translate(20, 40)">
              <rect width="60" height="294" class="figure-element figure-box"/>
              <path d="M -60 147 L 0 147" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(0, 147)" class="figure-path"/>
              <g transform="translate(10, 10)" class="film-generator">
                <rect width="40" height="132" class="figure-element figure-box figure-film-generator"/>
                <text x="20" y="66" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 66)" class="figure-text">feature subset B</text>
              </g>
              <g transform="translate(10, 152)" class="filmed-network">
                <rect width="40" height="132" class="figure-element figure-box figure-filmed-network"/>
                <text x="20" y="66" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 66)" class="figure-text">feature subset A</text>
              </g>
            </g>
            <path d="M 70 116 L 228 116" style="stroke: #f44336;" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(228, 116)" style="stroke: #f44336; fill: #f44336;"class="figure-path"/>
            <text x="149" y="110" style="text-anchor: middle;" class="figure-text film-generator-text"> </text>
            <g transform="translate(248, 116)" class="film-generator">
              <ellipse rx="20" ry="20" class="figure-element figure-film-generator"/>
              <text x="0" y="0" dy="0.4em" style="text-anchor: middle;" class="figure-text">σ</text>
            </g>
            <path d="M 70 258 L 228 258" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(228, 258)" class="figure-path"/>
            <path d="M 248 136 L 248 238" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(248, 238)" class="figure-path"/>
            <g transform="translate(248, 258)" class="film-layer">
              <ellipse cx="0" cy="0" rx="20" ry="20" class="figure-element figure-film-layer"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <path d="M 268 258 L 360 258" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(360, 258)" class="figure-path"/>
          </g>
        </svg>
        <figcaption>
          Gated linear unit activation function <dt-cite key="dauphin2017language"></dt-cite>.
          Half of the features are used to apply feature-wise sigmoidal gating
          to the second half of the features.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#convseq2seq-diagram > svg");
            svg.selectAll("g.film-generator")
                .on("mouseenter", function () {
                    svg.select("text.film-generator-text").text("FiLM generator");
                    svg.selectAll("g.film-generator > .figure-film-generator").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("text.film-generator-text").text("");
                    svg.selectAll("g.film-generator > .figure-film-generator").style("fill", null);
                });
            svg.select("g.film-layer")
                .on("mouseenter", function () {
                    d3.select(this).select("g.film-layer > text").text("FiLM layer");
                    svg.selectAll("g.film-layer > .figure-film-layer").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    d3.select(this).select("g.film-layer > text").text("");
                    svg.selectAll("g.film-layer > .figure-film-layer").style("fill", null);
                });

            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    d3.select(this).select("g.filmed-network > text").text("FiLM-ed layer");
                    svg.selectAll("g.filmed-network > .figure-filmed-network").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    d3.select(this).select("g.filmed-network > text").text("feature subset A");
                    svg.selectAll("g.filmed-network > .figure-filmed-network").style("fill", null);
                });
        })();
      </script>
      <p>
        The LSTM <dt-cite key="hochreiter1997long"></dt-cite> architecture,
        which is itself a building block in some of the models we referenced
        thus far, makes heavy use of feature-wise sigmoidal gating in its input,
        forget, and output gates.
      </p>
      <p>
        Finally, in addition to conditional biasing,
        PixelCNN <dt-cite key="oord2016conditional"></dt-cite> and
        WaveNet <dt-cite key="oord2016wavenet"></dt-cite> both employ a
        self-conditioned tanh-sigmoid gated nonlinearity.
      </p>
      <p>
        Some work even combines attention and feature-wise transformations. Work
        in <dt-cite key="shen2017disan"></dt-cite> proposes a feature-wise
        self-attention mechanism for language understanding, showing strong
        results on datasets such as SNLI <dt-cite key="bowman2015large"></dt-cite>.
        A core idea behind the proposed model, named Directional Self-Attention
        Network (DiSAN), is that of multi-dimensional attention, i.e., combining
        tokens at a <em>feature</em> level rather than at a <em>feature vector</em>
        level, using the input itself to generate the feature-wise attention
        distributions over all tokens.
      </p>
      <figure class="l-body-outset" id="disan-diagram">
        <svg viewBox="0 0 744 440" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g transform="translate(10, 10)">
            <g transform="translate(60, 170)">
              <rect width="460" height="240" class="figure-group figure-box"/>
              <text x="10" y="20" dy="0.4em" class="figure-text">multi-dimensional attention</text>
            </g>
            <g transform="translate(220, 40)">
              <text x="90" y="-15" dy="0.4em" style="text-anchor: middle;" class="figure-text">query representation</text>
              <g transform="translate(0, 90)">
                <use xlink:href="#bigger-curly-brace-horizontal" transform="rotate(180, 90, 0)" class="figure-line"/>
              </g>
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
              <use xlink:href="#column-top" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(40, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(40, 60)" class="figure-element"/>
              <use xlink:href="#column-top" transform="translate(80, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(80, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(80, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(80, 60)" class="figure-element"/>
              <use xlink:href="#column-top" transform="translate(120, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(120, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(120, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(120, 60)" class="figure-element"/>
              <use xlink:href="#column-top" transform="translate(160, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(160, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(160, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(160, 60)" class="figure-element"/>
            </g>
            <g transform="translate(10, 280)">
              <text x="-12" y="40" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, -12, 40)" class="figure-text">doc. repr. token</text>
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
            </g>
            <path d="M 35 320 L 430 320" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(430, 320)" class="figure-path"/>
            <path d="M 35 320 L 304 320 A 6 6 0 0 0 310 314 L 310 260" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(310, 260)" class="figure-path"/>
            <g transform="translate(230, 200)">
              <rect width="160" height="60" class="figure-element figure-box"/>
              <text x="80" y="30" dy="0.4em" style="text-anchor: middle;" class="figure-text">soft attention</text>
            </g>
            <path d="M 310 200 L 310 155" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(310, 200)" class="figure-path"/>
            <path d="M 390 230 L 425 230" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(425, 230)" class="figure-path"/>
            <g transform="translate(430, 190)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
            </g>
            <path d="M 440 270 L 440 310" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(440, 310)" class="figure-path"/>
            <g transform="translate(440, 320)">
              <circle r="10" class="figure-element"/>
              <circle r="2" class="figure-path"/>
            </g>
            <path d="M 450 320 L 550 320" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(550, 320)" class="figure-path"/>
          </g>
        </svg>
        <figcaption>
          Multi-dimensional attention. The document representation token is
          used to extract a token-specific query representation using soft
          attention, and the two are multiplied element-wise.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#disan-diagram > svg");
            svg.selectAll("g.film-generator")
                .on("mouseenter", function () {
                    svg.select("text.film-generator-text").text("FiLM generator");
                    svg.selectAll("g.film-generator > .figure-film-generator").style("fill", "#ef9a9a");
                })
                .on("mouseleave", function () {
                    svg.select("text.film-generator-text").text("");
                    svg.selectAll("g.film-generator > .figure-film-generator").style("fill", null);
                });

            svg.select("g.film-layer")
                .on("mouseenter", function () {
                    svg.select("text.film-layer-text").text("FiLM layer");
                    svg.selectAll("g.film-layer > .figure-film-layer").style("fill", "#ffcc80");
                })
                .on("mouseleave", function () {
                    svg.select("text.film-layer-text").text("");
                    svg.selectAll("g.film-layer > .figure-film-layer").style("fill", null);
                });

            svg.select("g.filmed-network")
                .on("mouseenter", function () {
                    svg.select("g.filmed-network > text").text("FiLM-ed layer");
                    svg.selectAll("g.filmed-network > .figure-filmed-network").style("fill", "#90caf9");
                })
                .on("mouseleave", function () {
                    svg.select("g.filmed-network > text").text("squeeze-and-excitation-block");
                    svg.selectAll("g.filmed-network > .figure-filmed-network").style("fill", null);
                });
        })();
      </script>

      <hr />

      <h1 id="understanding-film">A take on understanding FiLM-ed networks</h1>
      <p>
        If you are like us, you probably find the success of feature-wise
        transformations intriguing given how simple they are. In this section,
        we would like to examine empirical observations we have made while
        carrying out some of the work presented above which we think may paint a
        picture explaining <em>how</em> feature-wise transformations are able to
        succeed in drastically modulating neural networks.
      </p>
      <p>
        Before we begin, a word of caution: these observations are far from
        complete. We consider only <em>one</em> family of feature-wise
        transformations &mdash; FiLM-related methods &mdash; and <em>two</em>
        problem settings &mdash; visual reasoning and style transfer. The extent
        to which these observations extrapolate to other feature-wise
        transformation families (e.g., sigmoidal gating) has yet to be verified.
        Furthermore, although we think the hypothesis we are about to propose
        explains our observations fairly well, we still feel like further
        experiments and analysis would be necessary before we feel comfortable
        strongly defending it.
      </p>
      <p>
        With the warning out of the way, let us consider two FiLM-ed networks
        trained in fairly different problem settings: the visual reasoning model
        presented in <dt-cite key="perez2017film"></dt-cite> and the style
        transfer model presented in <dt-cite key="ghiasi2017exploring"></dt-cite>.
        Both models feature a well-defined FiLM generator: a linguistic pipeline
        mapping from textual query to FiLM parameters for the former, and a CNN
        mapping from style image to FiLM parameters for the latter. Both models
        also implement fairly standard FiLM-ed networks: a CNN mapping from
        image to query answer for the former, and a CNN mapping from content
        image to stylized image for the latter.
      </p>

      <h2>FiLM parameter distribution</h2>
      <p>
        As a first step, let's examine what values the scaling and shifting
        coefficients <dt-math>\gamma</dt-math> and <dt-math>\beta</dt-math>
        take. In the figure below we plotted the <dt-math>\gamma</dt-math> and
        <dt-math>\beta</dt-math> histograms across all validation set
        image-question pairs &mdash; that is, for each image-question pair in
        the validation set, we extracted the predicted <dt-math>\gamma</dt-math>
        and <dt-math>\beta</dt-math> coefficients for all FiLM layers by running
        the linguistic pipeline on the input, and we built two histograms, one
        for the <dt-math>\gamma</dt-math> values and one for the
        <dt-math>\beta</dt-math> values.
      </p>
      <figure class="l-body-outset" id="marginal-histograms">
        <svg viewBox="0 0 744 280" xmlns="http://www.w3.org/2000/svg">
          <rect x="10" y="10" width="350" height="260" style="fill: none;" class="gamma-plot"/>
          <rect x="384" y="10" width="350" height="260" style="fill: none;" class="beta-plot"/>
        </svg>
        <figcaption>
            The predicted FiLM parameters for the visual reasoning model trained
            on the CLEVR task exhibit an interesting value distribution: the
            scaling parameters are sharply peaked at <dt-math>\gamma = 0</dt-math>
            and the shifting parameters have a lot of mass in the
            <dt-math>\beta < 0</dt-math> area.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#marginal-histograms > svg");
            var dataset;
            d3.json("assets/film_clevr.json", function(data) {
                dataset = data;
                var classes = [".gamma-plot", ".beta-plot"];

                [dataset.marginal_gammas_histogram,
                 dataset.marginal_betas_histogram].forEach(function(datum, i) {
                    var plot = svg.select(classes[i]);
                    var xMin = 20 + parseInt(plot.attr("x"));
                    var xMax = xMin + parseInt(plot.attr("width")) - 20;
                    var yMin = parseInt(plot.attr("y"));
                    var yMax = yMin + parseInt(plot.attr("height")) - 20;

                    var xScale = d3.scaleLinear()
                        .domain([d3.min(datum, function (d) { return d.x; }),
                                 d3.max(datum, function (d) { return d.x; })])
                        .rangeRound([xMin, xMax]);
                    var yScale = d3.scaleLinear()
                        .domain([d3.min(datum, function (d) { return d.y; }),
                                 d3.max(datum, function (d) { return d.y; })])
                        .rangeRound([yMax, yMin]);

                    svg.append("path")
                        .datum(datum)
                        .attr("fill", "steelblue")
                        .attr("stroke", "steelblue")
                        .attr("d", d3.area()
                            .curve(d3.curveNatural)
                            .x(function(d) { return xScale(d.x); })
                            .y0(function() { return yScale(0); })
                            .y1(function(d) { return yScale(d.y); }));

                    svg.append("g")
                        .attr("transform", "translate(0," + yMax + ")")
                        .call(d3.axisBottom(xScale));

                    svg.append("g")
                        .attr("transform", "translate(" + xMin + ",0)")
                        .call(d3.axisLeft(yScale));
                });
            });
        })();
      </script>
      <p>
        Note the sharp peak around <dt-math>\gamma = 0</dt-math> and the
        significant amount of mass in the negative range of the
        <dt-math>\beta</dt-math> histogram. Combined with the model's ReLU
        nonlinearities, this observation suggests that the model is &mdash; at
        least in part &mdash; using its FiLM layers as a switching mechanism:
        by scaling feature maps down to a near-zero value and shifting them
        into the negative range, the model can zero out entire unwanted feature
        maps. This observation also holds for the FiLM parameter distributions
        of <em>individual</em> examples. In the following figure, we show
        <dt-math>\gamma</dt-math> and <dt-math>\beta</dt-math> distributions
        for five image-question pairs chosen at random:
      </p>
      <figure class="l-body-outset" id="examplewise-histograms">
        <svg viewBox="0 0 744 280" xmlns="http://www.w3.org/2000/svg">
          <rect x="10" y="10" width="350" height="260" style="fill: none;" class="gamma-plot"/>
          <rect x="384" y="10" width="350" height="260" style="fill: none;" class="beta-plot"/>
        </svg>
        <figcaption>
          WRITEME.    
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#examplewise-histograms > svg");
            var dataset;
            d3.json("assets/film_clevr.json", function(data) {
                dataset = data;
                var classes = [".gamma-plot", ".beta-plot"];
                var colors = ["#8ed08b", "#afaed4", "#ecebf4", "#8d89c0", "#fdc692"];

                [[dataset.example_0_gammas_histogram, dataset.example_1_gammas_histogram,
                  dataset.example_2_gammas_histogram, dataset.example_3_gammas_histogram,
                  dataset.example_4_gammas_histogram],
                 [dataset.example_0_betas_histogram, dataset.example_1_betas_histogram,
                  dataset.example_2_betas_histogram, dataset.example_3_betas_histogram,
                  dataset.example_4_betas_histogram]].forEach(function(datumList, i) {
                    var plot = svg.select(classes[i]);
                    var xMin = 20 + parseInt(plot.attr("x"));
                    var xMax = xMin + parseInt(plot.attr("width")) - 20;
                    var yMin = parseInt(plot.attr("y"));
                    var yMax = yMin + parseInt(plot.attr("height")) - 20;

                    var xScale = d3.scaleLinear()
                        .domain([d3.min(datumList, function(datum) { return d3.min(datum, function (d) { return d.x; }) }),
                                 d3.max(datumList, function(datum) { return d3.max(datum, function (d) { return d.x; }) })])
                        .rangeRound([xMin, xMax]);
                    var yScale = d3.scaleLinear()
                        .domain([d3.min(datumList, function(datum) { return d3.min(datum, function (d) { return d.y; }) }),
                                 d3.max(datumList, function(datum) { return d3.max(datum, function (d) { return d.y; }) })])
                        .rangeRound([yMax, yMin]);

                    datumList.forEach(function(datum, j) {
                        svg.append("path")
                            .datum(datum)
                            .attr("fill", "none")
                            .attr("stroke", colors[j])
                            .attr("stroke-width", "1.5px")
                            .attr("d", d3.line()
                                .curve(d3.curveNatural)
                                .x(function(d) { return xScale(d.x); })
                                .y(function(d) { return yScale(d.y); }));
                    });

                    svg.append("g")
                        .attr("transform", "translate(0," + yMax + ")")
                        .call(d3.axisBottom(xScale));

                    svg.append("g")
                        .attr("transform", "translate(" + xMin + ",0)")
                        .call(d3.axisLeft(yScale));
                });
            });
        })();
      </script>

      <figure class="l-body-outset" id="gamma-beta-histogram">
        <svg viewBox="0 0 744 340" xmlns="http://www.w3.org/2000/svg">
          <rect x="30" y="10" width="300" height="300" style="fill: none;" class="histogram"/>
        </svg>
        <figcaption>
          WRITEME.    
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#gamma-beta-histogram > svg");
            var dataset;
            d3.json("assets/film_clevr.json", function(data) {
                dataset = data;
                var plot = svg.select(".histogram");
                var xMin = parseInt(plot.attr("x"));
                var xMax = xMin + parseInt(plot.attr("width"));
                var yMin = parseInt(plot.attr("y"));
                var yMax = yMin + parseInt(plot.attr("height"));

                var xScale = d3.scaleLinear()
                    .domain([d3.min(dataset.marginal_2d_histogram, function (d) { return d.x; }),
                             d3.max(dataset.marginal_2d_histogram, function (d) { return d.x; })])
                    .range([xMin, xMax]);
                var yScale = d3.scaleLinear()
                    .domain([d3.min(dataset.marginal_2d_histogram, function (d) { return d.y; }),
                             d3.max(dataset.marginal_2d_histogram, function (d) { return d.y; })])
                    .range([yMax, yMin]);
                var cScale = d3.scaleLinear()
                    .domain([d3.min(dataset.marginal_2d_histogram, function (d) { return d.z; }),
                             d3.max(dataset.marginal_2d_histogram, function (d) { return d.z; })])
                    .range(["#8ed08b", "#afaed4"]);

                svg.append("g")
                  .selectAll("circle")
                    .data(dataset.marginal_2d_histogram)
                  .enter().append("circle")
                    .attr("fill", function(d) { return cScale(d.z); })
                    .attr("opacity", "0.5")
                    .attr("r", "4px")
                    .attr("cx", function(d) { return xScale(d.x); })
                    .attr("cy", function(d) { return yScale(d.y); })

                svg.append("g")
                    .attr("transform", "translate(0," + yMax + ")")
                    .call(d3.axisBottom(xScale));

                svg.append("g")
                    .attr("transform", "translate(" + xMin + ",0)")
                    .call(d3.axisLeft(yScale));
            });
        })();
      </script>

      <h2>FiLM parameters as task embeddings</h2>
      <figure class="l-body-outset" id="clevr-tsne">
        <svg viewBox="0 0 744 500" xmlns="http://www.w3.org/2000/svg">
          <rect x="10" y="10" width="480" height="480" style="fill: none;" id="scatter-plot"/>
          <g transform="matrix(1, 0, 0, 1.000065, 10, -87.145264)" id="film-layer-6">
            <rect x="500" y="97.139" width="121.65" height="29.998" class="figure-element figure-box"/>
            <text x="603.791" y="32.789" transform="matrix(1, 0, 0, 1.000002, -77.089043, 84.380135)" class="figure-text">FiLM layer 6</text>
          </g>
          <g transform="matrix(1, 0, 0, 1.000065, 9.999977, -39.909805)" id="film-layer-5">
            <rect x="500" y="97.139" width="121.65" height="29.998" class="figure-element figure-box"/>
            <text x="603.791" y="32.789" transform="matrix(1, 0, 0, 1.000002, -77.089043, 84.380135)" class="figure-text">FiLM layer 5</text>
          </g>
          <g transform="matrix(1, 0, 0, 1.000065, 9.999977, 7.325655)" id="film-layer-4">
            <rect x="500" y="97.139" width="121.65" height="29.998" class="figure-element figure-box"/>
            <text x="603.791" y="32.789" transform="matrix(1, 0, 0, 1.000002, -77.089043, 84.380135)" class="figure-text">FiLM layer 4</text>
          </g>
          <g transform="matrix(1, 0, 0, 1.000065, 9.999977, 54.561115)" id="film-layer-3">
            <rect x="500" y="97.139" width="121.65" height="29.998" class="figure-element figure-box"/>
            <text x="603.791" y="32.789" transform="matrix(1, 0, 0, 1.000002, -77.089043, 84.380135)" class="figure-text">FiLM layer 3</text>
          </g>
          <g transform="matrix(1, 0, 0, 1.000065, 9.999977, 101.79657)" id="film-layer-2">
            <rect x="500" y="97.139" width="121.65" height="29.998" class="figure-element figure-box"/>
            <text x="603.791" y="32.789" transform="matrix(1, 0, 0, 1.000002, -77.089043, 84.380135)" class="figure-text">FiLM layer 2</text>
          </g>
          <g transform="matrix(1, 0, 0, 1.000065, 9.999977, 149.032059)" id="film-layer-1">
            <rect x="500" y="97.139" width="121.65" height="29.998" class="figure-element figure-box"/>
            <text x="603.791" y="32.789" transform="matrix(1, 0, 0, 1.000002, -77.089043, 84.380135)" class="figure-text">FiLM layer 1</text>
          </g>
        </svg>
        <figcaption>
            WRITEME.
        </figcaption>
      </figure>
      <script>
        (function() {
            var colors = ["#8ed08b", "#afaed4", "#ecebf4", "#8d89c0", "#fdc692",
                          "#fda057", "#89bedc", "#f67824", "#f44f39", "#fcaf93",
                          "#fee3c8", "#d1d2e7", "#fc8161"];

            var svg = d3.select("#clevr-tsne > svg");

            var scatterPlot = svg.select("#scatter-plot");
            var xMin = parseInt(scatterPlot.attr("x"));
            var xMax = xMin + parseInt(scatterPlot.attr("width"));
            var yMin = parseInt(scatterPlot.attr("y"));
            var yMax = yMin + parseInt(scatterPlot.attr("height"));

            var coordinates = function(d, i) {
                switch (i) {
                    case 0: return d.layer_0;
                    case 1: return d.layer_1;
                    case 2: return d.layer_2;
                    case 3: return d.layer_3;
                    case 4: return d.layer_4;
                    case 5: return d.layer_5;
                }
            }

            var dataset;
            var xScales;
            var yScales;
            d3.json("assets/clevr_res_baseline6.json", function(data) {
                dataset = data;
                xScales = [];
                yScales = [];
                for (var i = 0; i < 6; i++) {
                    xScales.push(
                        d3.scaleLinear()
                            .domain([d3.min(dataset, function (d) { return coordinates(d, i).x; }),
                                     d3.max(dataset, function (d) { return coordinates(d, i).x; })])
                            .rangeRound([xMin, xMax])
                    );
                    yScales.push(
                        d3.scaleLinear()
                            .domain([d3.min(dataset, function (d) { return coordinates(d, i).y; }),
                                     d3.max(dataset, function (d) { return coordinates(d, i).y; })])
                            .rangeRound([yMin, yMax])
                    );
                }

                svg.selectAll("circle")
                    .data(dataset)
                  .enter().append("circle")
                    .attrs({
                        "cx": function(d) { return xScales[0](d.layer_0.x); },
                        "cy": function(d) { return yScales[0](d.layer_0.y); },
                        "r": 4,
                    })
                    .style("fill", function(d) { return colors[d.question_type]; })
                    .style("opacity", 0.6)
                    .style("stroke", "#666")
                    .style("stroke-width", 1.5);
            });

            for (var k = 0; k < 6; k++) {
                svg.select("#film-layer-" + (k + 1))
                    .on("click", function () {
                        var layer = parseInt(d3.select(this).attr("id").charAt(11)) - 1;
                        svg.selectAll("circle")
                            .attrs({
                                "cx": function(d) { return xScales[layer](coordinates(d, layer).x); },
                                "cy": function(d) { return yScales[layer](coordinates(d, layer).y); }
                            });
                    });
            }
        })();
      </script>

      <hr />

      <h1 id="bilinear-connection">Connecting FiLM, gating, attention, and mixture-of-experts models</h1>
      <p>
        As previously hinted at, there exists a strong connection between FiLM,
        gating, attention, and mixture-of-experts models through bilinear
        transformations <dt-cite key="tenenbaum2000separating"></dt-cite>. In
        fact, all four approaches can be formalized using an extension of
        bilinear transformations which we propose to call <em>generalized
        bilinear transformations</em>.
      </p>
      <h2>Bilinear and generalized bilinear transformations</h2>
      <p>
        A bilinear transformation defines the relationship between two inputs
        <dt-math>\mathbf{x}</dt-math> and <dt-math>\mathbf{z}</dt-math> and the
        <dt-math>k^{th}</dt-math> output feature <dt-math>y_k</dt-math> as

        <dt-math block>
          y_k = \mathbf{x}^T W_k \mathbf{z}.
        </dt-math>

        Note that for each output feature <dt-math>y_k</dt-math> we have a
        separate matrix <dt-math>W_k</dt-math>, so the full set of weights forms
        a 3-tensor.
      </p>
      <figure class="l-body-outset" id="bilinear-diagram">
        <svg viewBox="0 0 744 340" xmlns="http://www.w3.org/2000/svg">
          <rect x="10" y="10" width="724" height="320" class="figure-group figure-box"/>
          <text x="20" y="30" class="figure-text">Bilinear transformation</text>
          <g transform="translate(92, -121)">
            <g transform="translate(15, 273)">
              <use xlink:href="#row-left" transform="translate(0, 0)"  class="figure-element"/>
              <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
            </g>
            <g transform="translate(48, 362)">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 40)" class="figure-element"/>
              <text x="30" y="75" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan></text>
            </g>
            <g transform="translate(113, 362)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <text x="10" y="75" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
            </g>
            <g transform="translate(80, 273)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <text x="25" y="30" dy="0.4em" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan></text>
            </g>
          </g>
          <g transform="translate(312, 27)">
            <g transform="translate(17, 125)">
              <use xlink:href="#row-left" transform="translate(0, 0)"  class="figure-element"/>
              <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
            </g>
            <g transform="translate(50, 214)">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 40)" class="figure-element"/>
              <text x="30" y="75" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan></text>
            </g>
            <g transform="translate(115, 214)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <text x="10" y="75" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
            </g>
            <g transform="translate(82, 125)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <text x="25" y="30" dy="0.4em" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan></text>
            </g>
          </g>
          <g transform="translate(372, 70)">
            <g transform="translate(177, 82)">
              <use xlink:href="#row-left" transform="translate(0, 0)"  class="figure-element"/>
              <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
            </g>
            <g transform="translate(209.5, 170)">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 40)" class="figure-element"/>
              <text x="30" y="75" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan></text>
            </g>
            <g transform="translate(274.5, 170)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <text x="10" y="75" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
            </g>
            <g transform="translate(242, 82)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <text x="25" y="30" dy="0.4em" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan></text>
            </g>
          </g>
          <g transform="translate(312, 20)">
            <use xlink:href="#big-row-left" transform="translate(0, 0)"  class="figure-element"/>
            <use xlink:href="#big-row-middle" transform="translate(40, 0)" class="figure-element"/>
            <use xlink:href="#big-row-right" transform="translate(80, 0)" class="figure-element"/>
            <text x="-15" y="20" dy="0.4em" dy="0.4em" style="font-weight: bold;" class="figure-text">y</text>
          </g>
          <use xlink:href="#curly-brace-horizontal" transform="translate(107, 147)" class="figure-line"/>
          <use xlink:href="#curly-brace-horizontal" transform="translate(329, 147)" class="figure-line"/>
          <use xlink:href="#curly-brace-horizontal" transform="translate(549, 147)" class="figure-line"/>
          <use xlink:href="#curly-brace-horizontal" transform="translate(140, 236)" class="figure-line"/>
          <use xlink:href="#curly-brace-horizontal" transform="translate(362, 236)" class="figure-line"/>
          <use xlink:href="#curly-brace-horizontal" transform="translate(581.5, 236)" class="figure-line"/>
          <path class="figure-line" d="M 149.5 126 C 149.5 60 342 126 332 60"/>
          <use xlink:href="#arrow-up" transform="translate(332, 60)" class="figure-path"/>
          <path class="figure-line" d="M 372 126 L 372 60"/>
          <use xlink:href="#arrow-up" transform="translate(372, 60)" class="figure-path"/>
          <path class="figure-line" d="M 591.5 126 C 591.5 60 402 126 412 60"/>
          <use xlink:href="#arrow-up" transform="translate(412, 60)" class="figure-path"/>
        </svg>
        <figcaption>
          A bilinear transformation mapping <dt-math>\mathbf{x}</dt-math> and
          <dt-math>\mathbf{z}</dt-math> &mdash; both 3-dimensional &mdash; to a
          3-dimensional output. Each output element <dt-math>y_k</dt-math> is
          computed as a vector-matrix-vector product using a separate matrix
          <dt-math>W_k</dt-math>.
        </figcaption>
      </figure>
      <p>
        In general, bilinear transformations are used to combine two inputs
        without attaching a specific meaning to the nature of those inputs. For
        the purpose of our discussion, we will consider
        <dt-math>\mathbf{x}</dt-math> to be the representation being FiLM-ed,
        gated, or attended to, and <dt-math>\mathbf{z}</dt-math> to be the
        context used to FiLM, gate, or attend to.
      <p>
        The generalized bilinear transformation we propose stretches the
        definition of a bilinear transformation in two ways:
        <ul>
          <li>
            It appends a <dt-math>1</dt-math>-valued feature to the inputs
            <dt-math>\mathbf{x}</dt-math> and <dt-math>\mathbf{z}</dt-math> to
            accommodate an eventual bias term &mdash; a common trick used to
            simplify the algebra of neural networks:
            <dt-math block>
              \begin{aligned}
                \tilde{\mathbf{x}} &= (x_0, \ldots, x_M, 1)^T, \\
                \tilde{\mathbf{z}} &= (z_0, \ldots, z_N, 1)^T.
              \end{aligned}
            </dt-math>
          </li>
          <li>
            It applies an activation function <dt-math>g_k(\cdot)</dt-math> to
            the result of the matrix-vector product:
            <dt-math block>
              y_k = \tilde{\mathbf{x}}^T g_k(W_k \tilde{\mathbf{z}}).
            </dt-math>
          </li>
        </ul>
      </p>
      <figure class="l-body-outset" id="generalized-bilinear-diagram">
        <svg viewBox="0 0 744 380" xmlns="http://www.w3.org/2000/svg">
          <rect x="10" y="10" width="724" height="360" class="figure-group figure-box"/>
          <text x="20" y="30" class="figure-text">Generalized bilinear transformation</text>
          <g transform="translate(92, -121)">
            <g transform="translate(-5, 273)">
              <use xlink:href="#row-left" transform="translate(0, 0)"  class="figure-element"/>
              <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#singleton" transform="translate(60, 0)" class="figure-element"/>
              <text x="70" y="10" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
            </g>
            <g transform="translate(38, 382)">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(60, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(60, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(00, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(60, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 60)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(60, 60)" class="figure-element"/>
              <text x="-40" y="40" class="figure-text"><tspan>g</tspan><tspan dy="0.4em" class="subscript">1</tspan></text>
              <use xlink:href="#parenthesis-left" transform="translate(-20, 0)" class="figure-line"/>
              <use xlink:href="#parenthesis-right" transform="translate(120, 0)" class="figure-line"/>
              <text x="40" y="95" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="0.4em" class="subscript">1</tspan></text>
            </g>
            <g transform="translate(123, 382)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#singleton" transform="translate(0, 60)" class="figure-element"/>
              <text x="10" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              <text x="10" y="95" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
            </g>
            <g transform="translate(80, 273)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
              <text x="25" y="40" dy="0.4em" class="figure-text"><tspan>g</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px">(W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan><tspan style="font-weight: normal;">)</tspan></text>
            </g>
          </g>
          <g transform="translate(312, 27)">
            <g transform="translate(-3, 125)">
              <use xlink:href="#row-left" transform="translate(0, 0)"  class="figure-element"/>
              <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#singleton" transform="translate(60, 0)" class="figure-element"/>
              <text x="70" y="10" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
            </g>
            <g transform="translate(40, 234)">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(60, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(60, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(00, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(60, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 60)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(60, 60)" class="figure-element"/>
              <text x="-40" y="40" class="figure-text"><tspan>g</tspan><tspan dy="0.4em" class="subscript">2</tspan></text>
              <use xlink:href="#parenthesis-left" transform="translate(-20, 0)" class="figure-line"/>
              <use xlink:href="#parenthesis-right" transform="translate(120, 0)" class="figure-line"/>
              <text x="40" y="95" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="0.4em" class="subscript">2</tspan></text>
            </g>
            <g transform="translate(125, 234)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#singleton" transform="translate(0, 60)" class="figure-element"/>
              <text x="10" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              <text x="10" y="95" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
            </g>
            <g transform="translate(82, 125)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
              <text x="25" y="40" dy="0.4em" class="figure-text"><tspan>g</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px">(W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan><tspan>)</tspan></text>
            </g>
          </g>
          <g transform="translate(372, 70)">
            <g transform="translate(157, 82)">
              <use xlink:href="#row-left" transform="translate(0, 0)"  class="figure-element"/>
              <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#singleton" transform="translate(60, 0)" class="figure-element"/>
              <text x="70" y="10" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
            </g>
            <g transform="translate(199.5, 190)">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(60, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(60, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(00, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(60, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 60)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(60, 60)" class="figure-element"/>
              <text x="-40" y="40" class="figure-text"><tspan>g</tspan><tspan dy="0.4em" class="subscript">3</tspan></text>
              <use xlink:href="#parenthesis-left" transform="translate(-20, 0)" class="figure-line"/>
              <use xlink:href="#parenthesis-right" transform="translate(120, 0)" class="figure-line"/>
              <text x="40" y="95" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="0.4em" class="subscript">3</tspan></text>
            </g>
            <g transform="translate(284.5, 190)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#singleton" transform="translate(0, 60)" class="figure-element"/>
              <text x="10" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              <text x="10" y="95" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
            </g>
            <g transform="translate(242, 82)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-element"/>
              <text x="25" y="40" dy="0.4em" class="figure-text"><tspan>g</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px">(W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan><tspan>)</tspan></text>
            </g>
          </g>
          <g transform="translate(312, 20)">
            <use xlink:href="#big-row-left" transform="translate(0, 0)"  class="figure-element"/>
            <use xlink:href="#big-row-middle" transform="translate(40, 0)" class="figure-element"/>
            <use xlink:href="#big-row-right" transform="translate(80, 0)" class="figure-element"/>
            <text x="-15" y="20" dy="0.4em" style="font-weight: bold;" class="figure-text">y</text>
          </g>
          <use xlink:href="#big-curly-brace-horizontal" transform="translate(87, 147)" class="figure-line"/>
          <use xlink:href="#big-curly-brace-horizontal" transform="translate(309, 147)" class="figure-line"/>
          <use xlink:href="#big-curly-brace-horizontal" transform="translate(529, 147)" class="figure-line"/>
          <use xlink:href="#big-curly-brace-horizontal" transform="translate(130, 256)" class="figure-line"/>
          <use xlink:href="#big-curly-brace-horizontal" transform="translate(352, 256)" class="figure-line"/>
          <use xlink:href="#big-curly-brace-horizontal" transform="translate(571.5, 256)" class="figure-line"/>
          <path class="figure-line" d="M 139.5 126 C 159.5 60 342 126 332 60"/>
          <use xlink:href="#arrow-up" transform="translate(332, 60)" class="figure-path"/>
          <path class="figure-line" d="M 361.5 126 C 361.5 80 372 106 372 60"/>
          <use xlink:href="#arrow-up" transform="translate(372, 60)" class="figure-path"/>
          <path class="figure-line" d="M 581.5 126 C 581.5 60 402 126 412 60"/>
          <use xlink:href="#arrow-up" transform="translate(412, 60)" class="figure-path"/>
        </svg>
        <figcaption>
          A generalized bilinear transformation mapping mapping the inputs
          <dt-math>\mathbf{x}</dt-math> and <dt-math>\mathbf{z}</dt-math>
          &mdash; both 3-dimensional &mdash; to a 3-dimensional output.
        </figcaption>
      </figure>
      <p>
        The choice of activation function <dt-math>g_k(\cdot)</dt-math> and the
        structure of the weight matrices <dt-math>W_k</dt-math> determines the
        nature of the transformation: FiLM, gating, or attention. Starting with
        the mathematical definition of each computation, we will now explain how
        they can be expressed in terms of generalized bilinear transformations.
        To simplify the discussion, we give the name <em>context vector</em> to
        the matrix-vector product:

        <dt-math block>
          \mathbf{v} = g_k(W_k \tilde{\mathbf{z}})
        </dt-math>
      </p>

      <h2>Connecting the dots</h2>

      <h3>FiLM as a generalized bilinear transformation</h3>
      <p>
        FiLM is represented by an equation of the form

        <dt-math block>
          y_k = \gamma_k x_k + \beta_k.
        </dt-math>

        This means that the nonlinearity should be the identity function
        <dt-math>g_k(\mathbf{u}) = \mathbf{z}</dt-math>, and the context vector
        should have the form

        <dt-math block>
          \mathbf{v} = (0, \ldots, 0, \gamma_k, 0, \ldots, 0, \beta_k)^T,
        </dt-math>

        where <dt-math>\gamma_k</dt-math> is the <dt-math>k^{th}</dt-math>
        element of the context vector. This means in turn that the weight matrix
        <dt-math>W_k</dt-math> should be low-rank and have the form

        <dt-math block>
          W_k =
          \begin{pmatrix}
             0 & 0 \\
             \vdots & \vdots \\
             0 & 0 \\
             1 & 0 \\
             0 & 0 \\
             \vdots & \vdots \\
             0 & 0 \\
             0 & 1
          \end{pmatrix}
          \begin{pmatrix}
             w_{k, 1, 1} & \cdots & w_{k, 1, N} \\
             w_{k, 2, 1} & \cdots & w_{k, 2, N}
          \end{pmatrix}.
        </dt-math>
      </p>
      <p>
      Here is an example for a 3-dimensional <dt-math>\mathbf{x}</dt-math>
      and a 2-dimensional <dt-math>\mathbf{z}</dt-math> (reminder: this means
      a 4-dimensional <dt-math>\tilde{\mathbf{x}}</dt-math> and a 3-dimensional
      <dt-math>\tilde{\mathbf{z}}</dt-math>):
      </p>
      <figure class="l-body-outset" id="film-as-bilinear-diagram">
        <svg viewBox="0 0 744 110" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(-52, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(20, 60)" class="figure-element"/>
            </g>
            <g transform="translate(140, 69)" id="w-1">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 20)" class="figure-element"/>
            </g>
            <text x="205" y="93" class="figure-text">=</text>
            <g transform="translate(218, 49)" id="w-1-full">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element"/>
            </g>
          </g>
          <g transform="translate(202, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-top-right" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(20, 60)" class="figure-element"/>
            </g>
            <g transform="translate(140, 69)" id="w-2">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 20)" class="figure-element"/>
            </g>
            <text x="205" y="93" class="figure-text">=</text>
            <g transform="translate(218, 49)" id="w-2-full">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element"/>
            </g>
          </g>
          <g transform="translate(456, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-top-right" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(20, 60)" class="figure-element"/>
            </g>
            <g transform="translate(140, 69)" id="w-3">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 20)" class="figure-element"/>
            </g>
            <text x="205" y="93" class="figure-text">=</text>
            <g transform="translate(218, 49)" id="w-3-full">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element"/>
            </g>
          </g>
        </svg>
        <figcaption>
          Generalized bilinear weight matrices for a FiLM layer applied on a
          3-dimensional input <dt-math>\mathbf{x}</dt-math> within the context
          of a 2-dimensional <dt-math>\mathbf{z}</dt-math>. Grey elements
          have value <dt-math>0</dt-math>, white elements have value
          <dt-math>1</dt-math>, and color elements have arbitrary values.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#film-as-bilinear-diagram > svg");
            var dataW1 = [];
            var dataW2 = [];
            var dataW3 = [];
            for(var i = 0; i < 6; i++) {
                dataW1.push(Math.random() * 360);
                dataW2.push(Math.random() * 360);
                dataW3.push(Math.random() * 360);
            }
            svg.select("#w-1")
              .selectAll("use")
                .data(dataW1)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-1-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(dataW1)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-2")
              .selectAll("use")
                .data(dataW2)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-2-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(dataW2)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-3")
              .selectAll("use")
                .data(dataW3)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-3-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(dataW3)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
        })();
      </script>

      <h3>Gating as a generalized bilinear transformation</h3>
      <p>
        As explained earlier in the article, feature-wise gating layers can be
        seen as bias-less FiLM layers with sigmoidal scaling. Representing
        them as a generalized bilinear transformation is a straightforward
        adaptation with respect to FiLM. Feature-wise gating is represented by
        an equation of the form

        <dt-math block>
          y_k = \alpha_k x_k, \quad \alpha_k \in [0, 1].
        </dt-math>

        This means that the context vector should have the form

        <dt-math block>
          \mathbf{v} = (0, \ldots, 0, \alpha_k, 0, \ldots, 0, 0)^T,
        </dt-math>

        which is achieved through a combination of a "one-hot sigmoid"
        nonlinearity

        <dt-math block>
          g(\mathbf{u}) = (u_0, \ldots, u_{k-1}, \sigma(u_k), u_{k+1}, \ldots, u_{N})^T,
        </dt-math>

        and a low-rank weight matrix <dt-math>W_k</dt-math> of the form

        <dt-math block>
          W_k =
          \begin{pmatrix}
             0 \\
             \vdots \\
             0 \\
             1 \\
             0 \\
             \vdots \\
             0
          \end{pmatrix}
          \begin{pmatrix}
             w_{k, 1} & \cdots & w_{k, N}
          \end{pmatrix}.
        </dt-math>
      </p>
      <p>
      Here is an example for a 3-dimensional <dt-math>\mathbf{x}</dt-math>
      and a 2-dimensional <dt-math>\mathbf{z}</dt-math> (reminder: this means
      a 4-dimensional <dt-math>\tilde{\mathbf{x}}</dt-math> and a 3-dimensional
      <dt-math>\tilde{\mathbf{z}}</dt-math>):
      </p>
      <figure class="l-body-outset" id="gating-as-bilinear-diagram">
        <svg viewBox="0 0 744 110" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(-52, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-element figure-faded"/>
            </g>
            <g transform="translate(120, 79)" id="w-1">
              <use xlink:href="#row-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-element"/>
            </g>
            <text x="185" y="93" class="figure-text">=</text>
            <g transform="translate(198, 49)" id="w-1-full">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
          <g transform="translate(202, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-element figure-faded"/>
            </g>
            <g transform="translate(120, 79)" id="w-2">
              <use xlink:href="#row-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-element"/>
            </g>
            <text x="185" y="93" class="figure-text">=</text>
            <g transform="translate(198, 49)" id="w-2-full">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
          <g transform="translate(456, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-element figure-faded"/>
            </g>
            <g transform="translate(120, 79)" id="w-3">
              <use xlink:href="#row-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-element"/>
            </g>
            <text x="185" y="93" class="figure-text">=</text>
            <g transform="translate(198, 49)" id="w-3-full">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
        </svg>
        <figcaption>
          Generalized bilinear weight matrices for a gating layer applied on a
          3-dimensional input <dt-math>\mathbf{x}</dt-math> within the context
          of a 2-dimensional <dt-math>\mathbf{z}</dt-math>. Grey elements
          have value <dt-math>0</dt-math>, white elements have value
          <dt-math>1</dt-math>, and color elements have arbitrary values.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#gating-as-bilinear-diagram > svg");
            var dataW1 = [];
            var dataW2 = [];
            var dataW3 = [];
            for(var i = 0; i < 3; i++) {
                dataW1.push(Math.random() * 360);
                dataW2.push(Math.random() * 360);
                dataW3.push(Math.random() * 360);
            }
            svg.select("#w-1")
              .selectAll("use")
                .data(dataW1)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-1-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(dataW1)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-2")
              .selectAll("use")
                .data(dataW2)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-2-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(dataW2)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-3")
              .selectAll("use")
                .data(dataW3)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-3-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(dataW3)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
        })();
      </script>

      <h3>Attention as a generalized bilinear transformation</h3>
      <p>
        <a href="https://distill.pub/2016/augmented-rnns/">Attention</a> is
        applied to a set of feature vectors at different spatial or temporal
        locations <dt-math>t \in [1, \cdots, T]</dt-math> by computing from
        internal or external conditioning information an <em>attention distribution</em>

        <dt-math block>
            \mathbf{p} = (p_1, \cdots, p_T)^T, \quad p^t > 0, \quad \sum_{t=1}^T p^t = 1.
        </dt-math>

        Assuming a feature matrix <dt-math>X</dt-math> in which columns
        represent feature vectors at different spatial or temporal locations
        (<em>N.B.: this is a somewhat unusual way of organizing a sequence of
        feature vectors</em>), the output of the attentional interface is
        computed as the expected feature vector over the attention distribution:

        <dt-math block>
            \mathbf{y} = X \mathbf{p}.
        </dt-math>
      <p>
        Attention is closely related to gating in the generalized bilinear
        formulation, save from one crucial detail: because it implements a
        weighted sum over spatial or temporal locations, elements of the
        vector <dt-math>\mathbf{x}</dt-math> represent <em>the same feature
        at different spatial or temporal locations</em> rather than different
        features. It is represented by an equation of the form

        <dt-math block>
          y_k = \sum_{t=1}^T X_{k,t} p_t.
        </dt-math>

        This means that the context vector should have the form

        <dt-math block>
          \mathbf{v} = (p_1, \ldots, p_T, 0)^T,
        </dt-math>

        which is achieved through a combination of an "all-but-last softmax"
        nonlinearity

        <dt-math block>
          g(\mathbf{u}) = (\textrm{softmax}(\mathbf{u}_{1:T-1}), 0)^T,
        </dt-math>

        and a full-rank weight matrix <dt-math>W_k</dt-math>. Because the same
        weighted sum is applied to all features over spatial or temporal
        locations, matrices <dt-math>W_k</dt-math> are tied.
      </p>
      <figure class="l-body-outset" id="attention-as-bilinear-diagram">
        <svg viewBox="0 0 744 110" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(-52, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)" id="w-1-full">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
          <g transform="translate(202, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)" id="w-2-full">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
          <g transform="translate(456, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)" id="w-3-full">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
        </svg>
        <figcaption>
          The generalized bilinear weight matrices for an attention layer are
          tied. Grey elements have value <dt-math>0</dt-math>, and color
          elements have arbitrary values.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#attention-as-bilinear-diagram > svg");
            var data = [];
            for(var i = 0; i < 9; i++) { data.push(Math.random() * 360); }
            svg.select("#w-1-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(data)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-2-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(data)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-3-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(data)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
        })();
      </script>

      <h3>Mixture-of-experts as a generalized bilinear transformation</h3>
      <p>
        Work on mixture-of-experts models
        <dt-cite key="jacobs1991adaptive,jordan1994hierarchical,eigen2014deep,shazeer2017outrageously"></dt-cite>
        examines a framework in which the feature vectors output by several
        expert sub-networks are combined according to a mixture distribution
        which is itself computed from the experts' inputs.
      </p>
      <figure class="l-body-outset" id="moe-diagram">
        <svg viewBox="0 0 744 470" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(306, 430)">
            <rect width="132" height="30" class="figure-element figure-box"/>
            <text x="66" y="15" dy="0.4em" style="text-anchor: middle;" class="figure-text">input</text>
            <path d="M 66 0 L 66 -14 A 6 6 0 0 0 60 -20 L -169 -20 A 6 6 0 0 1 -175 -26 L -175 -40" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(-175, -40)" class="figure-path"/>
            <path d="M 66 0 L 66 -14 A 6 6 0 0 0 60 -20 L -5 -20 A 6 6 0 0 1 -11 -26 L -11 -40" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(-11, -40)" class="figure-path"/>
            <path d="M 66 0 L 66 -14 A 6 6 0 0 1 72 -20 L 147 -20 A 6 6 0 0 0 153 -26 L 153 -40" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(153, -40)" class="figure-path"/>
            <path d="M 66 0 L 66 -14 A 6 6 0 0 1 72 -20 L 311 -20 A 6 6 0 0 0 317 -26 L 317 -40" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(317, -40)" class="figure-path"/>
          </g>
          <g transform="translate(65, 270)">
            <rect width="132" height="120" class="figure-group figure-box"/>
            <text x="66" y="60" dy="0.4em" style="text-anchor: middle;" class="figure-text">gating network</text>
            <path d="M 66 0 L 66 -30" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(66, -30)" class="figure-path"/>
          </g>
          <g transform="translate(65, 210)">
            <rect width="132" height="30" class="figure-element figure-box"/>
            <text x="66" y="15" dy="0.4em" style="text-anchor: middle;" class="figure-text">softmax</text>
            <path d="M 36 0 L 36 -89 A 6 6 0 0 1 42 -94 L 543 -94" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(543, -94)" class="figure-path"/>
            <path d="M 66 0 L 66 -59 A 6 6 0 0 1 72 -65 L 379 -65" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(379, -65)" class="figure-path"/>
            <path d="M 96 0 L 96 -29 A 6 6 0 0 1 102 -35 L 215 -35" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(215, -35)" class="figure-path"/>
          </g>
          <g transform="translate(229, 220)">
            <rect width="132" height="170" class="figure-group figure-box"/>
            <text x="66" y="85" dy="0.4em" style="text-anchor: middle;" class="figure-text">expert network 1</text>
            <path d="M 66 0 L 66 -30" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(66, -30)" class="figure-path"/>
          </g>
          <g transform="translate(393, 220)">
            <rect width="132" height="170" class="figure-group figure-box"/>
            <text x="66" y="85" dy="0.4em" style="text-anchor: middle;" class="figure-text">expert network 2</text>
            <path d="M 66 0 L 66 -60" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(66, -60)" class="figure-path"/>
          </g>
          <g transform="translate(557, 220)">
            <rect width="132" height="170" class="figure-group figure-box"/>
            <text x="66" y="85" dy="0.4em" style="text-anchor: middle;" class="figure-text">expert network 3</text>
            <path d="M 66 0 L 66 -90" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(66, -90)" class="figure-path"/>
          </g>
          <g transform="translate(295, 175)">
            <ellipse cx="0" cy="0" rx="15" ry="15" class="figure-element"/>
            <ellipse rx="2" ry="2" class="figure-path"/>
            <path d="M 0 -15 L 0 -124 A 6 6 0 0 1 6 -130 L 149 -130" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(149, -130)" class="figure-path"/>
          </g>
          <g transform="translate(459, 145)">
            <ellipse cx="0" cy="0" rx="15" ry="15" class="figure-element"/>
            <ellipse rx="2" ry="2" class="figure-path"/>
            <path d="M 0 -15 L 0 -85" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(0, -85)" class="figure-path"/>
          </g>
          <g transform="translate(623, 115)">
            <ellipse cx="0" cy="0" rx="15" ry="15" class="figure-element"/>
            <ellipse rx="2" ry="2" class="figure-path"/>
            <path d="M 0 -15 L 0 -64 A 6 6 0 0 0 -6 -70 L -149 -70" class="figure-line"/>
            <use xlink:href="#arrow-left" transform="translate(-149, -70)" class="figure-path"/>
          </g>
          <g transform="translate(459, 45)">
            <ellipse cx="0" cy="0" rx="15" ry="15" class="figure-element"/>
            <line x1="0" y1="5" x2="0" y2="-5" class="figure-line"/>
            <line x1="-5" y1="0" x2="5" y2="0" class="figure-line"/>
            <path d="M 0 -15 L 0 -45" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(0, -45)" class="figure-path"/>
          </g>
        </svg>
        <figcaption>
            Mixture-of-experts model. The model's output is computed as a
            weighted sum of each expert's feature vector output as predicted
            by the gating network's mixture distribution output.
        </figcaption>
      </figure>
      <p>
        There is a strong connection between mixture-of-experts models and
        attention: the former can be viewed as attention over the experts'
        outputs rather than over time or space. As such, mixture-of-experts
        models can be represented as generalized bilinear transformations in the
        same way attention is, the only difference being that the columns of
        <dt-math>X</dt-math> represent experts rather than spatial or temporal
        locations.
      </p>
      <figure class="l-body-outset" id="moe-as-bilinear-diagram">
        <svg viewBox="0 0 744 110" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(-52, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)" id="w-1-full">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
          <g transform="translate(202, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)" id="w-2-full">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
          <g transform="translate(456, -39)">
            <text x="62" y="93" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px"> =</tspan></text>
            <g transform="translate(95, 49)" id="w-3-full">
              <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-element"/>
              <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-element"/>
              <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-element"/>
              <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-element figure-faded"/>
              <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-element figure-faded"/>
            </g>
          </g>
        </svg>
        <figcaption>
          Just like with attention, the generalized bilinear weight matrices for
          a mixture-of-experts model are tied. Grey elements have value
          <dt-math>0</dt-math>, and color elements have arbitrary values.
        </figcaption>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#moe-as-bilinear-diagram > svg");
            var data = [];
            for(var i = 0; i < 9; i++) { data.push(Math.random() * 360); }
            svg.select("#w-1-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(data)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-2-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(data)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
            svg.select("#w-3-full")
              .selectAll("use")
                .filter(function() {
                   return !this.classList.contains('figure-faded')
                 })
                .data(data)
                .style("fill", function(d) { return "hsl(" + d + ",50%,50%)"; });
        })();
      </script>

      <hr />

      <h1>Conclusion</h1>
      <p>
        This article had quite a lot of ground to cover. We set out to better
        understand feature-wise transformations in the context of fusing
        multiple sources of information in a neural network. We examined
        several approaches which are encompassed by the FiLM formulation, and
        reviewed their use in the literature. We then set out to connect
        feature-wise transformations with related families of approaches
        such as attention and mixture-of-experts models via bilinear
        transformations.
      </p>
      <p>
        We hope that the recognition of the wide range of applications
        feature-wise transformations find in the literature will stimulate
        research into applying them to even more problem settings. For
        instance, most of the work we referenced operates from a "conditioning"
        perspective in which the processing of a primary source of information
        is conditioned on a secondary source of information (e.g., in
        <dt-cite key="perez2017film"></dt-cite> the image processing pipeline
        is conditioned on the linguistic pipeline). This distinction gets
        blurrier as we move towards problems like the movie scene recognition
        problem introduced at the very beginning of this article: there is no
        preferred conditioning relationship between video and audio. To the
        best of our knowledge, most approaches to solving a problem like this
        involve the use of modality-specific pipelines (e.g., separate video
        and audio pipelines) followed by some simple form of interaction (like
        concatenation) between the extracted representations. What the work we
        presented in this article tells us is that we may benefit from having
        those modalities interact in simple ways in more than one place along
        the computation of the model's output.
      </p>
      <p>
        Finally, we also hope that the connections drawn with bilinear
        transformations will help fuel new ideas for fusing multiple sources of
        information in neural networks. Feature-wise transformations are just a
        fraction of all possible transformations that can be represented by
        (generalized) bilinear transformations, and it is still unclear to us
        where the best compromise lies between flexibility and low
        computational cost on the spectrum spanning full-rank bilinear
        transformations and low-rank bilinear transformation (like FiLM).
        Furthermore, in the spirit of making as few architectural assumptions
        as possible and letting the model learn as much as it can, we are
        curious to see what happens when the model is allowed to learn the
        low-rank structure of the weight matrices and the activation function
        of the generalized bilinear transformations. It could be that the model
        would learn something very close to FiLM, gating, attention, or
        mixture-of-experts &mdash; which would be an interesting observation in
        its own right &mdash; or it could also be that the model learns a new
        form of interaction between modalities altogether.
      </p>
    </dt-article>

    <dt-appendix>
      <h3>Acknowledgements</h3>
      <p>
        This article would be nowhere near where it is today without the honest
        and constructive feedback we received from various people across
        several organizations. We would like to thank Archy de Berker, Pedro
        Oliveira Pinheiro, Alexei Nordell-Markovits, Masha Krol, and Minh Dao
        from Element AI. We would also like to thank Dzmitry Bahdanau from MILA, Oliver Pietquin from DeepMind and Jérémie Mary from Criteo.
      </p>
    </dt-appendix>

    <script type="text/bibliography">
      @inproceedings{vries2017modulating,
        author={de Vries, Harm and Strub, Florian and Mary, J\'{e}r\'{e}mie and
                Larochelle, Hugo and Pietquin, Olivier and Courville, Aaron},
        title={Modulating early visual processing by language},
        booktitle={Advances in Neural Information Processing Systems},
        year={2017},
        url={https://arxiv.org/pdf/1707.00683.pdf},
      }
      @inproceedings{vries2017guesswhat,
        title={GuessWhat?! Visual object discovery through multi-modal dialogue},
        author={de Vries, Harm and Strub, Florian and Chandar, Sarath and
                Pietquin, Olivier and Larochelle, Hugo and Courville, Aaron},
        booktitle={Proceedings of the Conference on Computer Vision and Pattern
                   Recognition},
        year={2017}
      }
      @inproceedings{perez2017learning,
        author={Perez, Ethan and de Vries, Harm and Strub, Florian and Dumoulin,
                Vincent and Courville, Aaron},
        title={Learning visual reasoning without strong priors},
        booktitle={ICML Workshop on Machine Learning in Speech and Language Processing},
        year={2017},
        url={https://arxiv.org/pdf/1707.03017.pdf},
      }
      @inproceedings{perez2017film,
        author={Perez, Ethan and de Vries, Harm and Strub, Florian and Dumoulin,
                Vincent and Courville, Aaron},
        title={FiLM: Visual Reasoning with a General Conditioning Layer},
        booktitle={arXiv},
        year={2017},
        url={https://arxiv.org/pdf/1709.07871.pdf},
      }
      @inproceedings{johnson2017clevr,
        author={Johnson, Justin and Li, Fei-Fei and Hariharan, Bharath and Zitnick,
                Lawrence C. and van der Maaten, Laurens and Girshick, Ross},
        title={FiLM: Visual Reasoning with a General Conditioning Layer},
        booktitle={Proceedings of the Conference on Computer Vision and Pattern Recognition},
        year={2017},
        url={https://arxiv.org/pdf/1612.06890.pdf},
      }
      @inproceedings{dumoulin2017learned,
        author={Dumoulin, Vincent and Shlens, Jonathon and Kudlur, Manjunath},
        title={A Learned Representation for Artistic Style},
        booktitle={Proceedings of the International Conference on Learning Representations},
        year={2017},
        url={https://arxiv.org/pdf/1610.07629.pdf},
      }
      @inproceedings{ghiasi2017exploring,
        author={Ghiasi, Golnaz and Lee, Honglak and Kudlur, Manjunath and
                Dumoulin, Vincent and Shlens, Jonathon},
        title={Exploring the structure of a real-time, arbitrary neural artistic
               stylization network},
        booktitle={Proceedings of the British Machine Vision Conference},
        year={2017},
        url={https://arxiv.org/pdf/1705.06830.pdf},
      }
      @inproceedings{huang2017arbitrary,
        title={Arbitrary Style Transfer in Real-time with Adaptive Instance Normalization},
        author={Huang, Xun and Belongie, Serge},
        booktitle={Proceedings of the International Conference on Computer Vision},
        year={2017},
        url={https://arxiv.org/pdf/1703.06868.pdf},
      }
      @inproceedings{radford2016unsupervised,
        author={Radford, Alec and Metz, Luke and Chintala, Soumith},
        title={Unsupervised Representation Learning with Deep Convolutional
               Generative Adversarial Networks},
        booktitle={Proceedings of the International Conference on Learning Representations},
        year={2016},
        url={https://arxiv.org/pdf/1511.06434.pdf},
      }
      @inproceedings{oord2016conditional,
        title={Conditional Image Generation with PixelCNN Decoders},
        author={van den Oord, Aaron and Kalchbrenner, Nal and Espeholt, Lasse
                and Vinyals, Oriol and Graves, Alex and Kavukcuoglu, Koray},
        booktitle={Advances in Neural Information Processing Systems},
        year={2016},
        url={https://arxiv.org/pdf/1606.05328.pdf}
      }
      @article{oord2016wavenet,
        title={WaveNet: A Generative Model for Raw Audio},
        author={van den Oord, Aaron and Dieleman, Sander and Zen, Heiga and
                Simonyan, Karen and Vinyals, Oriol and Graves, Alex and
                Kalchbrenner, Nal and Senior, Andrew and Kavukcuoglu, Koray},
        journal={arXiv},
        year={2016},
        url={https://arxiv.org/pdf/1609.03499.pdf},
      }
      @inproceedings{ha2016hypernetworks,
        author={Ha, David and Dai, Andrew and Le, Quoc},
        title={HyperNetworks},
        booktitle={Proceedings of the International Conference on Learning Representations},
        year={2016},
        url={https://arxiv.org/pdf/1609.09106.pdf},
      }
      @inproceedings{kim2017dynamic,
        author={Kim, Taesup and Song, Inchul and Bengio, Yoshua},
        title={Dynamic Layer Normalization for Adaptive Neural Acoustic Modeling
               in Speech Recognition},
        booktitle={Interspeech},
        year={2017},
        url={https://arxiv.org/pdf/1707.06065.pdf},
      }
      @inproceedings{hu2017squeeze,
        author={Hu, Jie and Shen, Li and Sun, Gang},
        title={Squeeze-and-Excitation Networks},
        booktitle={CVPR's ILSVRC 2017 Workshop},
        year={2017},
        url={https://arxiv.org/pdf/1709.01507.pdf},
      }
      @inproceedings{dauphin2017language,
        title={Language modeling with gated convolutional networks},
        author={Dauphin, Yann N and Fan, Angela and Auli, Michael and Grangier, David},
        booktitle={Proceedings of the International Conference on Machine Learning},
        year={2017},
        url={https://arxiv.org/pdf/1612.08083.pdf},
      }
      @inproceedings{gehring2017convolutional,
        author={Gehring, Jonas and Auli, Michael and Grangier, David and Yarats,
                Denis and Dauphin, Yann N.},
        title={Convolution Sequence-to-Sequence Learning},
        booktitle={Proceedings of the International Conference on Machine Learning},
        year={2017},
        url={https://arxiv.org/pdf/1705.03122.pdf},
      }
      @article{hochreiter1997long,
        title={Long Short-Term Memory},
        author={Hochreiter, Sepp and Schmidhuber, J{\"u}rgen},
        journal={Neural Computation},
        volume={9},
        number={8},
        pages={1735--1780},
        year={1997},
        publisher={MIT Press},
        url={http://dx.doi.org/10.1162/neco.1997.9.8.1735},
      }
      @article{tenenbaum2000separating,
        title={Separating Style and Content with Bilinear Models},
        author={Tenenbaum, Joshua B. and Freeman, William T.},
        journal={Neural Computation},
        volume={12},
        number={6},
        pages={1247--1283},
        year={2000},
        publisher={MIT Press},
        url={http://dx.doi.org/10.1162/089976600300015349},
      }
      @article{dhingra2017gated,
        title={Gated-Attention Readers for Text Comprehension},
        author={Dhingra, Bhuwan and Liu, Hanxiao and Yang, Zhilin, and
                Cohen, William W and Salakhutdinov, Ruslan},
        booktitle={Proceedings of the Annual Meeting of the Association for
                   Computational Linguistics},
        year={2017},
        url={https://arxiv.org/pdf/1606.01549.pdf},
      }
      @inproceedings{chaplot2017gated,
        title={Gated-Attention Architectures for Task-Oriented Language Grounding},
        author={Chaplot, Devendra Singh and Sathyendra, Kanthashree Mysore and
                Pasumarthi, Rama Kumar and Rajagopal, Dheeraj and Salakhutdinov,
                Ruslan},
        booktitle={ACL Workshop on Language Grounding for Robotics},
        year={2017},
        url={https://arxiv.org/pdf/1706.07230.pdf},
      }
      @inproceedings{shen2017disan,
        title={DiSAN: Directional Self-Attention Network for RNN/CNN-free
               Language Understanding},
        author={Shen, Tao and Zhou, Tianyi and Long, Guodong and Jiang, Jing and
                Pan, Shirui and Zhang, Chengqi},
        booktitle={arXiv},
        year={2017},
        url={https://arxiv.org/pdf/1709.04696.pdf},
      }
      @inproceedings{bowman2015large,
        title={A large annotated corpus for learning natural language inference},
        author={Bowman, Samuel R. and Angeli, Gabor and Potts, Christopher, and
                Manning, Christopher D.},
        booktitle={Proceedings of the Conference on Empirical Methods in Natural
                   Language Processing},
        year={2015},
        url={https://nlp.stanford.edu/pubs/snli_paper.pdf},
      }
      @article{jacobs1991adaptive,
        title={Adaptive Mixtures of Local Experts},
        author={Jacobs, Robert A. and Jordan, Michael I. and Nowlan, Steven J.
                and Hinton, Geoffrey E.},
        journal={Neural Computation},
        volume={3},
        number={1},
        pages={79--87},
        year={1991},
        publisher={MIT Press},
        url={http://dx.doi.org/10.1162/neco.1991.3.1.79},
      }
      @article{jordan1994hierarchical,
        title={Hierarchical Mixtures of Experts and the EM Algorithm},
        author={Jordan, Michael I. and Jacobs, Robert A.},
        journal={Neural Computation},
        volume={6},
        number={2},
        pages={181--214},
        year={1994},
        publisher={MIT Press},
        url={http://dx.doi.org/10.1162/neco.1994.6.2.181},
      }
      @inproceedings{eigen2014deep,
        author={Eigen, David and Ranzato, Marc'Aurelio and Sutskever, Ilya},
        title={Learning Factored Representations in a Deep Mixture of Experts},
        booktitle={Proceedings of the ICLR Workshops},
        year={2014},
        url={https://arxiv.org/pdf/1312.4314.pdf},
      }
      @article{kirkpatrick2017overcoming,
        title={Overcoming catastrophic forgetting in neural networks},
        author={Kirkpatrick, James and Pascanu, Razvan and Rabinowitz, Neil and
                Veness, Joel and Desjardins, Guillaume and Rusu, Andrei A. and
                Milan, Kieran and Quan, John and Ramalho, Tiago and
                Grabska-Barwinska, Agnieszka and Hassabis, Demis and Clopath,
                Claudia and Kumaran, Dharshan and Hadsell, Raia},
        journal={Proceedings of the National Academy of Sciences},
        volume={114},
        number={13},
        pages={3521--3526},
        year={2017},
        url={http://www.pnas.org/content/114/13/3521.abstract},
      }
      @inproceedings{mel1992clusteron,
        title={The Clusteron: Toward a Simple Abstraction for a Complex Neuron},
        author={Mel, Bartlett W},
        booktitle={Advances in Neural Information Processing Systems},
        year={1992},
        url={http://papers.nips.cc/paper/450-the-clusteron-toward-a-simple-abstraction-for-a-complex-neuron.pdf},
      }
      @article{boutonnet2015words,
        title={Words jump-start vision: A label advantage in object recognition},
        author={B. Boutonnet and G. Lupyan},
        journal={Journal of Neuroscience},
        volume={35},
        number={25},
        pages={9329--9335},
        year={2015},
        publisher={Society for Neuroscience},
        url={},
      }
      @inproceedings{agrawal2015vqa,
        title={VQA: Visual Question Answering},
        author={Agrawal, Aishwarya and Lu, Jiasen and Antol, Stanislaw  and
                Mitchell, Margaret and Zitnick, C. Lawrence and Batra, Dhruv and
                Parikh, Devi},
        booktitle={Proceedings of the International Conference on Computer Vision},
        year={2015},
        url={https://arxiv.org/pdf/1505.00468.pdf},
      }
      @inproceedings{kempa2016vizdoom,
        title={Vizdoom: A doom-based AI research platform for visual reinforcement learning},
        author={Kempka, Michał and Wydmuch, Marek and Runc, Grzegorz and Toczek, Jakub and Jaśkowski, Wojciech},
        booktitle={IEEE Conference on Computational Intelligence and Games},
        year={2016},
        url={https://arxiv.org/pdf/1605.02097.pdf},
      }
      @inproceedings{shazeer2017outrageously,
        title={Outrageously large neural networks: The sparsely-gated mixture-of-experts layer},
        author={Shazeer, Noam and Mirhoseini, Azalia and Maziarz, Krzysztof and Davis, Andy and Le, Quoc and Hinton, Geoffrey and Dean, Jeff},
        booktitle={Proceedings of the International Conference on Learning Representations},
        year={2017},
        url={https://arxiv.org/pdf/1701.06538.pdf},
      }
      @inproceedings{bahdanau2014neural,
        title={Neural machine translation by jointly learning to align and translate},
        author={Bahdanau, Dzmitry and Cho, Kyunghyun and Bengio, Yoshua},
        booktitle={Proceedings of the International Conference on Learning Representations},
        year={2015},
        url={https://arxiv.org/pdf/1409.0473.pdf},
      }
      @inproceedings{yang2016stacked,
		    title={Stacked attention networks for image question answering},
		    author={Yang, Zichao and He, Xiaodong and Gao, Jianfeng and Deng, Li and Smola, Alex},
		    booktitle={Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition},
		    year={2016}
	    } 
	    @inproceedings{kang2017incorporating,
		    title={Incorporating Side Information by Adaptive Convolution},
		    author={Kang, Di and Dhar, Debarun and Chan, Antoni},
		    booktitle={Advances in Neural Information Processing Systems},
		    year={2017}
		  }
	    @inproceedings{lei2015predicting,
		    title={Predicting deep zero-shot convolutional neural networks using textual descriptions},
		    author={Lei Ba, Jimmy and Swersky, Kevin and Fidler, Sanja and others},
		    booktitle={Proceedings of the IEEE International Conference on Computer Vision},
		    year={2015}
		  }
	    @inproceedings{oh2017zero,
	      title={Zero-shot task generalization with multi-task deep reinforcement learning},
	      author={Oh, Junhyuk and Singh, Satinder and Lee, Honglak and Kohli, Pushmeet},
	      booktitle={Proceedings of the International Conference on Machine Learning},
	      year={2017}
	    }
      @inproceedings{goodfellow2014generative,
        author={Goodfellow, Ian and Pouget-Abadie, Jean and Mirza, Mehdi and Xu, Bing and Warde-Farley, David and Ozair, Sherjil and Courville, Aaron and Bengio, Yoshua},
        title={Generative Adversarial Nets},
        booktitle={Advances in Neural Information Processing Systems},
        year={2014},
        url={https://papers.nips.cc/paper/5423-generative-adversarial-nets.pdf},
      }
    </script>
  </body>
</html>
